
<!DOCTYPE html>
<html lang="ko">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Junggu Ji, 생각의 기록">
    <title>Junggu Ji, 생각의 기록</title>
    <meta name="author" content="Junggu Ji">
    
    
    
        
            <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
        
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"Website","@id":"https://jungguji.github.io","author":{"@type":"Person","name":"Junggu Ji","sameAs":["https://github.com/jungguji","mailto"]},"name":"Junggu Ji, 생각의 기록","description":"","url":"https://jungguji.github.io"}</script>
    <meta property="og:type" content="blog">
<meta property="og:title" content="Junggu Ji, 생각의 기록">
<meta property="og:url" content="https://jungguji.github.io/index.html">
<meta property="og:site_name" content="Junggu Ji, 생각의 기록">
<meta property="og:locale" content="ko_KR">
<meta property="article:author" content="Junggu Ji">
<meta name="twitter:card" content="summary">
    
    
        
    
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-vaqxmiojfeym1obe22l4wzlc2exrxuyy1hezfoyofzx2ow3vxa49a2skiig7.min.css">

    <!--STYLES END-->
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-162527815-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-162527815-1');
    </script>


    

    

    <script data-ad-client="ca-pub-6264654331856753" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    

<header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a class="header-title-link" href="/" aria-label>
            Junggu Ji, 생각의 기록
        </a>
    </div>
    
        
            <a class="header-right-picture " href="#about" aria-label="링크 열기: /#about">
        
        
        </a>
    
</header>

            <!-- Define author's picture -->


<nav id="sidebar" data-behavior="1">
    <div class="sidebar-container">
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/" rel="noopener" title="Home">
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/all-categories" rel="noopener" title="카테고리">
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">카테고리</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/all-tags" rel="noopener" title="태그">
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">태그</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/all-archives" rel="noopener" title="아카이브">
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">아카이브</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="#about" rel="noopener" title="About">
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="https://github.com/jungguji" target="_blank" rel="external nofollow noopener noreferrer" title="GitHub">
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/mailto" rel="noopener" title="Mail">
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/atom.xml" rel="noopener" title="RSS">
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="1" class="
                        hasCoverMetaIn
                        ">
                <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2025/08/24/%EC%A0%95%EC%9D%98%EB%A1%9C%EC%9A%B4-%EC%BD%94%EB%93%9C-%ED%94%8C%EB%9D%BC%ED%86%A4%EC%9D%98-%EC%A0%95%EC%9D%98%EB%A1%A0%EA%B3%BC-%EC%86%8C%ED%94%84%ED%8A%B8%EC%9B%A8%EC%96%B4-%EA%B0%9C%EB%B0%9C%EC%9D%98-%EC%B2%A0%ED%95%99%EC%A0%81-%ED%83%90%EA%B5%AC/" aria-label=": 정의로운 코드: 플라톤의 정의론과 소프트웨어 개발의 철학적 탐구">
                            정의로운 코드: 플라톤의 정의론과 소프트웨어 개발의 철학적 탐구
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2025-08-24T11:37:40+09:00">
	
		    2025/08/24
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="서론-철학적-문제의식"><a href="#서론-철학적-문제의식" class="headerlink" title="서론: 철학적 문제의식"></a>서론: 철학적 문제의식</h2><p>소프트웨어 개발에서 <code>좋은 코드</code>란 무엇인가? 이는 단순히 기술적 효율성의 문제를 넘어서는 근본적 질문이다. 코드의 품질을 논할 때 우리는 흔히 ‘깔끔함’, ‘명확함’, ‘아름다움’ 같은 미학적 언어를 사용하거나, ‘책임’, ‘역할’, ‘질서’ 같은 도덕적 언어를 사용한다. 이는 우연이 아니다. <code>좋은 코드</code>에 대한 우리의 직관이 본질적으로 철학적 문제와 맞닿아 있기 때문이다.</p>
<p>본 글은 플라톤의 정의에 대한 탐구를 통해 소프트웨어 개발의 근본 원리를 철학적으로 고찰한다. 플라톤이 『국가』에서 제시한 정의의 개념이 현대 소프트웨어 설계 원칙과 구조적으로 일치함을 보이고, 이를 통해 <code>정의로운 코드</code>라는 새로운 개념적 틀을 제안한다.</p>
<hr>
<h2 id="1-플라톤의-정의-탐구-자기-일의-원칙"><a href="#1-플라톤의-정의-탐구-자기-일의-원칙" class="headerlink" title="1. 플라톤의 정의 탐구: 자기 일의 원칙"></a>1. 플라톤의 정의 탐구: 자기 일의 원칙</h2><h3 id="1-1-훌륭함의-원리-정의를-위한-철학적-기초"><a href="#1-1-훌륭함의-원리-정의를-위한-철학적-기초" class="headerlink" title="1.1 훌륭함의 원리: 정의를 위한 철학적 기초"></a>1.1 훌륭함의 원리: 정의를 위한 철학적 기초</h3><p>플라톤의 정의(正義, Justice)를 이해하기 위해서는, 먼저 그가 모든 존재의 ‘훌륭함(德, Virtue)’이란 무엇인지에 대해 제시하는 근본적인 원리를 살펴봐야 한다. 그는 『국가』에서 다음과 같이 말한다:</p>
<blockquote>
<p>“어떤 기능이 부여되어 있기도 한 각각의 것에는 ‘훌륭한 상태’와 ‘나쁜 상태’를 지니고 있다. 그 특유의 훌륭한 상태에 의해서 그 기능은 제 할 일들을 훌륭하게 수행하게 되지만, ‘나쁜 상태’에 의해서는 나쁘게 수행된다.”(353c)</p>
</blockquote>
<p>이 인용문의 핵심은 플라톤이 모든 존재의 ‘훌륭함’을 그 고유한 <strong>‘기능(function)’</strong> 의 완벽한 수행과 연결 짓는다는 점이다. 즉, 각 존재가 자신에게 주어진 단 하나의 기능, 즉 ‘제 할 일’에 집중하고 전문화되는 것, 이를 기능적 전문화(functional specialization)라 부를 수 있다. 이렇게 될 때 비로소 그 존재는 가장 훌륭한 상태에 도달한다.이는 단순한 효율성의 문제가 아니라 존재론적 완성의 문제다.</p>
<h3 id="1-2-정의의-본질-자기-일의-원칙"><a href="#1-2-정의의-본질-자기-일의-원칙" class="headerlink" title="1.2 정의의 본질: 자기 일의 원칙"></a>1.2 정의의 본질: 자기 일의 원칙</h3><p>이처럼 모든 ‘훌륭함’이 고유한 기능의 완벽한 수행에서 비롯된다는 대원칙 위에서, 플라톤은 마침내 정의의 본질을 규정한다. 그가 『국가』에서 직접 밝히듯이, 정의란 바로 <strong>“제 일을 하고 참견하지 않는 것”(433a)</strong> 이며, <strong>“제 것의 소유와 제 일을 함”(433e)</strong> 이 올바른 상태라고 규정한다.</p>
<p>이러한 철학적 정의는, ‘훌륭함’이 어떻게 성취되는지에 대한 매우 실용적인 관찰에 뿌리를 두고 있다. 플라톤은 국가의 기원을 논하는 대목에서 이미 그 근거를 다음과 같이 제시한 바 있다.</p>
<blockquote>
<p>“어떤 이가 일을 더 잘 해내게 되는 것은 한 사람으로서 여러 가지 기술에 종사할 때가 아니라 한 사람이 한 가지 기술에 종사할 때이다.”(370b)</p>
</blockquote>
<p>여기서 우리는 플라톤 정의 개념의 핵심, 즉 <strong>자기 일의 원칙(The Principle of One’s Own Work)</strong> 을 도출할 수 있다. 이는 각자가 자신의 고유한 성향과 능력에 맞는 일에 전념하고 다른 영역을 침범하지 않을 때, 개인의 탁월함은 물론 <strong>공동체 전체의 조화로운 질서</strong> 가 달성된다는 사상이다. 이때 정의는 외부에서 부과되는 규범이 아니라, 사물의 본성에서 자연스럽게 발현되는 질서다.</p>
<p>바로 이 지점에서 우리는 1.1에서 다룬 ‘훌륭함’과 1.2의 ‘정의’가 하나로 만나는 것을 목격한다. 플라톤에게 ‘정의’, 즉 ‘자기 일을 하는 것’은 그 자체로 도덕적 목표이기에 앞서, 모든 존재가 자신의 고유한 기능을 완벽하게 수행하는 ‘훌륭한 상태’에 도달하기 위한 유일하고 필연적인 방법론인 것이다.</p>
<h2 id="2-소프트웨어-개발에서의-정의-개념-적용"><a href="#2-소프트웨어-개발에서의-정의-개념-적용" class="headerlink" title="2. 소프트웨어 개발에서의 정의 개념 적용"></a>2. 소프트웨어 개발에서의 정의 개념 적용</h2><h3 id="2-1-조화로운-질서와-무질서의-풍경"><a href="#2-1-조화로운-질서와-무질서의-풍경" class="headerlink" title="2.1 조화로운 질서와 무질서의 풍경"></a>2.1 조화로운 질서와 무질서의 풍경</h3><p>플라톤의 ‘자기 일의 원칙’이라는 개념을 인지한 채 소프트웨어의 위계적 구조를 들여다보면, 우리는 비로소 ‘좋은 코드’와 ‘나쁜 코드’의 본질적인 차이를 목격하게 된다. 국가에 질서와 혼돈이 있듯이, 소프트웨어에도 그와 같은 풍경이 펼쳐진다. </p>
<ul>
<li><p>함수 수준에서: 하나의 함수가 데이터를 조회하고(생산자), 그 데이터의 유효성을 검증하며(수호자), 실패 시 예외를 던져 프로그램의 흐름을 제어한다면(통치자), 이 함수는 모든 역할을 독점하려는 <strong>‘정의롭지 못한 폭군’</strong> 과 같다. 반면 <strong>‘정의로운 함수’</strong> 는 오직 하나의 기능, 즉 ‘자기 일’에만 충실하며, 다른 기능들은 동료 함수들에게 겸손하게 위임하는 협력자다.</p>
</li>
<li><p>클래스 수준에서: User라는 클래스가 사용자의 정보를 담는 책임과 함께, 그 정보를 데이터베이스에 저장하고(UserRepository), 웹에 표시하기 위해 JSON으로 변환하는(JsonConverter) 책임까지 진다면, 이 클래스는 자신의 본분을 망각하고 남의 일에 참견하는 월권적 존재다. <strong>‘정의로운 클래스’</strong> 는 오직 ‘사용자라는 개념을 책임지는 것’이라는 자기 일만 수행한다.</p>
</li>
</ul>
<p>이처럼 각 요소가 자신의 경계를 넘어 서로의 역할을 침범할 때, 소프트웨어라는 국가는 무질서와 혼란에 빠지게 된다.</p>
<h3 id="2-2-‘정의로운-코드’의-정의"><a href="#2-2-‘정의로운-코드’의-정의" class="headerlink" title="2.2 ‘정의로운 코드’의 정의"></a>2.2 ‘정의로운 코드’의 정의</h3><p>이러한 철학적 탐구를 바탕으로, 우리는 ‘좋은 코드’를 기술적 용어를 넘어선 새로운 차원에서 정의할 수 있다. 이것이 바로 <strong>‘정의로운 코드’</strong> 다.</p>
<blockquote>
<p>정의로운 코드란, 소프트웨어의 각 구성요소가 자신의 고유한 기능을 명확히 갖고, 그 기능만을 온전히 수행하며, 다른 구성요소들과 조화로운 관계를 맺는 코드다.</p>
</blockquote>
<p>이는 기술적 효율성을 넘어서는 <strong>존재론적 완성</strong>의 개념이다. 각 요소가 자신의 본성을 실현하고 “제 일”에만 충실할 때 전체가 아름다운 질서를 이룬다.</p>
<h2 id="3-현대-개발-원칙과의-수렴"><a href="#3-현대-개발-원칙과의-수렴" class="headerlink" title="3. 현대 개발 원칙과의 수렴"></a>3. 현대 개발 원칙과의 수렴</h2><h3 id="3-1-구조적-일치-시대를-초월한-지혜"><a href="#3-1-구조적-일치-시대를-초월한-지혜" class="headerlink" title="3.1 구조적 일치: 시대를 초월한 지혜"></a>3.1 구조적 일치: 시대를 초월한 지혜</h3><p>놀랍게도 플라톤이 2,400년 전에 제시한 이 철학적 통찰은, 현대 소프트웨어 공학을 지탱하는 핵심 원칙들 속에 그대로 살아 숨 쉬고 있다.</p>
<p><strong>단일 책임 원칙(SRP)</strong>: 클래스가 단 하나의 변경 이유만을 가져야 한다는 SRP의 요구는, “한 사람이 한 가지 기술에 종사할 때” 가장 훌륭한 결과가 나온다는 플라톤의 주장과 완벽하게 일치한다. 여러 책임을 가진 클래스는 필연적으로 혼란을 낳는다.</p>
<p><strong>관심사의 분리</strong>:  이는 국가에서 생산자, 수호자, 통치자의 역할을 명확히 분리해야 한다는 플라톤의 사상과 맞닿아 있다. 데이터 접근 로직, 비즈니스 로직, 프레젠테이션 로직이 뒤섞인 코드는 각자의 ‘기능’을 망각하고 서로의 일에 참견하는 ‘정의롭지 못한’ 상태이며, 유지보수를 악몽으로 만든다.</p>
<p><strong>높은 응집도, 낮은 결합도</strong>: ‘높은 응집도’란 하나의 모듈이 자신의 ‘자기 일’에만 충실하게 뭉쳐 있는 상태를 의미한다. ‘낮은 결합도’는 각 모듈이 다른 모듈의 일에 “참견하지 않는 것”을 기술적으로 구현한 것이다. 이 두 가지가 달성될 때, 비로소 플라톤이 말한 ‘조화로운 질서’가 시스템 전체에 발현된다.</p>
<p><strong>캡슐화</strong>: 이는 각 객체가 ‘자신의 것’을 지키고 외부의 부당한 간섭으로부터 스스로를 보호하는 원리다. 객체의 내부 상태를 숨기고 오직 공개된 메서드를 통해서만 상호작용하도록 강제하는 것은, 각자가 “남의 것을 취하지도 않도록 하고, 또한 제 것을 빼앗기지도 않도록 하는 것”이 올바름이라는 플라톤의 말을 떠올리게 한다.</p>
<p>이러한 구조적 일치는 결코 우연이 아니다. 좋은 설계의 본질은 시대를 초월하며, 결국 현대 개발 원칙들이 ‘왜’ 좋은지에 대한 근본적인 이유를 플라톤의 정의의 개념이 제공하는 셈이다. 단일 책임 원칙이나 관심사의 분리와 같은 원칙들은 단순히 경험적으로 발견된 실용적 규칙을 넘어선다. 그것들은, 앞서 1.2에서 살펴보았듯 ‘자기 일의 원칙’이라는 정의가 추구하는 궁극적인 상태, 즉 ‘조화로운 질서’라는 보편적 가치를 기술적으로 구현한 것이라 할 수 있다.</p>
<h2 id="4-비판적-검토-이상과-현실의-대화"><a href="#4-비판적-검토-이상과-현실의-대화" class="headerlink" title="4. 비판적 검토: 이상과 현실의 대화"></a>4. 비판적 검토: 이상과 현실의 대화</h2><p>그러나 ‘정의로운 코드’라는 유추가 가진 한계 역시 명확히 해야 한다. 이어지는 비판적 검토는 이 주장을 약화시키는 것이 아니라, 오히려 그 적용 가능한 현실의 범위를 선명히 밝혀줄 것이다.</p>
<h3 id="4-1-유추의-한계-살아있는-코드와-이상-국가"><a href="#4-1-유추의-한계-살아있는-코드와-이상-국가" class="headerlink" title="4.1 유추의 한계: 살아있는 코드와 이상 국가"></a>4.1 유추의 한계: 살아있는 코드와 이상 국가</h3><p>소프트웨어는 플라톤이 상상했던 이상국가와는 근본적으로 다른 특성을 지닌다. 소프트웨어는 끊임없이 변화하는 요구사항 속에서 유기적으로 성장하는 살아있는 시스템이다. 반면 플라톤의 국가는 이상적인 질서가 한 번 확립되면 영원히 유지되는 정적인 모델에 가깝다. 현대 소프트웨어의 복잡성과 컴포넌트 간의 상호의존성은 고대 사회의 분업과는 비교할 수 없을 정도로 역동적이다.</p>
<p>그럼에도 불구하고, 이러한 차이점이 ‘자기 일의 원칙’의 가치를 훼손하지는 않는다. 이 원칙은 소프트웨어의 구체적인 구현을 지시하는 ‘청사진’이 아니라, 변화와 복잡성 속에서 우리가 지향해야 할 방향을 알려주는 <strong>‘나침반’</strong> 이기 때문이다. 오히려 시스템이 역동적일수록, 각 부분이 자신의 역할에 충실해야 전체의 안정성이 유지된다는 근본 원리는 더욱 중요해진다.</p>
<h3 id="4-2-대안적-해석-철학-없이도-충분한가"><a href="#4-2-대안적-해석-철학-없이도-충분한가" class="headerlink" title="4.2 대안적 해석: 철학 없이도 충분한가?"></a>4.2 대안적 해석: 철학 없이도 충분한가?</h3><p>물론 단일 책임 원칙과 같은 원리들을 굳이 플라톤까지 거슬러 올라가지 않고도 설명할 수 있다. 유지보수 비용을 줄이려는 실용주의적 해석, 복잡한 환경에서 살아남은 설계 패턴이라는 진화론적 해석, 혹은 인간의 인지적 한계에 맞춘 설계 방식이라는 인지과학적 해석 모두 타당하다.</p>
<p>하지만, 이러한 해석들은 ‘무엇(What)’과 ‘어떻게(How)’는 설명할 수 있어도, 좋은 설계가 우리에게 왜 그토록 깊은 만족감과 아름다움을 주는가라는 <strong>‘왜(Why)’</strong> 의 질문에는 온전히 답하지 못한다. 철학적 접근은 다른 해석들을 대체하는 것이 아니라, 그것들을 더 깊은 차원에서 통합하는 <strong>‘근본적인 이유’</strong> 를 제공한다. 실용적 전략이 ‘질서와 조화’라는 보편적 가치와 맞닿아 있음을 이해할 때, 우리는 비로소 코드 작성의 기술적 행위를 넘어 철학적 실천의 영역으로 들어설 수 있다.</p>
<h3 id="4-3-적용-범위의-한계-언제-정의를-유보해야-하는가"><a href="#4-3-적용-범위의-한계-언제-정의를-유보해야-하는가" class="headerlink" title="4.3 적용 범위의 한계: 언제 정의를 유보해야 하는가?"></a>4.3 적용 범위의 한계: 언제 정의를 유보해야 하는가?</h3><p>‘정의로운 코드’라는 이상은 진공 속에서 존재하지 않는다. 소프트웨어 개발은 철학적 이상을 실현하는 예술이기에 앞서, 제한된 자원(시간, 인력, 비용) 안에서 현실의 문제를 해결해야 하는 실용적인 행위다. 따라서 모든 개발자는 이상과 현실 사이에서 끊임없이 <strong>트레이드 오프(Trade-off)</strong> 를 결단해야 한다.</p>
<p>완벽하게 정의로운 설계를 추구하는 것이 오히려 비즈니스 목표 달성에 해가 되는 경우, 우리는 기꺼이 ‘차선’을 선택하는 지혜를 발휘해야 한다. 시장 출시가 급한 신규 프로젝트든, 복잡한 제약 속에서 기능을 추가해야 하는 거대한 시스템이든, 모든 상황은 우리에게 ‘중용(中庸)’의 미덕을 요구한다. 때로는 빠르게 ‘작동하는 소프트웨어’를 전달하는 것이, 완벽한 구조를 추구하는 것보다 더 시급하고 중요한 ‘정의’가 될 수 있다.</p>
<p>이는 ‘정의로운 코드’라는 이상의 실패가 아니다. 오히려 그것은, 우리가 추구하는 이상이 얼마나 높은 가치를 지니는지를 알기에, 현실의 무게를 감당하며 그 이상을 향해 한 걸음이라도 더 나아가려는 전문가로서의 책임감을 증명하는 것이다. 이상은 모든 현실에 기계적으로 적용되기 위해 존재하는 것이 아니라, 혼란스러운 현실 속에서 우리가 더 나은 결정을 내리도록 길을 밝혀주는 별과 같은 역할을 한다.</p>
<h2 id="5-결론-정의로운-코드-그-철학적-실천을-향하여"><a href="#5-결론-정의로운-코드-그-철학적-실천을-향하여" class="headerlink" title="5. 결론: 정의로운 코드, 그 철학적 실천을 향하여"></a>5. 결론: 정의로운 코드, 그 철학적 실천을 향하여</h2><p>우리는 ‘좋은 코드란 무엇인가?’라는 소박한 질문에서 출발하여, 2,400년 전 플라톤의 철학이라는 깊은 바다를 항해했다. 이 여정을 통해 우리는 코드 작성이라는 기술적 행위가 ‘질서’와 ‘조화’를 창조하는 철학적 실천이 될 수 있음을 목격했다. 이제 ‘정의로운 코드’라는 나침반이 우리 개발자들의 여정에 어떤 실천적 함의를 던져주는지 숙고하며 이 글을 마무리하고자 한다.</p>
<h3 id="5-1-장인으로서의-책임-단순한-구현을-넘어"><a href="#5-1-장인으로서의-책임-단순한-구현을-넘어" class="headerlink" title="5.1 장인으로서의 책임: 단순한 구현을 넘어"></a>5.1 장인으로서의 책임: 단순한 구현을 넘어</h3><p>‘정의로운 코드’라는 개념은 우리에게 코드 작성을 바라보는 새로운 관점을 제시한다. 그것은 단순히 주어진 기능을 구현하는 기술적 행위를 넘어, 시스템 전체의 건강과 미래를 책임지는 ‘장인(Craftsman)’의 행위로 확장된다.</p>
<p>좋은 장인이 나무의 결을 살려 최적의 형태를 찾아내듯, 우리 역시 코드의 구조 속에서 최선의 질서를 고민하게 된다. 하나의 함수, 하나의 클래스를 설계하는 것은 시스템이라는 작은 공동체 안에서 각 시민에게 가장 적합한 역할을 부여하고 그 책임의 경계를 설정하는 일이다. 이것은 더 나은 결과물을 만들기 위해 우리가 매일 마주하는 <strong>‘전문가로서의 신중한 선택’</strong> 이다.</p>
<p>이제 우리는 키보드 앞에서 스스로에게 묻게 될 것이다. “이 코드는 자신의 ‘자기 일’에 충실한가? 이것은 시스템 전체의 ‘조화로운 질서’에 기여하고 있는가?” 이 질문을 품는 개발자는 단순히 코드를 생산하는 것을 넘어, 코드 속에 장기적인 안정성과 명료함을 구현하는 창조자가 된다.</p>
<h3 id="5-2-이상과-현실의-변증법-더-나은-타협을-위한-별"><a href="#5-2-이상과-현실의-변증법-더-나은-타협을-위한-별" class="headerlink" title="5.2 이상과 현실의 변증법: 더 나은 타협을 위한 별"></a>5.2 이상과 현실의 변증법: 더 나은 타협을 위한 별</h3><p>물론 우리는 4장에서 살펴보았듯, 늘 시간과 자원의 제약이라는 현실의 중력 속에서 살아간다. 비즈니스의 요구는 때로 우리에게 완벽한 정의가 아닌 ‘차선’의 타협을 강요한다.</p>
<p>그러나 ‘정의로운 코드’라는 이상은 바로 이 지점에서 가장 밝게 빛난다. 그것은 모든 상황에 기계적으로 적용해야 할 율법이 아니라, <strong>어두운 현실 속에서 더 나은 타협을 가능하게 하는 ‘북극성’</strong> 이다. 우리가 어디를 향해 가야 하는지 알고 있을 때, 우리는 길을 잃더라도 최소한 방향을 잃지는 않는다. 현실의 제약 속에서 ‘정의’를 향한 최선의 노력을 담아내는 것, 이것이야말로 진정한 전문가의 책무이자 이 철학적 탐구의 가장 현실적인 결론이다.</p>
<h3 id="5-3-미래를-향한-제언-우리에게는-철학이-필요하다"><a href="#5-3-미래를-향한-제언-우리에게는-철학이-필요하다" class="headerlink" title="5.3 미래를 향한 제언: 우리에게는 철학이 필요하다"></a>5.3 미래를 향한 제언: 우리에게는 철학이 필요하다</h3><p>소프트웨어가 세상을 집어삼키는 시대에, 우리는 그 어느 때보다 더 깊은 성찰을 요구받고 있다. 인공지능이 코드를 생성하고 기술적 효율성이 극대화될 미래에, 인간 개발자의 대체 불가능한 가치는 어디에 있을까? 그것은 바로 ‘왜’를 묻는 능력, 즉 좋음과 올바름, 질서와 조화를 추구하는 철학적 사유에 있을 것이다.</p>
<p>단순히 기술 규칙을 암기하는 교육을 넘어, 그 규칙들의 철학적 근거를 탐구하는 문화가 필요하다. 기술적 효율성만으로는 부족하다. 우리에게는 질서와 조화, 아름다움과 정의를 추구하는 소프트웨어, 그리고 그것을 만들 수 있는 ‘개발자’가 필요하다.</p>
<p>플라톤의 정의의 개념을 통해 본 소프트웨어 개발은 단순한 공학적 행위를 넘어선다. 그것은 혼돈에 질서를 부여하고, 무질서 속에서 조화를 창조하는 고귀한 실천이다.</p>
<p>결국 좋은 코드란, 각 부분이 ‘자기 일’을 다하는 코드다. 이것이 2,400년 전 철학자로부터 배운, 현실 속에서 분투하는 현대 개발자를 위한 영원한 교훈이다.</p>
<hr>
<h2 id="참고-문헌"><a href="#참고-문헌" class="headerlink" title="참고 문헌"></a>참고 문헌</h2><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://product.kyobobook.co.kr/detail/S000000546980">플라톤, 『국가(정체)』, 박종현 역, 서광사</a></li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a href="/2025/08/24/%EC%A0%95%EC%9D%98%EB%A1%9C%EC%9A%B4-%EC%BD%94%EB%93%9C-%ED%94%8C%EB%9D%BC%ED%86%A4%EC%9D%98-%EC%A0%95%EC%9D%98%EB%A1%A0%EA%B3%BC-%EC%86%8C%ED%94%84%ED%8A%B8%EC%9B%A8%EC%96%B4-%EA%B0%9C%EB%B0%9C%EC%9D%98-%EC%B2%A0%ED%95%99%EC%A0%81-%ED%83%90%EA%B5%AC/#post-footer" class="postShorten-excerpt_link link" aria-label>
                                댓글 공유
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2025/01/09/%EB%8F%99%EC%8B%9C%EC%84%B1-%EC%A0%9C%EC%96%B4%EB%A5%BC-%EC%9C%84%ED%95%9C-Redisson-tryLock-%EB%A9%94%EC%84%9C%EB%93%9C%EC%9D%98-%EC%9E%91%EB%8F%99-%EC%9B%90%EB%A6%AC/" aria-label=": 동시성 제어를 위한 Redisson tryLock 메서드의 작동 원리">
                            동시성 제어를 위한 Redisson tryLock 메서드의 작동 원리
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2025-01-09T12:42:28+09:00">
	
		    2025/01/09
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="도입"><a href="#도입" class="headerlink" title="도입"></a>도입</h2><p>동시성 제어는 여러 사용자가 동시에 시스템을 사용할 때 데이터 무결성을 유지하고 성능 저하를 방지하는 데 중요한 역할을 한다. 특히 분산 환경에서는 이러한 문제가 더욱 두드러지며, 이를 해결하기 위한 방법으로 Redis와 Redisson 라이브러리가 자주 사용된다. 본 포스팅에서는 동시성 제어를 위해 사용되는 Redisson의 tryLock 메서드가 어떻게 작동하는지 소개한다.<br>본 포스팅은 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://javadoc.io/doc/org.redisson/redisson/latest/index.html">Redisson 3.41.0 버전</a>을 기준으로 작성되었다.</p>
<hr>
<h2 id="이론적-배경"><a href="#이론적-배경" class="headerlink" title="이론적 배경"></a>이론적 배경</h2><p><strong>1. 동시성 제어의 필요성</strong></p>
<ul>
<li>동시성 이슈는 여러 프로세스가 동시에 동일한 자원에 접근할 때 발생한다. 이를 해결하기 위해 락(lock) 메커니즘이 사용된다. </li>
<li>단일 시스템에서는 일반적인 락으로 해결할 수 있지만, 분산 시스템에서는 분산 락이 필요하다.</li>
</ul>
<p><strong>2. Redis와 Redisson</strong></p>
<ul>
<li>Redis는 인메모리 데이터베이스로, 높은 성능과 다양한 데이터 구조를 제공한다. </li>
<li>Redisson은 Redis 기반의 클라이언트 라이브러리로, 분산 락 및 다양한 동시성 제어 기능을 지원한다.</li>
<li>Redisson을 이용한 실제적인 분산락 적용 방법은 이전 포스팅 <a href="https://jungguji.github.io/2024/12/24/%EB%8F%99%EC%8B%9C%EC%84%B1-%EC%9D%B4%EC%8A%88%EC%99%80-Redis-Redisson-%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%ED%95%B4%EA%B2%B0%EB%B0%A9%EB%B2%95/">동시성 이슈와 Redis( Redisson )를 이용한 해결방법</a>에서 확인할 수 있다.</li>
</ul>
<h2 id="tryLock-메서드의-작동-원리"><a href="#tryLock-메서드의-작동-원리" class="headerlink" title="tryLock 메서드의 작동 원리"></a>tryLock 메서드의 작동 원리</h2><p>Redisson의 tryLock 메서드는 분산 락을 구현하는 데 핵심 역할을 한다. 아래는 주요 작동 원리와 코드에 대한 설명이며, 아래 코드는 Redisson 3.41.0 기준으로 동작한다. 특정 버전에서는 내부 구현이 달라질 수 있으니 공식 문서를  참고하기 바란다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryLock</span><span class="params">(<span class="keyword">long</span> waitTime, <span class="keyword">long</span> leaseTime, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> time = unit.toMillis(waitTime);</span><br><span class="line">    <span class="keyword">long</span> current = System.currentTimeMillis();</span><br><span class="line">    <span class="keyword">long</span> threadId = Thread.currentThread().getId();</span><br><span class="line">    <span class="comment">// 1. 최초 락 획득 시도</span></span><br><span class="line">    Long ttl = <span class="keyword">this</span>.tryAcquire(waitTime, leaseTime, unit, threadId);</span><br><span class="line">    <span class="keyword">if</span> (ttl == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 2. 타이머 갱신</span></span><br><span class="line">        time -= System.currentTimeMillis() - current;</span><br><span class="line">        <span class="keyword">if</span> (time &lt;= <span class="number">0L</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.acquireFailed(waitTime, unit, threadId);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 3. 락에 대한 pub/sub 채널 구독</span></span><br><span class="line">            current = System.currentTimeMillis();</span><br><span class="line">            CompletableFuture&lt;RedissonLockEntry&gt; subscribeFuture = <span class="keyword">this</span>.subscribe(threadId);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                subscribeFuture.get(time, TimeUnit.MILLISECONDS);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (TimeoutException var21) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!subscribeFuture.completeExceptionally(<span class="keyword">new</span> RedisTimeoutException(<span class="string">&quot;Unable to acquire subscription lock after &quot;</span> + time + <span class="string">&quot;ms. Try to increase &#x27;subscriptionsPerConnection&#x27; and/or &#x27;subscriptionConnectionPoolSize&#x27; parameters.&quot;</span>))) &#123;</span><br><span class="line">                    subscribeFuture.whenComplete((res, ex) -&gt; &#123;</span><br><span class="line">                        <span class="keyword">if</span> (ex == <span class="keyword">null</span>) &#123;</span><br><span class="line">                            <span class="keyword">this</span>.unsubscribe(res, threadId);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">this</span>.acquireFailed(waitTime, unit, threadId);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ExecutionException var22) &#123;</span><br><span class="line">                ExecutionException e = var22;</span><br><span class="line">                LOGGER.error(e.getMessage(), e);</span><br><span class="line">                <span class="keyword">this</span>.acquireFailed(waitTime, unit, threadId);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">boolean</span> var16;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                time -= System.currentTimeMillis() - current;</span><br><span class="line">                <span class="keyword">if</span> (time &lt;= <span class="number">0L</span>) &#123;</span><br><span class="line">                    <span class="keyword">this</span>.acquireFailed(waitTime, unit, threadId);</span><br><span class="line">                    <span class="keyword">boolean</span> var25 = <span class="keyword">false</span>;</span><br><span class="line">                    <span class="keyword">return</span> var25;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">do</span> &#123;</span><br><span class="line">                    <span class="keyword">long</span> currentTime = System.currentTimeMillis();</span><br><span class="line">                    ttl = <span class="keyword">this</span>.tryAcquire(waitTime, leaseTime, unit, threadId);</span><br><span class="line">                    <span class="keyword">if</span> (ttl == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        var16 = <span class="keyword">true</span>;</span><br><span class="line">                        <span class="keyword">return</span> var16;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    time -= System.currentTimeMillis() - currentTime;</span><br><span class="line">                    <span class="keyword">if</span> (time &lt;= <span class="number">0L</span>) &#123;</span><br><span class="line">                        <span class="keyword">this</span>.acquireFailed(waitTime, unit, threadId);</span><br><span class="line">                        var16 = <span class="keyword">false</span>;</span><br><span class="line">                        <span class="keyword">return</span> var16;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    currentTime = System.currentTimeMillis();</span><br><span class="line">                    <span class="keyword">if</span> (ttl &gt;= <span class="number">0L</span> &amp;&amp; ttl &lt; time) &#123;</span><br><span class="line">                        ((RedissonLockEntry)<span class="keyword">this</span>.commandExecutor.getNow(subscribeFuture)).getLatch().tryAcquire(ttl, TimeUnit.MILLISECONDS);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        ((RedissonLockEntry)<span class="keyword">this</span>.commandExecutor.getNow(subscribeFuture)).getLatch().tryAcquire(time, TimeUnit.MILLISECONDS);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    time -= System.currentTimeMillis() - currentTime;</span><br><span class="line">                &#125; <span class="keyword">while</span>(time &gt; <span class="number">0L</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">this</span>.acquireFailed(waitTime, unit, threadId);</span><br><span class="line">                var16 = <span class="keyword">false</span>;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.unsubscribe((RedissonLockEntry)<span class="keyword">this</span>.commandExecutor.getNow(subscribeFuture), threadId);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> var16;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-최초-락-획득-시도"><a href="#1-최초-락-획득-시도" class="headerlink" title="1. 최초 락 획득 시도"></a>1. 최초 락 획득 시도</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Long ttl = <span class="keyword">this</span>.tryAcquire(waitTime, leaseTime, unit, threadId);</span><br><span class="line"><span class="keyword">if</span> (ttl == <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// ttl != null이면 락이 선점되어 있음을 의미</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>this.tryAcquire()</code>는  락 획득 가능 여부를 확인한다.<ul>
<li>반환값이 <code>null</code>인 경우, 현재 락을 바로 획득할 수 있음을 의미한다.</li>
<li>반환값이 <code>null</code>이 아닌 경우, 이미 락이 선점되었거나 대기가 필요함을 나타낸다.</li>
</ul>
</li>
</ul>
<h3 id="2-타이머-갱신"><a href="#2-타이머-갱신" class="headerlink" title="2. 타이머 갱신"></a>2. 타이머 갱신</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">time -= System.currentTimeMillis() - current;</span><br><span class="line"><span class="keyword">if</span> (time &lt;= <span class="number">0L</span>) &#123;</span><br><span class="line">	<span class="keyword">this</span>.acquireFailed(waitTime, unit, threadId);</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>남은 대기 시간을 갱신하며, 시간이 0 이하인 경우 락 획득을 포기한다.</li>
</ul>
<h3 id="3-락에-대한-pub-sub-채널-구독"><a href="#3-락에-대한-pub-sub-채널-구독" class="headerlink" title="3. 락에 대한 pub/sub 채널 구독"></a>3. 락에 대한 pub/sub 채널 구독</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">current = System.currentTimeMillis();</span><br><span class="line">CompletableFuture&lt;RedissonLockEntry&gt; subscribeFuture = <span class="keyword">this</span>.subscribe(threadId);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    subscribeFuture.get(time, TimeUnit.MILLISECONDS);</span><br><span class="line">&#125; <span class="keyword">catch</span> (TimeoutException var21) &#123; </span><br><span class="line">	... </span><br><span class="line">&#125; <span class="keyword">catch</span> (ExecutionException var22) &#123; </span><br><span class="line">	... </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>subscribe()</code> 는 Pub/Sub를 통해 락 이벤트를 감지할 준비를 한다.</li>
<li><code>subscribeFuture.get()</code>을 호출해 설정된 시간 동안 구독이 성공하기를 기다린다.<ul>
<li>시간이 초과되면(<code>TimeoutException</code>) 구독을 종료하고 <code>false</code>를 반환한다.</li>
<li><code>ExecutionException</code>이 발생하면 에러를 로깅하고 <code>false</code>를 반환한다.</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> CompletableFuture&lt;RedissonLockEntry&gt; <span class="title">subscribe</span><span class="params">(<span class="keyword">long</span> threadId)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">this</span>.pubSub.subscribe(<span class="keyword">this</span>.getEntryName(), <span class="keyword">this</span>.getChannelName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>threadId</code>는 구독 채널 생성에 직접 사용되지 않고, 락 이름(lock name)과 채널 ID를 기반으로 Pub/Sub 채널이 생성된다.</li>
<li>이 과정은 락 해제 이벤트를 감지하기 위해 필수적이다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> CompletableFuture&lt;E&gt; <span class="title">subscribe</span><span class="params">(String entryName, String channelName)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// a. Semaphore 생성 및 acquire 호출</span></span><br><span class="line">    AsyncSemaphore semaphore = <span class="keyword">this</span>.service.getSemaphore(<span class="keyword">new</span> ChannelName(channelName));</span><br><span class="line">    CompletableFuture&lt;E&gt; newPromise = <span class="keyword">new</span> CompletableFuture();</span><br><span class="line">    semaphore.acquire().thenAccept((c) -&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (newPromise.isDone()) &#123;</span><br><span class="line">            semaphore.release();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// b. Pub/Sub 채널 확인 및 생성</span></span><br><span class="line">            E entry = (PubSubEntry)<span class="keyword">this</span>.entries.get(entryName);</span><br><span class="line">            <span class="keyword">if</span> (entry != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// (1) 기존 엔트리가 있는 경우</span></span><br><span class="line">                entry.acquire();</span><br><span class="line">                semaphore.release();</span><br><span class="line">                entry.getPromise().whenComplete((r, e) -&gt; &#123;</span><br><span class="line">                    <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        newPromise.completeExceptionally(e);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        newPromise.complete(r);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// (2) 새로운 엔트리를 생성</span></span><br><span class="line">                E value = <span class="keyword">this</span>.createEntry(newPromise);</span><br><span class="line">                value.acquire();</span><br><span class="line">                E oldValue = (PubSubEntry)<span class="keyword">this</span>.entries.putIfAbsent(entryName, value);</span><br><span class="line">                <span class="keyword">if</span> (oldValue != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    oldValue.acquire();</span><br><span class="line">                    semaphore.release();</span><br><span class="line">                    oldValue.getPromise().whenComplete((r, e) -&gt; &#123;</span><br><span class="line">                        <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line">                            newPromise.completeExceptionally(e);</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            newPromise.complete(r);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// (3) Redis Pub/Sub 연결 로직 수행</span></span><br><span class="line">                    RedisPubSubListener&lt;Object&gt; listener = <span class="keyword">this</span>.createListener(channelName, value);</span><br><span class="line">                    CompletableFuture&lt;PubSubConnectionEntry&gt; s = <span class="keyword">this</span>.service.subscribeNoTimeout(LongCodec.INSTANCE, channelName, semaphore, <span class="keyword">new</span> RedisPubSubListener[]&#123;listener&#125;);</span><br><span class="line">                    newPromise.whenComplete((r, e) -&gt; &#123;</span><br><span class="line">                        <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line">                            s.completeExceptionally(e);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                    &#125;);</span><br><span class="line">                    <span class="comment">// (4) Pub/Sub 구독 상태 관리 및 실패 처리</span></span><br><span class="line">                    s.whenComplete((r, e) -&gt; &#123;</span><br><span class="line">                        <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line">                            <span class="keyword">this</span>.entries.remove(entryName);</span><br><span class="line">                            value.getPromise().completeExceptionally(e);</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">if</span> (!value.getPromise().complete(value) &amp;&amp; value.getPromise().isCompletedExceptionally()) &#123;</span><br><span class="line">                                <span class="keyword">this</span>.entries.remove(entryName);</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> newPromise;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>a. Semaphore 생성 및 acquire 호출</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">AsyncSemaphore semaphore = <span class="keyword">this</span>.service.getSemaphore(<span class="keyword">new</span> ChannelName(channelName));</span><br><span class="line">CompletableFuture&lt;E&gt; newPromise = <span class="keyword">new</span> CompletableFuture();</span><br><span class="line">semaphore.acquire().thenAccept((c) -&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (newPromise.isDone()) &#123;</span><br><span class="line">        semaphore.release();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><code>getSemaphore()</code>를 통해 해당 채널 이름에 대한 비동기 세마포어를 가져온다.<ul>
<li>여러 스레드나 인스턴스에서 동일한 채널에 구독 요청이 들어올 수 있으므로, 세마포어를 사용해 동시성을 제어한다.</li>
</ul>
</li>
<li><code>acquire()</code>를 호출하여 락 획득을 시도한다. <ul>
<li>이 작업은 비동기로 수행되며, 락 획득이 완료되면 <code>thenAccept</code> 블록이 실행된다.</li>
<li>이 때 획득 시도하는 락은 <strong>채널 구독을 위한 락</strong>이다.</li>
<li>구독 요청은 <code>AsyncSemaphore</code> 내부의 큐(<a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.javadoc.io/static/org.redisson/redisson/3.41.0/org/redisson/misc/FastRemovalQueue.html">FastRemovalQueue</a>)를 통해 순서대로 처리된다.</li>
</ul>
</li>
<li>작업 완료 상태 확인 후 락 해제:<ul>
<li>만약 <code>newPromise.isDone()</code> 상태라면, 작업이 이미 완료된 것이므로 락을 해제한다.</li>
<li>이는 동일한 채널을 구독 중인 다른 스레드가 작업을 이미 완료했음을 감지하기 위함이다.</li>
</ul>
</li>
</ul>
<p><strong>b. Pub/Sub 채널 확인 및 생성</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">E entry = (PubSubEntry)<span class="keyword">this</span>.entries.get(entryName);</span><br><span class="line"><span class="keyword">if</span> (entry != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="comment">// (1) 기존 엔트리가 있는 경우</span></span><br><span class="line">    entry.acquire();</span><br><span class="line">    semaphore.release();</span><br><span class="line">    entry.getPromise().whenComplete((r, e) -&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line">            newPromise.completeExceptionally(e);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            newPromise.complete(r);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// (2) 새로운 엔트리를 생성</span></span><br><span class="line">    E value = <span class="keyword">this</span>.createEntry(newPromise);</span><br><span class="line">    value.acquire();</span><br><span class="line">    E oldValue = (PubSubEntry)<span class="keyword">this</span>.entries.putIfAbsent(entryName, value);</span><br><span class="line">    <span class="keyword">if</span> (oldValue != <span class="keyword">null</span>) &#123;</span><br><span class="line">        oldValue.acquire();</span><br><span class="line">        semaphore.release();</span><br><span class="line">        oldValue.getPromise().whenComplete((r, e) -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line">                newPromise.completeExceptionally(e);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                newPromise.complete(r);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// (3) Redis Pub/Sub 연결 로직 수행</span></span><br><span class="line">        RedisPubSubListener&lt;Object&gt; listener = <span class="keyword">this</span>.createListener(channelName, value);</span><br><span class="line">        CompletableFuture&lt;PubSubConnectionEntry&gt; s = <span class="keyword">this</span>.service.subscribeNoTimeout(LongCodec.INSTANCE, channelName, semaphore, <span class="keyword">new</span> RedisPubSubListener[]&#123;listener&#125;);</span><br><span class="line">        newPromise.whenComplete((r, e) -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line">                s.completeExceptionally(e);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// (4) Pub/Sub 구독 상태 관리 및 실패 처리</span></span><br><span class="line">        s.whenComplete((r, e) -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.entries.remove(entryName);</span><br><span class="line">                value.getPromise().completeExceptionally(e);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (!value.getPromise().complete(value) &amp;&amp; value.getPromise().isCompletedExceptionally()) &#123;</span><br><span class="line">                    <span class="keyword">this</span>.entries.remove(entryName);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>lock key(entryName)</code>로 Pub/Sub 채널을 확인하거나 생성한다.<ul>
<li><code>entries</code> 맵에서 <code>entryName</code>에 해당하는 채널을 가져오고, 이미 존재하면 재사용한다.</li>
<li>채널이 없을 경우 새로 생성해 등록한다.</li>
</ul>
</li>
</ul>
<p><strong>(1) 기존 채널이 있는 경우:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">entry.acquire();</span><br><span class="line">semaphore.release();</span><br><span class="line">entry.getPromise().whenComplete((r, e) -&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line">        newPromise.completeExceptionally(e);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        newPromise.complete(r);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>entry.acquire()를 호출해 채널을 재사용한다.</li>
<li>이후 semaphore.release()로 채널 구독을 위한 락을 해제한다.</li>
<li>작업 완료 시 entry.getPromise()로 결과를 처리한다.</li>
</ul>
<p><strong>(2) 새 채널을 생성하는 경우:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">E value = <span class="keyword">this</span>.createEntry(newPromise);</span><br><span class="line">value.acquire();</span><br><span class="line">E oldValue = (PubSubEntry)<span class="keyword">this</span>.entries.putIfAbsent(entryName, value);</span><br><span class="line"><span class="keyword">if</span> (oldValue != <span class="keyword">null</span>) &#123;</span><br><span class="line">    oldValue.acquire();</span><br><span class="line">    semaphore.release();</span><br><span class="line">    oldValue.getPromise().whenComplete((r, e) -&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line">            newPromise.completeExceptionally(e);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            newPromise.complete(r);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><code>createEntry(newPromise)</code>로 새로운 엔트리를 생성한다.</li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ConcurrentHashMap.html#putIfAbsent(K,V)">putIfAbsent(entryName, value)</a>를 통해 이미 생성된 엔트리가 있는지 확인한다.</li>
<li>기존 엔트리가 있으면 이를 사용하고, 없으면 새로 생성한 엔트리를 등록한다.</li>
</ul>
<p><strong>(3) Redis Pub/Sub 채널 연결:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">RedisPubSubListener&lt;Object&gt; listener = <span class="keyword">this</span>.createListener(channelName, value);</span><br><span class="line">CompletableFuture&lt;PubSubConnectionEntry&gt; s = <span class="keyword">this</span>.service.subscribeNoTimeout(LongCodec.INSTANCE, channelName, semaphore, <span class="keyword">new</span> RedisPubSubListener[]&#123;listener&#125;);</span><br><span class="line">newPromise.whenComplete((r, e) -&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line">        s.completeExceptionally(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><code>createListener(channelName, value)</code>를 통해 실제 Redis Pub/Sub 채널을 구독한다.</li>
<li><code>subscribeNoTimeout()</code>로 비동기적으로 연결을 시도한다.</li>
</ul>
<p><strong>(4) Pub/Sub 구독 상태 관리 및 실패 처리:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">s.whenComplete((r, e) -&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.entries.remove(entryName);</span><br><span class="line">        value.getPromise().completeExceptionally(e);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!value.getPromise().complete(value) &amp;&amp; value.getPromise().isCompletedExceptionally()) &#123;</span><br><span class="line">            <span class="keyword">this</span>.entries.remove(entryName);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>구독 실패 처리:</strong><ul>
<li><code>e != null</code> 조건은 Pub/Sub 구독 중 예외가 발생했음을 의미한다.</li>
<li>실패한 경우, 다음 작업을 수행한다:<ul>
<li><code>this.entries.remove(entryName)</code>: 실패한 구독에 해당하는 <code>entryName</code>을 <code>entries</code> 맵에서 제거한다.</li>
<li><code>value.getPromise().completeExceptionally(e)</code>: 예외를 호출자에게 전달하여 구독 실패 원인을 알린다.</li>
</ul>
</li>
</ul>
</li>
<li><strong>구독 성공 상태 관리:</strong><ul>
<li>구독이 성공적으로 완료되었더라도, 추가적인 상태 확인을 수행한다:</li>
<li><code>value.getPromise().complete(value)</code>: <code>value</code>를 <code>Promise</code>로 완료하고 성공 여부를 반환한다.</li>
<li><code>Promise</code>가 이미 완료되었거나(<code>isCompletedExceptionally</code>로 확인) 정상적으로 완료되지 않은 경우:<ul>
<li><code>this.entries.remove(entryName)</code>: 일관성을 유지하기 위해 해당 엔트리를 제거한다.</li>
</ul>
</li>
</ul>
</li>
<li><strong>상태 확인의 목적:</strong><ul>
<li>Redis Pub/Sub 구독 실패 및 이상 상태를 감지하고, 관련 자원을 정리하여 시스템 일관성을 보장한다.</li>
<li>실패나 이상 상태 시 적절한 정리 작업이 이루어지도록 설계되어 있다.</li>
</ul>
</li>
</ul>
<h3 id="c-락에-대한-Pub-Sub-채널-구독-정리"><a href="#c-락에-대한-Pub-Sub-채널-구독-정리" class="headerlink" title="c. 락에 대한 Pub/Sub 채널 구독 정리"></a>c. 락에 대한 Pub/Sub 채널 구독 정리</h3><p><strong>1. Semaphore 생성 및 acquire 호출</strong></p>
<ul>
<li><code>AsyncSemaphore</code>는 채널 단위의 subscribe 작업에 대한 동시성을 제어한다.</li>
<li><code>acquire()</code> 호출 시, 내부적으로 대기 큐가 생성되어 락이 해제될 때 대기 중인 작업이 순차적으로 처리된다.</li>
<li>이를 통해 여러 스레드가 동일한 채널에 대해 동시에 subscribe 요청을 보내더라도 안전하게 작업이 처리된다.</li>
<li>작업 완료 상태(<code>newPromise.isDone()</code>) 확인 후, 이미 완료된 작업에 대한 락을 해제한다.</li>
</ul>
<p><strong>2. Pub/Sub 채널 확인 및 생성</strong></p>
<ul>
<li>entries 맵에서 entryName에 해당하는 채널을 가져오고, 이미 존재하면 이를 재사용한다.</li>
<li>존재하지 않을 경우:<ul>
<li><code>createEntry(newPromise)</code>로 새로운 엔트리를 생성하여 등록한다.</li>
<li><code>putIfAbsent(entryName, value)</code>를 통해 중복 등록을 방지하고, 기존 엔트리가 있으면 이를 재사용한다.</li>
<li>기존 엔트리와 새 엔트리는 동일한 처리 로직으로 이어지며, 작업이 완료되면 결과를 호출자에게 전달한다.</li>
</ul>
</li>
</ul>
<p><strong>3. Redis Pub/Sub 채널 연결</strong></p>
<ul>
<li>새로운 엔트리에 대해 <code>createListener(channelName, value)</code>를 통해 Redis Pub/Sub 채널을 구독한다.</li>
<li><code>subscribeNoTimeout()</code> 를 사용하여 비동기적으로 구독을 시도한다.</li>
<li>구독 중 예외 발생 시, 구독 결과를 처리하는 <code>CompletableFuture</code>에 예외 상태를 전달한다.</li>
</ul>
<p><strong>4. Pub/Sub 구독 상태 관리 및 실패 처리</strong></p>
<ul>
<li>Pub/Sub 구독이 성공했는지 여부를 확인하고, 실패 또는 이상 상태가 발생하면 관련 자원을 정리한다:<ul>
<li><code>e != null(구독 실패)</code>일 경우:<ul>
<li>entries 맵에서 해당 entryName을 제거한다.</li>
<li><code>value.getPromise().completeExceptionally(e)</code>로 구독 실패 원인을 호출자에게 전달한다.</li>
</ul>
</li>
<li>구독이 성공했더라도:<ul>
<li><code>value.getPromise().complete(value)</code> 호출로 성공 여부를 확인한다.</li>
<li>성공하지 못했거나(<code>isCompletedExceptionally</code>) 예외 상태라면, entries에서 해당 엔트리를 제거한다.</li>
</ul>
</li>
</ul>
</li>
<li>이를 통해 시스템의 데이터 일관성을 유지하고, 자원 누수를 방지한다.</li>
</ul>
<p>결과적으로</p>
<ul>
<li><code>Semaphore</code>를 사용해 subscribe 요청의 동시성을 관리한다.</li>
<li>Pub/Sub 채널의 상태를 확인하거나 생성하고, Redis 채널과 비동기적으로 연결한다.</li>
<li>구독 성공 및 실패 상태를 처리하고, 필요시 자원을 정리하여 시스템의 안정성을 보장한다.</li>
</ul>
<p>여기까지가 락 이벤트를 감지하기 위한 Pub/Sub 채널에 구독하기 위한 로직이다. </p>
<h3 id="4-락-획득-재시도-및-Latch-대기-로직"><a href="#4-락-획득-재시도-및-Latch-대기-로직" class="headerlink" title="4. 락 획득 재시도 및 Latch 대기 로직"></a>4. 락 획득 재시도 및 Latch 대기 로직</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">long</span> currentTime = System.currentTimeMillis();</span><br><span class="line">    ttl = <span class="keyword">this</span>.tryAcquire(waitTime, leaseTime, unit, threadId);</span><br><span class="line">    <span class="keyword">if</span> (ttl == <span class="keyword">null</span>) &#123;</span><br><span class="line">        var16 = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">return</span> var16;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    time -= System.currentTimeMillis() - currentTime;</span><br><span class="line">    <span class="keyword">if</span> (time &lt;= <span class="number">0L</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.acquireFailed(waitTime, unit, threadId);</span><br><span class="line">        var16 = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">return</span> var16;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    currentTime = System.currentTimeMillis();</span><br><span class="line">    <span class="keyword">if</span> (ttl &gt;= <span class="number">0L</span> &amp;&amp; ttl &lt; time) &#123;</span><br><span class="line">        ((RedissonLockEntry)<span class="keyword">this</span>.commandExecutor.getNow(subscribeFuture)).getLatch().tryAcquire(ttl, TimeUnit.MILLISECONDS);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        ((RedissonLockEntry)<span class="keyword">this</span>.commandExecutor.getNow(subscribeFuture)).getLatch().tryAcquire(time, TimeUnit.MILLISECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    time -= System.currentTimeMillis() - currentTime;</span><br><span class="line">&#125; <span class="keyword">while</span>(time &gt; <span class="number">0L</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>.acquireFailed(waitTime, unit, threadId);</span><br><span class="line">var16 = <span class="keyword">false</span>;</span><br></pre></td></tr></table></figure>

<p><strong>a. 락 획득 재시도</strong></p>
<ul>
<li>Pub/Sub 채널 구독이 성공한 상태에서 다시 tryAcquire를 반복 호출해 락 획득을 재시도한다.</li>
<li><code>ttl == null</code>일 경우, 즉시 락을 획득할 수 있으므로 true를 반환하며 종료한다.</li>
</ul>
<p><strong>b. 남은 시간 갱신</strong></p>
<ul>
<li>락 획득을 재시도하기 전에 현재 시간을 기준으로 남은 대기 시간을 갱신한다(<code>time -= ...</code>).</li>
<li>남은 대기 시간이 없으면(<code>time &lt;= 0</code>), <code>acquireFailed()</code> 를 호출해 실패 처리를 진행한 후 <code>false</code>를 반환한다.</li>
</ul>
<p><strong>c. Latch 대기</strong></p>
<ul>
<li><code>ttl</code> 값에 따라 <code>Latch</code>를 사용해 일정 시간 대기한다.<ul>
<li><code>ttl &gt;= 0</code><strong>인 경우</strong>: 락 해제까지의 남은 시간 동안 대기한다.</li>
<li><code>ttl &lt; 0</code> <strong>또는 현재 남은 시간 이하인 경우</strong>: 설정된 대기 시간까지 대기한다.</li>
<li><code>Latch</code>는 <code>다른 스레드/프로세스가 락을 해제하거나 갱신하는 이벤트</code>가 발생하면 해제되는 동기화 장치로 사용되며, Redisson에서는 <code>Semaphore</code>를 Latch를 사용한다.</li>
</ul>
</li>
</ul>
<p><strong>d. 반복 조건</strong></p>
<ul>
<li><code>do-while</code> 루프를 통해 남은 대기 시간이 소진될 때까지 락 획득을 반복 시도한다.</li>
<li>대기 시간이 소진되면 <code>acquireFailed()</code>를 호출하고 <code>false</code>를 반환하며 종료한다.</li>
</ul>
<h3 id="5-구독-해제"><a href="#5-구독-해제" class="headerlink" title="5. 구독 해제"></a>5. 구독 해제</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.unsubscribe((RedissonLockEntry)<span class="keyword">this</span>.commandExecutor.getNow(subscribeFuture), threadId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Pub/Sub 채널을 구독했으므로, 메서드를 종료하기 전에 반드시 unsubscribe 메서드를 호출해 리소스를 해제한다.</li>
<li>이는 락 획득 여부와 관계없이 실행되며, Pub/Sub 구독을 통해 사용된 자원을 정리하는 역할을 한다.</li>
</ul>
<hr>
<h2 id="tryLock-의-장점-및-한계"><a href="#tryLock-의-장점-및-한계" class="headerlink" title="tryLock()의 장점 및 한계"></a>tryLock()의 장점 및 한계</h2><h3 id="장점"><a href="#장점" class="headerlink" title="장점"></a>장점</h3><ol>
<li><p>효율적인 이벤트 기반 처리</p>
<ul>
<li>Pub/Sub 메커니즘을 활용하여 락 해제 이벤트를 감지함으로써, 불필요한 대기 시간을 최소화한다.</li>
<li>락이 해제될 가능성이 있는 경우 반복적으로 대기하거나 재시도하지 않고 이벤트 기반으로 처리하므로 자원을 효율적으로 사용한다.</li>
</ul>
</li>
<li><p>정교한 타이머 관리</p>
<ul>
<li>남은 대기 시간을 지속적으로 갱신하며, 설정된 제한 시간 내에 락 획득 여부를 결정한다.</li>
<li>대기 시간이 초과될 경우 즉시 실패 처리를 진행하므로, 클라이언트 응답 지연을 방지한다.</li>
</ul>
</li>
<li><p>안정적인 자원 정리</p>
<ul>
<li>락 획득 여부와 관계없이 finally 블록을 통해 모든 구독 리소스를 해제하여 시스템 자원의 안정성을 유지한다.</li>
</ul>
</li>
<li><p>Latch를 활용한 동기화</p>
<ul>
<li>락 획득 시도가 실패하더라도, Latch를 통해 TTL 동안 대기하며 락 해제 가능성을 최대한 활용한다.</li>
</ul>
</li>
</ol>
<h3 id="한계"><a href="#한계" class="headerlink" title="한계"></a>한계</h3><ol>
<li><p>락 획득 시도와 Pub/Sub의 비동기 처리 간의 간격</p>
<ul>
<li><p>락 획득 재시도와 Pub/Sub 이벤트 처리 사이의 간격에서 <code>레이스 컨디션</code>이 발생할 가능성이 있다. 락이 해제된 후 새로 락이 설정되는 순간에 간격이 생길 수 있으므로, 타이밍에 민감한 경우 신중한 설계가 필요하다.</p>
<details>
<summary>레이스 컨디션 발생 원인</summary>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">long</span> currentTime = System.currentTimeMillis();</span><br><span class="line">    ttl = <span class="keyword">this</span>.tryAcquire(waitTime, leaseTime, unit, threadId);</span><br><span class="line">    <span class="keyword">if</span> (ttl == <span class="keyword">null</span>) &#123;</span><br><span class="line">        var16 = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">return</span> var16;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    time -= System.currentTimeMillis() - currentTime;</span><br><span class="line">    <span class="keyword">if</span> (time &lt;= <span class="number">0L</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.acquireFailed(waitTime, unit, threadId);</span><br><span class="line">        var16 = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">return</span> var16;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    currentTime = System.currentTimeMillis();</span><br><span class="line">    <span class="keyword">if</span> (ttl &gt;= <span class="number">0L</span> &amp;&amp; ttl &lt; time) &#123;</span><br><span class="line">        ((RedissonLockEntry)<span class="keyword">this</span>.commandExecutor.getNow(subscribeFuture)).getLatch().tryAcquire(ttl, TimeUnit.MILLISECONDS);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        ((RedissonLockEntry)<span class="keyword">this</span>.commandExecutor.getNow(subscribeFuture)).getLatch().tryAcquire(time, TimeUnit.MILLISECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    time -= System.currentTimeMillis() - currentTime;</span><br><span class="line">&#125; <span class="keyword">while</span>(time &gt; <span class="number">0L</span>);</span><br></pre></td></tr></table></figure>

<p><strong>a. 첫 번째 tryAcquire 호출</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ttl = <span class="keyword">this</span>.tryAcquire(waitTime, leaseTime, unit, threadId);</span><br></pre></td></tr></table></figure>

<ul>
<li>현재 스레드에서 락을 획득하려 시도하지만, 락이 이미 다른 스레드에 의해 점유된 상태라 TTL(남은 유효 시간)을 반환받는다.</li>
<li>이 시점에서 현재 스레드는 락 해제 이벤트를 기다릴 준비한다.</li>
</ul>
<p><strong>b. 락 반납 발생</strong></p>
<ul>
<li>락을 점유하고 있던 스레드(또는 프로세스)가 락을 반납한다.</li>
<li>이 시점에서 락은 잠깐 동안 해제된 상태가 된다.</li>
</ul>
<p><strong>c. 다른 스레드가 락을 채감</strong></p>
<ul>
<li>락 해제 이벤트가 Pub/Sub를 통해 현재 스레드에 전달되기 전에, 다른 스레드가 <code>tryAcquire()</code>를 호출하여 락을 빠르게 획득한다.</li>
<li>이로 인해 현재 스레드는 락 해제 이벤트를 감지하지 못하게 된다.</li>
</ul>
<p><strong>d. 현재 스레드의 Pub/Sub 대기</strong></p>
   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">((RedissonLockEntry) <span class="keyword">this</span>.commandExecutor.getNow(subscribeFuture))</span><br><span class="line">.getLatch().tryAcquire(ttl, TimeUnit.MILLISECONDS);</span><br></pre></td></tr></table></figure>

<ul>
<li>현재 스레드는 여전히 락 해제 이벤트를 기다리지만, 락은 이미 다른 스레드에 의해 점유된 상태이다.</li>
<li>이로 인해 현재 스레드는 대기 시간을 낭비하거나, 최종적으로 time이 초과되어 락 획득에 실패할 수 있다.


</li>
</ul>
</details></li>
</ul>
</li>
</ol>
<ol start="2">
<li><p>Pub/Sub 메시지 손실 가능성</p>
<ul>
<li>Pub/Sub 시스템 특성상 구독자와 퍼블리셔 간 네트워크 이슈가 발생하면 락 해제 메시지를 놓칠 가능성이 있다. 이 경우 락을 획득하지 못하고 대기 시간을 낭비할 위험이 있다.</li>
</ul>
</li>
<li><p>복잡한 로직으로 인한 디버깅 난이도</p>
<ul>
<li>tryLock()의 로직이 복잡하여, 장애 발생 시 원인을 파악하거나 디버깅하는 데 시간이 소요될 수 있다.</li>
</ul>
</li>
</ol>
<h2 id="결론"><a href="#결론" class="headerlink" title="결론"></a>결론</h2><p>Redisson의 <code>tryLock()</code>은 분산 환경에서 동시성 제어를 효과적으로 구현하기 위해 설계된 복잡한 로직을 제공한다.</p>
<p><code>tryLock()</code>은 동시성 제어에서 효율성과 안정성을 동시에 추구하는 설계로, 분산 환경에서의 락 처리 문제를 효과적으로 해결한다. 그러나 복잡한 로직 구조와 Pub/Sub 시스템의 특성을 고려하여 사용 환경에 적합한 설정을 적용하고, 잠재적인 한계를 관리할 수 있는 보완책을 함께 설계해야 한다.</p>
<p>본 글이 <code>tryLock()</code> 내부 로직에 대한 깊은 이해를 돕고, 동시성 제어가 필요한 시스템 설계 시 참고 자료가 되길 바라며, 실제적으로 Redisson을 활용하여 분산락을 적용하고자 하는 사용자는 이전 글 <a href="https://jungguji.github.io/2024/12/24/%EB%8F%99%EC%8B%9C%EC%84%B1-%EC%9D%B4%EC%8A%88%EC%99%80-Redis-Redisson-%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%ED%95%B4%EA%B2%B0%EB%B0%A9%EB%B2%95/">동시성 이슈와 Redis( Redisson )를 이용한 해결방법</a>을 참고하길 바란다.</p>

                    
                        


                    
                    
                        <p>
                            <a href="/2025/01/09/%EB%8F%99%EC%8B%9C%EC%84%B1-%EC%A0%9C%EC%96%B4%EB%A5%BC-%EC%9C%84%ED%95%9C-Redisson-tryLock-%EB%A9%94%EC%84%9C%EB%93%9C%EC%9D%98-%EC%9E%91%EB%8F%99-%EC%9B%90%EB%A6%AC/#post-footer" class="postShorten-excerpt_link link" aria-label>
                                댓글 공유
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2024/12/24/%EB%8F%99%EC%8B%9C%EC%84%B1-%EC%9D%B4%EC%8A%88%EC%99%80-Redis-Redisson-%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%ED%95%B4%EA%B2%B0%EB%B0%A9%EB%B2%95/" aria-label=": 동시성 이슈와 Redis( Redisson )를 이용한 해결방법">
                            동시성 이슈와 Redis( Redisson )를 이용한 해결방법
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2024-12-24T12:26:46+09:00">
	
		    2024/12/24
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="도입"><a href="#도입" class="headerlink" title="도입"></a>도입</h2><p>동시성 제어는 여러 사용자가 동시에 시스템을 사용할 때 발생할 수 있는 데이터 무결성과 성능 문제를 해결하는 데 중요한 역할을 한다. 본 글은 Redis와 Redisson 라이브러리를 활용하여 분산 환경에서 발생하는 동시성 이슈를 해결하기 위한 방안을 탐구하고자 한다. 본 글에서는 사내에서 발생했던 동시성 문제와 비슷한 상황을 예시 코드로 재현하여 문제를 정의하고, 이를 해결하기 위한 방법을 설명한다.</p>
<hr>
<h2 id="이론적-배경"><a href="#이론적-배경" class="headerlink" title="이론적 배경"></a>이론적 배경</h2><ol>
<li>동시성 제어와 분산 락의 중요성<ul>
<li>동시성 이슈는 분산 환경에서 동일한 데이터에 여러 프로세스가 동시에 접근할 때 발생한다. 이를 해결하기 위해 락(lock) 메커니즘이 널리 사용된다.</li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://ko.wikipedia.org/wiki/%EB%9D%BD_(%EC%BB%B4%ED%93%A8%ED%84%B0_%EA%B3%BC%ED%95%99)">일반적인 락(mutex lock, spin lock 등)</a>은 단일 시스템 내에서만 작동하며, 분산 락은 여러 시스템 간의 경쟁 상태를 관리한다.<ul>
<li>단일 시스템의 예로는 하나의 WAS(Tomcat)에서 실행되는 애플리케이션이 있고, 이 환경에서는 스레드 간의 동기화가 주로 필요하다.</li>
<li>여러 시스템의 예로는 여러 개의 WAS(Tomcat) 인스턴스가 로드 밸런서를 통해 분산 처리하는 환경이 있으며, 이러한 경우 서버 간 데이터 동기화를 위한 분산 락이 필요하다.</li>
</ul>
</li>
</ul>
</li>
</ol>
<ol start="2">
<li>Redis와 Redisson<ul>
<li>Redis는 인메모리 데이터베이스로 높은 처리 속도와 다양한 데이터 구조를 지원한다. 이를 활용한 분산 락 구현은 효율적인 동시성 제어를 제공한다.</li>
<li>Redisson은 Redis 클라이언트 라이브러리로, 분산 락을 포함한 다양한 동시성 제어 기능을 제공한다.</li>
</ul>
</li>
</ol>
<h2 id="연구방법"><a href="#연구방법" class="headerlink" title="연구방법"></a>연구방법</h2><p><strong>1. 문제 정의</strong></p>
<ul>
<li>챗봇 대화 서비스를 운영중이었고, 유저가 챗봇과 대화 시 대화에 필요한 서비스 내 재화가 소모 되는 방식이었다.</li>
<li>서버 구조는 다음과 같았다:     <ul>
<li>메시지큐를 이용해 채팅 서버로 메시지를 전달하고, 답장 서버에서 답장을 메시지큐를 통해 다시 수신하여 처리하는 구조였다.<img src="/2024/12/24/%EB%8F%99%EC%8B%9C%EC%84%B1-%EC%9D%B4%EC%8A%88%EC%99%80-Redis-Redisson-%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%ED%95%B4%EA%B2%B0%EB%B0%A9%EB%B2%95/1.png" class></li>
<li>답장 서버는 8대가 운영 중이었고, 유저는 동시에 여러 챗봇과 대화가 가능했다.</li>
<li>메시지큐에 동일한 유저가 여러 챗봇과의 대화를 진행하며 생성된 메시지가 각각 저장되고, 여러 서버에서 이러한 메시지를 동시에 처리하면서 동시성 문제가 발생하여, 유저가 소비해야 하는 재화가 올바르게 차감되지 않는 현상이 나타났다.</li>
<li>이를 재현하기 위해 아래와 같은 코드를 작성하여 실험을 설계하였다.</li>
</ul>
</li>
</ul>
<p><strong>2. 실험 설계</strong></p>
<ul>
<li>문제를 재현하기 위해 아래 코드를 작성하여 실험을 설계하였다.<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title">consumeResource</span><span class="params">(<span class="keyword">int</span> userId)</span> </span>&#123;</span><br><span class="line">     Optional&lt;User&gt; userOpt = resourceRepository.findById(userId);</span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">         Thread.sleep(<span class="number">100</span>); <span class="comment">// 로직 수행에 100ms가 걸린다고 가정하고, 100ms 지연</span></span><br><span class="line">     &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">         Thread.currentThread().interrupt();</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     User user = userOpt.get();</span><br><span class="line">     user.consumeResource(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">     resourceRepository.save(user);</span><br><span class="line">     log.info(<span class="string">&quot;User &#123;&#125; 자원 1 사용, 남은 자원: &#123;&#125;&quot;</span>, userId, user.getRemainingResources());</span><br><span class="line">     <span class="keyword">return</span> ResponseEntity.ok(<span class="string">&quot;자원 소비. 남은 자원: &quot;</span> + user.getRemainingResources());</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>자원 소비 중 동시성 문제가 발생하는 현상을 확인하기 위한 예시 코드로, 여러 스레드에서 동일한 유저의 데이터를 동시에 처리할 경우 재화가 예상보다 적게 차감되는 동작을 확인하였다.</li>
<li>이 코드는 단일 시스템에서 동작하는 코드로, 분산 락이 아닌 일반적인 락으로도 해결할 수 있는 상황이다. 하지만 실제 문제와 동일하게 여러 스레드나 서버가 하나의 자원에 동시 접근하는 상황을 재현할 수 있으므로, 실험 결과의 신뢰성에는 문제가 없을 것으로 보인다.</li>
</ul>
</li>
</ul>
<p><strong>2.1. 실험 결과</strong></p>
<ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/wg/wrk">wrk</a>를 사용하여 동일 자원에 대해 다수의 요청을 보냈으며, 다음과 같은 결과가 확인되었다.</li>
<li><img src="/2024/12/24/%EB%8F%99%EC%8B%9C%EC%84%B1-%EC%9D%B4%EC%8A%88%EC%99%80-Redis-Redisson-%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%ED%95%B4%EA%B2%B0%EB%B0%A9%EB%B2%95/2.png" class></li>
<li><details>
<summary>테스트에 사용된 lua script</summary>
 <figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 요청 수 제한</span></span><br><span class="line"><span class="keyword">local</span> max_requests = <span class="number">10</span> <span class="comment">-- 요청 수 제한</span></span><br><span class="line"><span class="keyword">local</span> request_count = <span class="number">0</span> <span class="comment">-- 현재 요청 수</span></span><br><span class="line"></span><br><span class="line">request = <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">   <span class="keyword">if</span> request_count &gt;= max_requests <span class="keyword">then</span></span><br><span class="line">      wrk.thread:stop() <span class="comment">-- 요청 제한에 도달하면 쓰레드 중지</span></span><br><span class="line">   <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">   request_count = request_count + <span class="number">1</span></span><br><span class="line">   <span class="keyword">local</span> user_id = <span class="number">1</span></span><br><span class="line">   <span class="keyword">local</span> <span class="built_in">path</span> = <span class="string">&quot;/resources/&quot;</span> .. user_id .. <span class="string">&quot;/consume&quot;</span></span><br><span class="line">   <span class="keyword">return</span> wrk.<span class="built_in">format</span>(<span class="string">&quot;POST&quot;</span>, <span class="built_in">path</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</details></li>
<li><strong>실험 명령어:</strong> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wrk -t5 -c20 -d1s -s test_consume.lua http://localhost:8080</span><br></pre></td></tr></table></figure></li>
<li><strong>실험 결과 요약:</strong><ul>
<li>로그에서 동일 자원에 대해 여러 요청이 동시에 처리되며 자원의 남은 개수가 정확히 감소하지 않는 현상이 나타났다.</li>
<li>이는 요청 간 자원 상태가 정확히 반영되지 않고 동일한 초기 상태로 처리된 결과이다.</li>
<li>예를 들어, 로그에서 “User 1 자원 1 사용, 남은 자원: 9”가 반복 출력되었으며, 이후 일부 요청만 자원이 감소된 상태를 올바르게 반영하였다.</li>
</ul>
</li>
<li><strong>문제 분석:</strong><ul>
<li>요청이 짧은 시간에 집중적으로 발생하며, 트랜잭션 커밋이 완료되기 전에 다른 요청이 동일 자원의 상태를 조회하고 처리하였다.</li>
<li>이러한 동시성 이슈는 예시 코드에서 자원 접근 시 락을 사용하지 않았기 때문에 발생한 것으로 보인다.</li>
<li>결과적으로, 여러 요청이 자원을 중복해서 처리하며 데이터의 무결성이 훼손되었다.</li>
</ul>
</li>
</ul>
<p><strong>3. 문제 해결</strong></p>
<ul>
<li><p><strong>분산 락 설계:</strong></p>
<ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://redisson.org/docs/data-and-services/locks-and-synchronizers/#lock">Redisson</a>의 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://javadoc.io/doc/org.redisson/redisson/latest/org/redisson/api/RLock.html">tryLock</a> 메서드를 활용하여 특정 리소스에 대한 락을 획득한다.</li>
<li>락 획득에 실패한 요청은 대기하거나 재시도하도록 구현한다.<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;&#123;userId&#125;/consume&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title">consumeResource</span><span class="params">(<span class="meta">@PathVariable(&quot;userId&quot;)</span> <span class="keyword">int</span> userId)</span> </span>&#123;</span><br><span class="line">   String lockName = <span class="string">&quot;user:&quot;</span> + userId + <span class="string">&quot;:resource:lock&quot;</span>;</span><br><span class="line"></span><br><span class="line">   RLock lock = redissonClient.getLock(lockName);</span><br><span class="line">   <span class="keyword">int</span> remainingResources = <span class="number">0</span>;</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">         <span class="keyword">boolean</span> isLocked = lock.tryLock(<span class="number">3</span>, <span class="number">10</span>, TimeUnit.SECONDS);</span><br><span class="line"></span><br><span class="line">         <span class="keyword">if</span> (isLocked) &#123;</span><br><span class="line">            remainingResources = resourceService.consumeResource(userId);</span><br><span class="line">         &#125;</span><br><span class="line">   &#125; <span class="keyword">catch</span> (RuntimeException | InterruptedException e) &#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;Lock 획득 실패&quot;</span>, e);</span><br><span class="line">   &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">         <span class="keyword">if</span> (lock.isHeldByCurrentThread()) &#123; <span class="comment">// 락 소유 여부 확인</span></span><br><span class="line">            lock.unlock();</span><br><span class="line">         &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> ResponseEntity.ok(<span class="string">&quot;자원 소비. 남은 자원: &quot;</span> + remainingResources);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>락 해제 매커니즘:</strong><br> Redisson 내부적으로 락을 관리하고 해제하는 메커니즘은 Redis Pub/Sub 시스템과 AsyncSemaphore를 활용하여 다음과 같은 방식으로 동작한다:</p>
 <details>
    <summary>Redisson tryLock() Code</summary>
       <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryLock</span><span class="params">(<span class="keyword">long</span> waitTime, <span class="keyword">long</span> leaseTime, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">   <span class="keyword">long</span> time = unit.toMillis(waitTime);</span><br><span class="line">   <span class="keyword">long</span> current = System.currentTimeMillis();</span><br><span class="line">   <span class="keyword">long</span> threadId = Thread.currentThread().getId();</span><br><span class="line">   <span class="comment">// 1. 최초 락 획득 시도</span></span><br><span class="line">   Long ttl = <span class="keyword">this</span>.tryAcquire(waitTime, leaseTime, unit, threadId);</span><br><span class="line">   <span class="keyword">if</span> (ttl == <span class="keyword">null</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="comment">// 2. 타이머 갱신 및 대기</span></span><br><span class="line">         time -= System.currentTimeMillis() - current;</span><br><span class="line">         <span class="keyword">if</span> (time &lt;= <span class="number">0L</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.acquireFailed(waitTime, unit, threadId);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">         &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            current = System.currentTimeMillis();</span><br><span class="line">            <span class="comment">// 3. Pub/Sub 채널 구독</span></span><br><span class="line">            CompletableFuture&lt;RedissonLockEntry&gt; subscribeFuture = <span class="keyword">this</span>.subscribe(threadId);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">               subscribeFuture.get(time, TimeUnit.MILLISECONDS);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (TimeoutException var21) &#123;</span><br><span class="line">               <span class="keyword">if</span> (!subscribeFuture.completeExceptionally(<span class="keyword">new</span> RedisTimeoutException(<span class="string">&quot;Unable to acquire subscription lock after &quot;</span> + time + <span class="string">&quot;ms. Try to increase &#x27;subscriptionsPerConnection&#x27; and/or &#x27;subscriptionConnectionPoolSize&#x27; parameters.&quot;</span>))) &#123;</span><br><span class="line">                     subscribeFuture.whenComplete((res, ex) -&gt; &#123;</span><br><span class="line">                        <span class="keyword">if</span> (ex == <span class="keyword">null</span>) &#123;</span><br><span class="line">                           <span class="keyword">this</span>.unsubscribe(res, threadId);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                     &#125;);</span><br><span class="line">               &#125;</span><br><span class="line"></span><br><span class="line">               <span class="keyword">this</span>.acquireFailed(waitTime, unit, threadId);</span><br><span class="line">               <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ExecutionException var22) &#123;</span><br><span class="line">               ExecutionException e = var22;</span><br><span class="line">               LOGGER.error(e.getMessage(), e);</span><br><span class="line">               <span class="keyword">this</span>.acquireFailed(waitTime, unit, threadId);</span><br><span class="line">               <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">               time -= System.currentTimeMillis() - current;</span><br><span class="line">               <span class="keyword">if</span> (time &lt;= <span class="number">0L</span>) &#123;</span><br><span class="line">                     <span class="keyword">this</span>.acquireFailed(waitTime, unit, threadId);</span><br><span class="line">                     <span class="keyword">boolean</span> var25 = <span class="keyword">false</span>;</span><br><span class="line">                     <span class="keyword">return</span> var25;</span><br><span class="line">               &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                     <span class="keyword">boolean</span> var16;</span><br><span class="line">                     <span class="keyword">do</span> &#123;</span><br><span class="line">                        <span class="keyword">long</span> currentTime = System.currentTimeMillis();</span><br><span class="line">                        ttl = <span class="keyword">this</span>.tryAcquire(waitTime, leaseTime, unit, threadId);</span><br><span class="line">                        <span class="keyword">if</span> (ttl == <span class="keyword">null</span>) &#123;</span><br><span class="line">                           var16 = <span class="keyword">true</span>;</span><br><span class="line">                           <span class="keyword">return</span> var16;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        time -= System.currentTimeMillis() - currentTime;</span><br><span class="line">                        <span class="keyword">if</span> (time &lt;= <span class="number">0L</span>) &#123;</span><br><span class="line">                           <span class="keyword">this</span>.acquireFailed(waitTime, unit, threadId);</span><br><span class="line">                           var16 = <span class="keyword">false</span>;</span><br><span class="line">                           <span class="keyword">return</span> var16;</span><br><span class="line">                        &#125;</span><br><span class="line">                        </span><br><span class="line">                        <span class="comment">// 4. Latch 대기와 재시도</span></span><br><span class="line">                        currentTime = System.currentTimeMillis();</span><br><span class="line">                        <span class="keyword">if</span> (ttl &gt;= <span class="number">0L</span> &amp;&amp; ttl &lt; time) &#123;</span><br><span class="line">                           ((RedissonLockEntry)<span class="keyword">this</span>.commandExecutor.getNow(subscribeFuture)).getLatch().tryAcquire(ttl, TimeUnit.MILLISECONDS);</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                           ((RedissonLockEntry)<span class="keyword">this</span>.commandExecutor.getNow(subscribeFuture)).getLatch().tryAcquire(time, TimeUnit.MILLISECONDS);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        time -= System.currentTimeMillis() - currentTime;</span><br><span class="line">                     &#125; <span class="keyword">while</span>(time &gt; <span class="number">0L</span>);</span><br><span class="line"></span><br><span class="line">                     <span class="keyword">this</span>.acquireFailed(waitTime, unit, threadId);</span><br><span class="line">                     var16 = <span class="keyword">false</span>;</span><br><span class="line">                     <span class="keyword">return</span> var16;</span><br><span class="line">               &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">               <span class="comment">// 5. 구독 해제</span></span><br><span class="line">               <span class="keyword">this</span>.unsubscribe((RedissonLockEntry)<span class="keyword">this</span>.commandExecutor.getNow(subscribeFuture), threadId);</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </details>

<p> <strong>1. 최초 락 획득 시도</strong></p>
<ul>
<li>tryAcquire 메서드를 통해 락 획득 가능 여부를 확인하며, null을 반환하면 현재 락을 바로 획득할 수 있음을 의미한다.</li>
<li>락이 이미 선점된 경우, ttl(잠금의 남은 유효 시간)을 반환하여 대기할 시간을 계산한다.</li>
</ul>
<p> <strong>2. 타이머 갱신 및 대기</strong></p>
<ul>
<li>대기 중 경과된 시간을 waitTime에서 차감하며 남은 시간이 0 이하일 경우 대기를 종료하고 false를 반환한다.</li>
</ul>
<p> <strong>3. Pub/Sub 채널 구독</strong></p>
<ul>
<li>락 해제 이벤트를 감지하기 위해 Redis Pub/Sub 채널에 구독을 요청한다.</li>
<li>subscribeFuture를 통해 락이 해제되었거나 구독에 실패한 경우 작업이 비동기적으로 처리된다.</li>
</ul>
<p> <strong>4. latch 대기와 재시도</strong></p>
<ul>
<li>Pub/Sub 채널 구독이 성공한 상태에서 tryAcquire를 반복 호출하며 락 획득을 재시도한다.</li>
<li>TTL 값에 따라 latch 대기 시간이 설정되며, 다른 스레드에서 락이 해제되면 latch가 해제되어 작업이 이어진다.</li>
</ul>
<p> <strong>5. 구독 해제</strong></p>
<ul>
<li>락을 획득하든 못 하든 메서드를 종료하기 전에 Pub/Sub 구독 리소스를 해제하여 시스템 자원을 정리한다.</li>
</ul>
</li>
</ul>
<p><strong>3.1. Redisson 적용 후 실험 결과:</strong></p>
<ul>
<li><p>2.1. 실험과 동일한 script와 wrk 명령어를 이용해 실험을 진행했으며, 다음과 같은 결과가 확인되었다.</p>
</li>
<li><img src="/2024/12/24/%EB%8F%99%EC%8B%9C%EC%84%B1-%EC%9D%B4%EC%8A%88%EC%99%80-Redis-Redisson-%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%ED%95%B4%EA%B2%B0%EB%B0%A9%EB%B2%95/4.png" class></li>
<li><p><strong>실험 결과 요약:</strong></p>
<ul>
<li>Redisson을 사용하여 분산 락을 적용한 결과, 모든 요청이 순차적으로 처리되었으며 데이터의 무결성이 유지되었다.</li>
<li>로그에서 확인할 수 있듯이 동일한 자원에 대해 락이 적용되어 요청이 병렬적으로 처리되지 않고 순차적으로 처리되었다.</li>
<li>예를 들어, “User 1 자원 1 사용, 남은 자원: 9”에서 시작하여 요청이 처리될 때마다 자원이 정확히 감소하는 모습을 확인할 수 있었다.</li>
<li>실험 중에는 잘못된 자원 감소나 동시성 문제가 발생하지 않았다.</li>
</ul>
</li>
<li><p><strong>문제 해결 확인:</strong></p>
<ul>
<li>Redisson의 분산 락을 적용함으로써 동시성 문제로 인한 데이터 무결성 훼손이 해결되었다.</li>
<li>요청량이 많을 때에도 대기 상태로 처리되며 자원의 상태가 정확히 갱신되었다.</li>
</ul>
</li>
</ul>
<h2 id="결과"><a href="#결과" class="headerlink" title="결과"></a>결과</h2><ul>
<li>테스트 결과<ul>
<li>Redisson 기반 분산 락을 적용한 후, 중복 트랜잭션 문제가 해결되었다.</li>
<li>부하 테스트(wrk)에서 동일한 유저의 데이터를 처리할 때, 데이터 무결성이 유지됨을 확인하였다.</li>
<li>이로써 분산 서버 환경에서 발생하던 자원 동시성 문제를 해결할 수 있었다.</li>
</ul>
</li>
</ul>
<hr>
<h2 id="논의"><a href="#논의" class="headerlink" title="논의"></a>논의</h2><p>Pub/Sub 기반 락 메커니즘은 성능과 자원 활용면에서 유리하며, 이를 사용하는 Redisson을 사용하여 분산 환경에서도 효율적으로 동시성 제어가 가능하지만,<br>Redis를 따로 구축하여야 한다는 점, Redis의 장애 시 락 메커니즘이 정상적으로 동작하지 않을 수 있다는 점과 락 해제 실패 또는 락 대기 시간 초과 시 추가적 오류 처리가 필요하다는 한계점 등이 존재한다.<br>해당 한계점들을 개선하기 위해 이후에 Redis Cluster를 활용해 고가용성을 확보하여야하고, Redis 외에 기타 다른 도구(Zookeeper, Etcd 등)와의 성능 비교가 필요하다.</p>
<h2 id="결론"><a href="#결론" class="headerlink" title="결론"></a>결론</h2><p>본 글에서는 Redis와 Redisson을 활용한 분산 락 메커니즘을 통해 동시성 이슈를 해결하는 방법을 제시하였다.<br>실험 결과, 제안된 방법은 데이터 무결성을 효과적으로 유지하며, 부하 테스트에서도 우수한 성능을 보였다.<br>본 글이 분산 환경에서의 동시성 문제를 해결하려는 개발자들에게 실질적인 가이드라인을 제공하길 기대하며, 본 글에서 사용된 <code>tryLock()</code>의 내부 작동원리는 <a href="https://jungguji.github.io/2025/01/09/%EB%8F%99%EC%8B%9C%EC%84%B1-%EC%A0%9C%EC%96%B4%EB%A5%BC-%EC%9C%84%ED%95%9C-Redisson-tryLock-%EB%A9%94%EC%84%9C%EB%93%9C%EC%9D%98-%EC%9E%91%EB%8F%99-%EC%9B%90%EB%A6%AC/">동시성 제어를 위한 Redisson tryLock 메서드의 작동 원리</a>에서 확인 할 수 있다.</p>

                    
                        


                    
                    
                        <p>
                            <a href="/2024/12/24/%EB%8F%99%EC%8B%9C%EC%84%B1-%EC%9D%B4%EC%8A%88%EC%99%80-Redis-Redisson-%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%ED%95%B4%EA%B2%B0%EB%B0%A9%EB%B2%95/#post-footer" class="postShorten-excerpt_link link" aria-label>
                                댓글 공유
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2024/11/19/%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%BD%94%EB%93%9C-%EC%9E%91%EC%84%B1%EC%9D%84-%EB%8D%94-%EC%89%BD%EA%B2%8C-with-Fixture-Monkey/" aria-label=": 테스트 코드 작성을 더 쉽게 (with. Fixture Monkey)">
                            테스트 코드 작성을 더 쉽게 (with. Fixture Monkey)
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2024-11-19T23:16:40+09:00">
	
		    2024/11/19
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="1-Fixture-Monkey란"><a href="#1-Fixture-Monkey란" class="headerlink" title="1. Fixture Monkey란?"></a>1. <strong>Fixture Monkey란?</strong></h1><p>Fixture Monkey는 네이버의 내부 프로젝트인 <strong>Plasma</strong>에서 복잡한 테스트 요구 사항을 해결하기 위해 개발된 도구로, 현재는 오픈 소스로 제공되어 Java와 Kotlin 환경에서 쉽게 적용할 수 있습니다. 이 라이브러리는 기존의 고정된 테스트 데이터 대신  복잡한 객체 타입의 테스트 데이터를 자동으로 생성하여 테스트 코드의 일관성과 효율성을 대폭 향상시킬 수 있는 도구입니다.</p>
<hr>
<h1 id="2-Fixture-Monkey-도입의-필요성"><a href="#2-Fixture-Monkey-도입의-필요성" class="headerlink" title="2. Fixture Monkey 도입의 필요성"></a>2. Fixture Monkey 도입의 필요성</h1><h2 id="1-클래스에-final-필드가-포함된-경우"><a href="#1-클래스에-final-필드가-포함된-경우" class="headerlink" title="1. 클래스에 final 필드가 포함된 경우"></a>1. 클래스에 final 필드가 포함된 경우</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String email;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String phoneNumber;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> isVerified;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LocalDateTime createdAt;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAgeCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">assert</span> <span class="keyword">this</span>.age &gt;= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.age &lt; <span class="number">18</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;청소년&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.age &lt; <span class="number">65</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;청년&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;시니어&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="문제점"><a href="#문제점" class="headerlink" title="문제점"></a>문제점</h3><ul>
<li>Member 클래스의 필드들이 모두 final로 선언되어 있기 때문에, 단순히 테스트에서 특정 메서드(getAgeCategory)만 검증하려 해도 불필요한 모든 데이터를 포함하여 객체를 생성해야 하는 문제가 있습니다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testGetAgeCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 청소년</span></span><br><span class="line">    Member minor = <span class="keyword">new</span> Member(<span class="number">1L</span>, <span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;alice@example.com&quot;</span>, <span class="string">&quot;123456789&quot;</span>, <span class="number">15</span>, <span class="keyword">true</span>, LocalDateTime.now());</span><br><span class="line">    assertEquals(<span class="string">&quot;청소년&quot;</span>, minor.getAgeCategory());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 청년</span></span><br><span class="line">    Member adult = <span class="keyword">new</span> Member(<span class="number">2L</span>, <span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;bob@example.com&quot;</span>, <span class="string">&quot;987654321&quot;</span>, <span class="number">30</span>, <span class="keyword">true</span>, LocalDateTime.now());</span><br><span class="line">    assertEquals(<span class="string">&quot;청년&quot;</span>, adult.getAgeCategory());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 시니어</span></span><br><span class="line">    Member senior = <span class="keyword">new</span> Member(<span class="number">3L</span>, <span class="string">&quot;Charlie&quot;</span>, <span class="string">&quot;charlie@example.com&quot;</span>, <span class="string">&quot;555555555&quot;</span>, <span class="number">70</span>, <span class="keyword">true</span>, LocalDateTime.now());</span><br><span class="line">    assertEquals(<span class="string">&quot;시니어&quot;</span>, senior.getAgeCategory());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-하나의-클래스에-너무-많은-객체를-포함하는-경우"><a href="#2-하나의-클래스에-너무-많은-객체를-포함하는-경우" class="headerlink" title="2. 하나의 클래스에 너무 많은 객체를 포함하는 경우"></a>2. 하나의 클래스에 너무 많은 객체를 포함하는 경우</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> orderId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Customer customer; <span class="comment">// 연관된 객체</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Product product;   <span class="comment">// 연관된 객체</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LocalDateTime orderDate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Order</span><span class="params">(<span class="keyword">long</span> orderId, Customer customer, Product product, LocalDateTime orderDate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.orderId = orderId;</span><br><span class="line">        <span class="keyword">this</span>.customer = customer;</span><br><span class="line">        <span class="keyword">this</span>.product = product;</span><br><span class="line">        <span class="keyword">this</span>.orderDate = orderDate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> customerId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String email;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Address address; <span class="comment">// 연관된 객체</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Customer</span><span class="params">(<span class="keyword">long</span> customerId, String name, String email, Address address)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.customerId = customerId;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.email = email;</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> productId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String productName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">double</span> price;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Product</span><span class="params">(<span class="keyword">long</span> productId, String productName, <span class="keyword">double</span> price)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.productId = productId;</span><br><span class="line">        <span class="keyword">this</span>.productName = productName;</span><br><span class="line">        <span class="keyword">this</span>.price = price;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Address</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String street;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String city;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String zipCode;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Address</span><span class="params">(String street, String city, String zipCode)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.street = street;</span><br><span class="line">        <span class="keyword">this</span>.city = city;</span><br><span class="line">        <span class="keyword">this</span>.zipCode = zipCode;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="문제점-1"><a href="#문제점-1" class="headerlink" title="문제점"></a>문제점</h3><ul>
<li>생성자에 따라서 연관관계가 맺어진 다른 객체들 까지 생성이 필요하고, 또 그 객체에 연결된 객체들 까지 무한히 체이닝될 수 있습니다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testOrderCreation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Address 생성</span></span><br><span class="line">        Address address = <span class="keyword">new</span> Address(<span class="string">&quot;123 Main St&quot;</span>, <span class="string">&quot;Seoul&quot;</span>, <span class="string">&quot;12345&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Customer 생성</span></span><br><span class="line">        Customer customer = <span class="keyword">new</span> Customer(<span class="number">1L</span>, <span class="number">1L</span>, <span class="string">&quot;John Doe&quot;</span>, <span class="string">&quot;john@example.com&quot;</span>, address);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Product 생성</span></span><br><span class="line">        Product product = <span class="keyword">new</span> Product(<span class="number">1001L</span>, <span class="string">&quot;Laptop&quot;</span>, <span class="number">1500.00</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Order 생성</span></span><br><span class="line">        Order order = <span class="keyword">new</span> Order(<span class="number">5001L</span>, customer, product, LocalDateTime.now());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 테스트</span></span><br><span class="line">        assertNotNull(order.getCustomer());</span><br><span class="line">        assertEquals(<span class="string">&quot;Laptop&quot;</span>, order.getProduct().getProductName());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>위 코드에선 Order 객체를 생성하려면 Customer와 Product 객체가 필요하며, Customer 객체를 생성하려면 Address 객체도 생성해야 합니다.</li>
<li>테스트에서 단일 객체 검증을 위해 불필요한 객체들을 생성해야 하는 비효율 발생합니다.</li>
</ul>
<h2 id="3-객체를-생성할-수-있는-생성자가-존재하지-않는-경우"><a href="#3-객체를-생성할-수-있는-생성자가-존재하지-않는-경우" class="headerlink" title="3. 객체를 생성할 수 있는 생성자가 존재하지 않는 경우"></a>3. 객체를 생성할 수 있는 생성자가 존재하지 않는 경우</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor(access = AccessLevel.PROTECTED)</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;member&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemberEntity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> String phoneNumber;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isVerified;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createdAt;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MemberEntity</span><span class="params">(String name, String email, String phoneNumber, <span class="keyword">int</span> age, <span class="keyword">boolean</span> isVerified)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.email = email;</span><br><span class="line">        <span class="keyword">this</span>.phoneNumber = phoneNumber;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.isVerified = isVerified;</span><br><span class="line">        <span class="keyword">this</span>.createdAt = LocalDateTime.now();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="문제점-2"><a href="#문제점-2" class="headerlink" title="문제점"></a>문제점</h3><ul>
<li>기본 생성자 외에, 모든 필드를 초기화하는 생성자를 제공하지 않으므로 테스트에서 객체를 생성할 수 없습니다.</li>
<li>테스트를 위해 public 생성자를 추가하거나 setter를 작성해야 하지만, 이는 프로덕션 코드의 불필요한 수정으로 이어집니다.</li>
<li>혹은 테스트에서 강제로 객체를 생성하려면 Reflection을 사용해야 할 수 있지만, Reflection은 유지보수성을 떨어뜨리고, 코드 가독성을 저하시킵니다.</li>
</ul>
<h2 id="4-요약"><a href="#4-요약" class="headerlink" title="4. 요약"></a>4. 요약</h2><table>
<thead>
<tr>
<th>문제 상황</th>
<th>설명</th>
<th>Fixture Monkey 도입 효과</th>
</tr>
</thead>
<tbody><tr>
<td>클래스에 final 필드가 포함된 경우</td>
<td>final 필드로 인해 모든 필드를 초기화해야 객체 생성 가능</td>
<td>필요한 데이터만 선택적으로 생성 가능</td>
</tr>
<tr>
<td>객체가 너무 많은 연관 객체 포함</td>
<td>생성자 체이닝으로 인해 테스트에 필요한 객체 생성이 복잡해짐</td>
<td>의존 객체를 자동 생성하며 필요한 객체만 오버라이드 가능</td>
</tr>
<tr>
<td>생성자가 존재하지 않는 경우</td>
<td>생성자가 없어 Reflection 등을 통해 강제로 생성해야 하는 비효율</td>
<td>테스트용 생성자 추가 없이 객체 생성 과정 단순화 가능</td>
</tr>
</tbody></table>
<hr>
<h1 id="3-Fixture-Monkey의-객체-생성-방식들"><a href="#3-Fixture-Monkey의-객체-생성-방식들" class="headerlink" title="3. Fixture Monkey의 객체 생성 방식들"></a>3. Fixture Monkey의 객체 생성 방식들</h1><p><code>Introspector</code>란 Fixture Monkey에서 <strong>객체가 생성되는 방법</strong>을 의미합니다.</p>
<p><code>FixtureMonkey</code>가 생성될 때 넣어주는 <code>Introspector</code>에 따라 객체가 생성되는 방법이 달라지게 됩니다.</p>
<h2 id="1-BeanArbitraryIntrospector"><a href="#1-BeanArbitraryIntrospector" class="headerlink" title="1. BeanArbitraryIntrospector"></a>1. BeanArbitraryIntrospector</h2><ul>
<li>Fixture Monkey가 객체 생성에 사용하는 기본 introspector 입니다.</li>
<li>리플렉션과 setter 메서드를 사용하여 새 인스턴스를 생성하므로 생성할 클래스에는 인자가 없는 생성자(또는 기본생성자)와 setter가 있어합니다.</li>
</ul>
<h2 id="2-ConstructorPropertiesArbitraryIntrospector"><a href="#2-ConstructorPropertiesArbitraryIntrospector" class="headerlink" title="2. ConstructorPropertiesArbitraryIntrospector"></a>2. ConstructorPropertiesArbitraryIntrospector</h2><ul>
<li>생성자에 <code>@ConstructorProperties</code>가 있거나 없으면 클래스가 레코드 타입이어야 합니다.<br>(또는 Lombok을 사용하는 경우 lombok.config 파일에 <code>lombok.anyConstructor.addConstructorProperties=true</code>를 추가할 수 있습니다.)</li>
</ul>
<h2 id="3-FieldReflectionArbitraryIntrospector"><a href="#3-FieldReflectionArbitraryIntrospector" class="headerlink" title="3. FieldReflectionArbitraryIntrospector"></a>3. <strong>FieldReflectionArbitraryIntrospector</strong></h2><ul>
<li>리플렉션을 사용하여 새 인스턴스를 생성하고 필드를 설정하므로, 생성할 클래스는 인자가 없는 생성자(또는 기본 생성자)와 getter 또는 setter 중 하나를 가져야 합니다.</li>
<li>만약 final이 아닌 변수가 선언되어 있다면 getter 또는 setter 없이도 사용 가능합니다.</li>
</ul>
<h2 id="4-BuilderArbitraryIntrospector"><a href="#4-BuilderArbitraryIntrospector" class="headerlink" title="4. BuilderArbitraryIntrospector"></a>4. BuilderArbitraryIntrospector</h2><ul>
<li>클래스 빌더를 사용하여 클래스를 생성합니다.</li>
</ul>
<h2 id="5-FailoverArbitraryIntrospector"><a href="#5-FailoverArbitraryIntrospector" class="headerlink" title="5. FailoverArbitraryIntrospector"></a>5. FailoverArbitraryIntrospector</h2><ul>
<li>테스트 대상이 너무 다양한 객체를 내부적으로 가지고 있을 때 여러 <code>Introspector</code>를 제공할 수 있습니다.</li>
<li><code>FailoverArbitraryIntrospector</code>를 사용하면 두 개 이상의 introspector를 사용할 수 있으며, introspector 중 하나가 생성에 실패하더라도 <code>FailoverArbitraryIntrospector</code>는 계속 다음 introspector로 객체 생성을 시도합니다.</li>
</ul>
<h2 id="6-PriorityConstructorArbitraryIntrospector"><a href="#6-PriorityConstructorArbitraryIntrospector" class="headerlink" title="6. PriorityConstructorArbitraryIntrospector"></a>6. <strong>PriorityConstructorArbitraryIntrospector</strong></h2><ul>
<li>생성자를 사용해서 타입을 생성합니다.</li>
<li>다만, 생성자 파라미터 이름을 인식하지 못하면 ArbitraryBuilder API를 사용해 생성자 파라미터를 제어할 수 없습니다.</li>
<li>일반적으로 컴파일 시 바이트 코드에 생성자명과 파라미터명이 코드에서 작상한대로 저장되지 않으므로(arg1, arg2 이런식으로 저장됨) 생성자와 파라미터명을 런타임에 알 수 있도록 매핑 시킬 수 있어야 합니다.</li>
<li>Fixture monkey 공식문서에선 아래 3가지 방법을 제시하고 있습니다.<ul>
<li>record 타입</li>
<li>JVM 옵션 -parameters 활성화</li>
<li>생성자에 @ConstructorProperties 존재</li>
</ul>
</li>
</ul>
<details>
<summary>ConstructorPropertiesArbitraryIntrospector와의 차이점</summary>


</details>

<h2 id="7-요약"><a href="#7-요약" class="headerlink" title="7. 요약"></a><strong>7. 요약</strong></h2><table>
<thead>
<tr>
<th>Introspector</th>
<th>설명</th>
<th>특징</th>
</tr>
</thead>
<tbody><tr>
<td>BeanArbitraryIntrospector</td>
<td>기본 introspector로, 인자가 없는 생성자와 setter를 이용해 객체 생성</td>
<td>일반적인 객체 생성에 적합</td>
</tr>
<tr>
<td>ConstructorPropertiesArbitraryIntrospector</td>
<td>@ConstructorProperties 또는 레코드 타입을 통해 생성자 사용 가능</td>
<td>생성자 프로퍼티를 통한 특정 생성 가능</td>
</tr>
<tr>
<td>FieldReflectionArbitraryIntrospector</td>
<td>필드 리플렉션으로 객체 생성</td>
<td>final이 아닌 필드에 대해 setter 없이도 가능</td>
</tr>
<tr>
<td>BuilderArbitraryIntrospector</td>
<td>빌더 패턴을 사용하여 객체 생성</td>
<td>빌더 패턴이 있는 객체에 적합</td>
</tr>
<tr>
<td>FailoverArbitraryIntrospector</td>
<td>여러 introspector 중 사용 가능한 방식으로 객체 생성 시도</td>
<td>다양한 객체 생성 조건에 유연하게 대응</td>
</tr>
<tr>
<td>PriorityConstructorArbitraryIntrospector</td>
<td>우선 순위가 높은 생성자를 사용하여 객체 생성</td>
<td>생성자 우선 사용 상황에 적합</td>
</tr>
</tbody></table>
<hr>
<h1 id="4-사용-예시"><a href="#4-사용-예시" class="headerlink" title="4. 사용 예시"></a>4. 사용 예시</h1><h2 id="1-PriorityConstructorArbitraryIntrospector-사용"><a href="#1-PriorityConstructorArbitraryIntrospector-사용" class="headerlink" title="1. PriorityConstructorArbitraryIntrospector 사용"></a><strong>1. PriorityConstructorArbitraryIntrospector 사용</strong></h2><ul>
<li>PriorityConstructorArbitraryIntrospector를 이용해 기 존재하는 생성자를 활용하여 객체를 생성합니다.</li>
<li>Repository에서 데이터를 조회할 경우 <code>@QueryProjection</code> 을 활용하기 위해 DTO(혹은 VO)에서 생성자를 만들어서 사용하고 있는데, 이런 케이스처럼 final 필드가 다수 존재하여, 테스트 객체 생성에 비효율이 발생할 경우 사용하기 좋습니다.</li>
<li>해당 예시에선 withParameterNamesResolver() 메서드를 이용하여 생성자의 파라미터명을 명시적으로 작성하였습니다. 혹은 위에 설명한 다른 방법을 이용해 <strong>런타임</strong>에 파라미터명을 알 수 있도록 합니다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> FixtureMonkey fixtureMonkey;</span><br><span class="line"></span><br><span class="line"><span class="meta">@BeforeEach</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.fixtureMonkey = FixtureMonkey.builder()</span><br><span class="line">            .objectIntrospector(PriorityConstructorArbitraryIntrospector.INSTANCE</span><br><span class="line">                    .withParameterNamesResolver(constructor -&gt; List.of(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;email&quot;</span>, <span class="string">&quot;phoneNumber&quot;</span>, <span class="string">&quot;age&quot;</span>, <span class="string">&quot;verified&quot;</span>, <span class="string">&quot;createdAt&quot;</span>)))</span><br><span class="line">            .build();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ParameterizedTest(name = &quot;&#123;index&#125; =&gt; age=&#123;0&#125;, expectedCategory=&#123;1&#125;&quot;)</span></span><br><span class="line"><span class="meta">@MethodSource(&quot;getPersonVoArguments&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testPersonVoMethods</span><span class="params">(Integer age, String expectedCategory)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// given</span></span><br><span class="line">    PersonVo personVo = fixtureMonkey.giveMeBuilder(PersonVo.class)</span><br><span class="line">            .set(javaGetter(PersonVo::getId), <span class="number">1L</span>)</span><br><span class="line">            .set(<span class="string">&quot;age&quot;</span>, age)</span><br><span class="line">            .sample();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// when</span></span><br><span class="line">    String ageCategory = personVo.getAgeCategory();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// then</span></span><br><span class="line">    assertThat(ageCategory).isEqualTo(expectedCategory);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Stream&lt;Arguments&gt; <span class="title">getPersonVoArguments</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Stream.of(</span><br><span class="line">            Arguments.of(<span class="keyword">null</span>, <span class="string">&quot;Unknown&quot;</span>),</span><br><span class="line">            Arguments.of(<span class="number">15</span>, <span class="string">&quot;청소년&quot;</span>),</span><br><span class="line">            Arguments.of(<span class="number">30</span>, <span class="string">&quot;청년&quot;</span>),</span><br><span class="line">            Arguments.of(<span class="number">70</span>, <span class="string">&quot;시니어&quot;</span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="실행-결과"><a href="#실행-결과" class="headerlink" title="실행 결과"></a>실행 결과</h3>

<ul>
<li>테스트에 필요한 <code>age</code>만 넣고 실행 시, 나머지 final 필드들은 알아서 fixture monkey에 의해 채워지거나 null 허용필드인 경우 null이 입력된 것을 볼 수 있습니다.</li>
</ul>
<h2 id="2-FieldReflectionArbitraryIntrospector-사용"><a href="#2-FieldReflectionArbitraryIntrospector-사용" class="headerlink" title="2. FieldReflectionArbitraryIntrospector 사용"></a>2. <strong>FieldReflectionArbitraryIntrospector 사용</strong></h2><ul>
<li>생성자의 파라미터에 존재하지 않는 값 ( id )을 수정하기 위해 <code>FieldReflectionArbitraryIntrospector</code> 를 활용하여 객체를 생성합니다.</li>
<li>Entity class인 경우 보통 생성자에 id 필드를 포함한 생성자가 존재하지 않기 때문에(JPA ID를 생성, 관리 하도록 일임하기 때문) Entity 객체 생성 시 사용하기 좋습니다.</li>
</ul>
<br>

<h3 id="Member-Entity"><a href="#Member-Entity" class="headerlink" title="Member Entity"></a>Member Entity</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor(access = AccessLevel.PROTECTED)</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;member&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemberEntity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> String phoneNumber;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isVerified;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createdAt;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MemberEntity</span><span class="params">(String name, String email, String phoneNumber, <span class="keyword">int</span> age, <span class="keyword">boolean</span> isVerified)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.email = email;</span><br><span class="line">        <span class="keyword">this</span>.phoneNumber = phoneNumber;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.isVerified = isVerified;</span><br><span class="line">        <span class="keyword">this</span>.createdAt = LocalDateTime.now();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">verify</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.isVerified = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="비즈니스-로직"><a href="#비즈니스-로직" class="headerlink" title="비즈니스 로직"></a>비즈니스 로직</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 특정 ID를 가진 회원을 활성화</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> memberId 회원 ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 활성화된 회원</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Member <span class="title">activateMember</span><span class="params">(<span class="keyword">long</span> memberId)</span> </span>&#123;</span><br><span class="line">    MemberEntity entity = memberRepository.findById(memberId)</span><br><span class="line">            .orElseThrow(() -&gt; <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;존재하지 않는 회원 ID: &quot;</span> + memberId));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (entity.isVerified()) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;이미 활성화된 회원입니다: &quot;</span> + memberId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    entity.verify();</span><br><span class="line">    entity = memberRepository.save(entity);</span><br><span class="line">    <span class="keyword">return</span> Member.of(entity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br>

<h3 id="테스트코드-with-fixture-monkey"><a href="#테스트코드-with-fixture-monkey" class="headerlink" title="테스트코드 with. fixture monkey"></a>테스트코드 with. fixture monkey</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> FixtureMonkey fixtureMonkey;</span><br><span class="line"><span class="keyword">private</span> MemberService memberService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@BeforeEach</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    fixtureMonkey = FixtureMonkey.builder()</span><br><span class="line">            .objectIntrospector(FieldReflectionArbitraryIntrospector.INSTANCE)</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    memberService = <span class="keyword">new</span> MemberService(<span class="keyword">new</span> FakeMemberRepository());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RepeatedTest(value = 100)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testActivateMemberUsingFixtureMonkey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// given</span></span><br><span class="line">    MemberEntity entity = fixtureMonkey.giveMeBuilder(MemberEntity.class)</span><br><span class="line">            .set(<span class="string">&quot;isVerified&quot;</span>, <span class="keyword">false</span>)</span><br><span class="line">            .sample();</span><br><span class="line"></span><br><span class="line">    Member savedMember = memberService.save(entity);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// when</span></span><br><span class="line">    Member activatedMember = memberService.activateMember(savedMember.getId());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// then</span></span><br><span class="line">    assertThat(activatedMember.isVerified()).isTrue();</span><br><span class="line">    assertThat(entity.getId()).isEqualTo(activatedMember.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<ul>
<li>fixture monkey를 이용해 MemberEntity 객체 생성 시, 테스트해야하는 비즈니스 로직에서 필요한 값만 지정하여 객체를 생성합니다.<ul>
<li>예제에선 isVerified의 상태를 true로 변경하는 것</li>
</ul>
</li>
<li>이로 인해 테스트코드의 본래 목적인, 비즈니스 로직 검증에만 집중할 수 있는 간단한 테스트코드를 작성 할 수 있습니다.</li>
</ul>
<hr>
<h1 id="5-퀴즈"><a href="#5-퀴즈" class="headerlink" title="5. 퀴즈"></a>5. 퀴즈</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EventEligibilityChecker</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MemberService memberService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;event.vip.member.ids&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String vipMemberIds;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ZoneOffset KST = ZoneOffset.of(<span class="string">&quot;+09:00&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 특정 이벤트 참여 가능 여부를 확인</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 조건:</span></span><br><span class="line"><span class="comment">     * - VIP 회원이거나</span></span><br><span class="line"><span class="comment">     * - 관리자 권한을 가진 회원이거나</span></span><br><span class="line"><span class="comment">     * - 이벤트 기간 외에 요청한 회원이라면 false</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 그렇지 않다면 true를 반환한다.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> memberId 확인할 회원 ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> eventStartTime 이벤트 시작 시간</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> eventEndTime 이벤트 종료 시간</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 참여 가능 여부</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">canParticipate</span><span class="params">(<span class="keyword">long</span> memberId, LocalDateTime eventStartTime, LocalDateTime eventEndTime)</span> </span>&#123;</span><br><span class="line">        OffsetDateTime currentTime = OffsetDateTime.now();</span><br><span class="line">        <span class="keyword">boolean</span> isEligible = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> isVipMember = checkVipMember(memberId);</span><br><span class="line">        <span class="keyword">boolean</span> isAdminMember =</span><br><span class="line">                checkAdminMember(memberId);</span><br><span class="line">        <span class="keyword">boolean</span> isOutsideEventPeriod = checkOutsideEventPeriod(currentTime, eventStartTime, eventEndTime);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (isVipMember || isAdminMember || isOutsideEventPeriod) &#123;</span><br><span class="line">            isEligible = <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> isEligible;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">checkVipMember</span><span class="params">(<span class="keyword">long</span> memberId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.stream(vipMemberIds.split(<span class="string">&quot;,&quot;</span>))</span><br><span class="line">                .map(String::trim)</span><br><span class="line">                .map(Integer::parseInt)</span><br><span class="line">                .anyMatch(id -&gt; id == memberId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">checkAdminMember</span><span class="params">(<span class="keyword">long</span> memberId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> memberService.hasAdminRole(memberId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">checkOutsideEventPeriod</span><span class="params">(OffsetDateTime currentTime, LocalDateTime eventStartTime, LocalDateTime eventEndTime)</span> </span>&#123;</span><br><span class="line">        OffsetDateTime eventStart = eventStartTime.atOffset(KST);</span><br><span class="line">        OffsetDateTime eventEnd = eventEndTime.atOffset(KST);</span><br><span class="line">        <span class="keyword">return</span> currentTime.isBefore(eventStart) || currentTime.isAfter(eventEnd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br>

<p>위 같은 코드는 어떻게 테스트 코드를 작성 할 수 있을까요?</p>
<h2 id="1-테스트코드-작성"><a href="#1-테스트코드-작성" class="headerlink" title="1. 테스트코드 작성"></a>1. 테스트코드 작성</h2><h3 id="1-Fixture-Monkey-사용"><a href="#1-Fixture-Monkey-사용" class="headerlink" title="1. Fixture Monkey 사용"></a>1. Fixture Monkey 사용</h3><details>
<summary>예시 코드</summary>

<ul>
<li>해당 케이스에서 적용 할 수 있는 <code>Introspector</code> 가 존재하지 않기 때문에 Fixture monkey로 객체를 생성 할 수 없습니다.<ul>
<li>혹 제가 잘못 알고 있다면, 댓글 등으로 조언 부탁드립니다. (__)</li></ul></li></ul></details>





<br>

<h3 id="2-SpringBootTest와-TestPropertySource-사용"><a href="#2-SpringBootTest와-TestPropertySource-사용" class="headerlink" title="2. @SpringBootTest와 @TestPropertySource 사용"></a>2. @SpringBootTest와 @TestPropertySource 사용</h3><details>
<summary>예시 코드</summary>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@TestPropertySource(properties = &#123;</span></span><br><span class="line"><span class="meta">        &quot;event.vip.member.ids=1,2,3&quot;</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventEligibilityCheckerTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EventEligibilityChecker eventEligibilityChecker;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MemberService memberService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ParameterizedTest(name = &quot;&#123;index&#125; =&gt; memberId=&#123;0&#125;, startTime=&#123;1&#125;, endTime=&#123;2&#125;, expectedResult=&#123;3&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@MethodSource(&quot;getMemberArguments&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testCanParticipate</span><span class="params">(<span class="keyword">int</span> memberId, LocalDateTime startTime, LocalDateTime endTime, <span class="keyword">boolean</span> expectedResult)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// when</span></span><br><span class="line">        <span class="keyword">boolean</span> result = eventEligibilityChecker.canParticipate(memberId, startTime, endTime);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// then</span></span><br><span class="line">        assertThat(result).isEqualTo(expectedResult);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> Stream&lt;Object[]&gt; getMemberArguments() &#123;</span><br><span class="line">        <span class="keyword">return</span> Stream.of(</span><br><span class="line">                <span class="keyword">new</span> Object[]&#123;<span class="number">1</span>, LocalDateTime.now().minusDays(<span class="number">1</span>), LocalDateTime.now().plusDays(<span class="number">1</span>), <span class="keyword">false</span>&#125;, <span class="comment">// VIP 멤버</span></span><br><span class="line">                <span class="keyword">new</span> Object[]&#123;<span class="number">99</span>, LocalDateTime.now().minusDays(<span class="number">1</span>), LocalDateTime.now().plusDays(<span class="number">1</span>), <span class="keyword">false</span>&#125;, <span class="comment">// 관리자 멤버</span></span><br><span class="line">                <span class="keyword">new</span> Object[]&#123;<span class="number">4</span>, LocalDateTime.now().plusDays(<span class="number">1</span>), LocalDateTime.now().plusDays(<span class="number">2</span>), <span class="keyword">false</span>&#125;, <span class="comment">// 이벤트 기간 외</span></span><br><span class="line">                <span class="keyword">new</span> Object[]&#123;<span class="number">101</span>, LocalDateTime.now().minusDays(<span class="number">1</span>), LocalDateTime.now().plusDays(<span class="number">1</span>), <span class="keyword">true</span>&#125; <span class="comment">// 일반 멤버 (참여 가능)</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>

<br>

<h3 id="3-Reflection-사용"><a href="#3-Reflection-사용" class="headerlink" title="3. Reflection 사용"></a>3. Reflection 사용</h3><details>
<summary>예시 코드</summary>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EventEligibilityCheckerTestWithReflection</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> EventEligibilityChecker eventEligibilityChecker;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        eventEligibilityChecker = <span class="keyword">new</span> EventEligibilityChecker(<span class="keyword">new</span> MemberService(<span class="keyword">new</span> FakeMemberRepository()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ReflectionTestUtils를 사용해 @Value 필드 설정</span></span><br><span class="line">        ReflectionTestUtils.setField(eventEligibilityChecker, <span class="string">&quot;vipMemberIds&quot;</span>, <span class="string">&quot;1,2,3&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ParameterizedTest(name = &quot;&#123;index&#125; =&gt; memberId=&#123;0&#125;, startTime=&#123;1&#125;, endTime=&#123;2&#125;, expectedResult=&#123;3&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@MethodSource(&quot;getMemberArguments&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testCanParticipate</span><span class="params">(<span class="keyword">int</span> memberId, LocalDateTime startTime, LocalDateTime endTime, <span class="keyword">boolean</span> expectedResult)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// when</span></span><br><span class="line">        <span class="keyword">boolean</span> result = eventEligibilityChecker.canParticipate(memberId, startTime, endTime);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// then</span></span><br><span class="line">        assertThat(result).isEqualTo(expectedResult);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> Stream&lt;Object[]&gt; getMemberArguments() &#123;</span><br><span class="line">        <span class="keyword">return</span> Stream.of(</span><br><span class="line">                <span class="keyword">new</span> Object[]&#123;<span class="number">1</span>, LocalDateTime.now().minusDays(<span class="number">1</span>), LocalDateTime.now().plusDays(<span class="number">1</span>), <span class="keyword">false</span>&#125;, <span class="comment">// VIP 멤버</span></span><br><span class="line">                <span class="keyword">new</span> Object[]&#123;<span class="number">99</span>, LocalDateTime.now().minusDays(<span class="number">1</span>), LocalDateTime.now().plusDays(<span class="number">1</span>), <span class="keyword">false</span>&#125;, <span class="comment">// 관리자 멤버</span></span><br><span class="line">                <span class="keyword">new</span> Object[]&#123;<span class="number">4</span>, LocalDateTime.now().plusDays(<span class="number">1</span>), LocalDateTime.now().plusDays(<span class="number">2</span>), <span class="keyword">false</span>&#125;, <span class="comment">// 이벤트 기간 외</span></span><br><span class="line">                <span class="keyword">new</span> Object[]&#123;<span class="number">101</span>, LocalDateTime.now().minusDays(<span class="number">1</span>), LocalDateTime.now().plusDays(<span class="number">1</span>), <span class="keyword">true</span>&#125; <span class="comment">// 일반 멤버 (참여 가능)</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>

<hr>
<h1 id="6-테스트-하기-쉬운-코드"><a href="#6-테스트-하기-쉬운-코드" class="headerlink" title="6. 테스트 하기 쉬운 코드"></a>6. 테스트 하기 쉬운 코드</h1><blockquote>
<p>No Silver Bullet. - Fred Brooks</p>
</blockquote>
<p>단지 테스트코드 작성을 도와주는 도구일 뿐 Fixture Monkey 도 만능은 아닙니다.</p>
<p>테스트코드를 작성하기 어렵다는 건 테스트 하고자 하는 코드 (<a target="_blank" rel="external nofollow noopener noreferrer" href="https://en.wikipedia.org/wiki/System_under_test">System under test</a>)의 설계 혹은 구조가 잘못되어 있다고 테스트코드가 신호를 보내고 있다고 생각해야합니다.</p>
<h2 id="1-테스트가-어려운-이유"><a href="#1-테스트가-어려운-이유" class="headerlink" title="1. 테스트가 어려운 이유"></a>1. 테스트가 어려운 이유</h2><h3 id="a-불확실성"><a href="#a-불확실성" class="headerlink" title="a. 불확실성"></a>a. 불확실성</h3><ul>
<li>불확실성이란 코드가 외부 데이터나 상태에 의존하여 매번 다른 결과를 만들어내는 것을 의미합니다.</li>
<li>예를 들어, 현재 시간을 기준으로 동작하는 코드, 랜덤 값을 생성하는 코드, 전역 변수를 사용하는 코드 등은 매 실행 시마다 결과가 달라질 수 있습니다.</li>
<li>문제코드에선 <code>@Value</code>로 properties에서 주입받는 값들과 <code>OffsetDateTime.now()</code>를 불확실성이라고 할 수 있습니다.</li>
</ul>
<h3 id="b-부수효과"><a href="#b-부수효과" class="headerlink" title="b. 부수효과"></a>b. 부수효과</h3><ul>
<li>부수효과라 함은 함수 외부의 상태를 변경하는 것을 의미합니다.</li>
<li>예를 들어 메일을 전송하거나 파일에 데이터를 기록하거나 데이터베이스에 저장하는 코드는 외부 시스템에 변화를 일으킵니다.</li>
<li>이런 코드들은 단순히 리턴 값을 확인하는 것만으로는 테스트가 불가능하고, 실제로 외부 상태가 바뀌었는지 확인해야 하기 때문에 테스트 비용이 증가하게 됩니다.</li>
</ul>
<h2 id="2-테스트-하기-쉬운-코드로-수정하기"><a href="#2-테스트-하기-쉬운-코드로-수정하기" class="headerlink" title="2. 테스트 하기 쉬운 코드로 수정하기"></a>2. 테스트 하기 쉬운 코드로 수정하기</h2><details>
<summary>수정된 프로덕션 코드 ( SUT )</summary>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EventEligibilityCheckerV2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MemberService memberService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> VIPProperties vipProperties;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ClockProvider clockProvider;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ZoneOffset KST = ZoneOffset.of(<span class="string">&quot;+09:00&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 특정 이벤트 참여 가능 여부를 확인</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 조건:</span></span><br><span class="line"><span class="comment">     * - VIP 회원이거나</span></span><br><span class="line"><span class="comment">     * - 관리자 권한을 가진 회원이거나</span></span><br><span class="line"><span class="comment">     * - 이벤트 기간 외에 요청한 회원이라면 false</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 그렇지 않다면 true를 반환한다.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> memberId 확인할 회원 ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> eventStartTime 이벤트 시작 시간</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> eventEndTime 이벤트 종료 시간</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 참여 가능 여부</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">canParticipate</span><span class="params">(<span class="keyword">long</span> memberId, LocalDateTime eventStartTime, LocalDateTime eventEndTime)</span> </span>&#123;</span><br><span class="line">        OffsetDateTime currentTime = clockProvider.now();</span><br><span class="line">        <span class="keyword">boolean</span> isEligible = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> isVipMember = checkVipMember(memberId);</span><br><span class="line">        <span class="keyword">boolean</span> isAdminMember =</span><br><span class="line">                checkAdminMember(memberId);</span><br><span class="line">        <span class="keyword">boolean</span> isOutsideEventPeriod = checkOutsideEventPeriod(currentTime, eventStartTime, eventEndTime);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (isVipMember || isAdminMember || isOutsideEventPeriod) &#123;</span><br><span class="line">            isEligible = <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> isEligible;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">checkVipMember</span><span class="params">(<span class="keyword">long</span> memberId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> vipProperties.getIds().contains(memberId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">checkAdminMember</span><span class="params">(<span class="keyword">long</span> memberId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> memberService.hasAdminRole(memberId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">checkOutsideEventPeriod</span><span class="params">(OffsetDateTime currentTime, LocalDateTime eventStartTime, LocalDateTime eventEndTime)</span> </span>&#123;</span><br><span class="line">        OffsetDateTime eventStart = eventStartTime.atOffset(KST);</span><br><span class="line">        OffsetDateTime eventEnd = eventEndTime.atOffset(KST);</span><br><span class="line">        <span class="keyword">return</span> currentTime.isBefore(eventStart) || currentTime.isAfter(eventEnd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">VIPProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;Long&gt; <span class="title">getIds</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;event.vip.member&quot;)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VIPPropertiesImpl</span> <span class="keyword">implements</span> <span class="title">VIPProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String ids;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ConstructorBinding</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">VIPPropertiesImpl</span><span class="params">(String ids)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.ids = ids;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Long&gt; <span class="title">getIds</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.stream(<span class="keyword">this</span>.ids.split(<span class="string">&quot;,&quot;</span>))</span><br><span class="line">                .map(String::trim)</span><br><span class="line">                .map(Long::parseLong)</span><br><span class="line">                .toList();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</details>

<br>
<details>
<summary>수정된 테스트 코드</summary>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventEligibilityCheckerV2Test</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> EventEligibilityCheckerV2 eventEligibilityChecker;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> year = <span class="number">2024</span>;</span><br><span class="line">        <span class="keyword">int</span> month = <span class="number">12</span>;</span><br><span class="line">        <span class="keyword">int</span> day =<span class="number">13</span>;</span><br><span class="line">        <span class="keyword">int</span> hour = <span class="number">11</span>;</span><br><span class="line">        <span class="keyword">int</span> minute = <span class="number">11</span>;</span><br><span class="line">        <span class="keyword">int</span> second = <span class="number">11</span>;</span><br><span class="line"></span><br><span class="line">        eventEligibilityChecker = <span class="keyword">new</span> EventEligibilityCheckerV2(</span><br><span class="line">                <span class="keyword">new</span> MemberService(<span class="keyword">new</span> FakeMemberRepository())</span><br><span class="line">                , <span class="keyword">new</span> FakeVIPProperties(Arrays.asList(<span class="number">1L</span>,<span class="number">2L</span>,<span class="number">3L</span>))</span><br><span class="line">                , <span class="keyword">new</span> FakeSystemClockProvider(OffsetDateTime.of(year, month, day, hour, minute, second, <span class="number">11</span>, ZoneOffset.UTC))</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ParameterizedTest(name = &quot;&#123;index&#125; =&gt; memberId=&#123;0&#125;, startTime=&#123;1&#125;, endTime=&#123;2&#125;, expectedResult=&#123;3&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@MethodSource(&quot;getMemberArguments&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testCanParticipate</span><span class="params">(<span class="keyword">int</span> memberId, LocalDateTime startTime, LocalDateTime endTime, <span class="keyword">boolean</span> expectedResult)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// when</span></span><br><span class="line">        <span class="keyword">boolean</span> result = eventEligibilityChecker.canParticipate(memberId, startTime, endTime);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// then</span></span><br><span class="line">        assertThat(result).isEqualTo(expectedResult);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> Stream&lt;Object[]&gt; getMemberArguments() &#123;</span><br><span class="line">        <span class="keyword">int</span> year = <span class="number">2024</span>;</span><br><span class="line">        <span class="keyword">int</span> month = <span class="number">12</span>;</span><br><span class="line">        <span class="keyword">int</span> day =<span class="number">13</span>;</span><br><span class="line">        <span class="keyword">int</span> hour = <span class="number">11</span>;</span><br><span class="line">        <span class="keyword">int</span> minute = <span class="number">11</span>;</span><br><span class="line">        <span class="keyword">int</span> second = <span class="number">11</span>;</span><br><span class="line"></span><br><span class="line">        LocalDateTime eventStartDate = LocalDateTime.of(year, month, day-<span class="number">1</span>, hour, minute, second);</span><br><span class="line">        LocalDateTime eventEndDate = LocalDateTime.of(year, month, day+<span class="number">1</span>, hour, minute, second);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Stream.of(</span><br><span class="line">                <span class="keyword">new</span> Object[]&#123;<span class="number">1</span>, eventStartDate, eventEndDate, <span class="keyword">false</span>&#125;, <span class="comment">// VIP 멤버</span></span><br><span class="line">                <span class="keyword">new</span> Object[]&#123;<span class="number">99</span>, eventStartDate, eventEndDate, <span class="keyword">false</span>&#125;, <span class="comment">// 관리자 멤버</span></span><br><span class="line">                <span class="keyword">new</span> Object[]&#123;<span class="number">4</span>, eventEndDate.plusDays(<span class="number">1</span>), eventEndDate.plusDays(<span class="number">2</span>), <span class="keyword">false</span>&#125;, <span class="comment">// 이벤트 기간 외</span></span><br><span class="line">                <span class="keyword">new</span> Object[]&#123;<span class="number">101</span>, eventStartDate, eventEndDate, <span class="keyword">true</span>&#125; <span class="comment">// 일반 멤버 (참여 가능)</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>

<br>

<h2 id="3-코드-개선으로-인해-얻게된-이점"><a href="#3-코드-개선으로-인해-얻게된-이점" class="headerlink" title="3. 코드 개선으로 인해 얻게된 이점"></a>3. 코드 개선으로 인해 얻게된 이점</h2><ol>
<li><strong>책임 분리</strong>: 설정값을 전용 프로퍼티 클래스 (VIPProperties)로 관리하게 되어 EventEligibilityCheckerV2의 책임이 명확해졌습니다.</li>
<li><strong>유연성 증가</strong>: VIPProperties, ClockProvider와 같은 인터페이스를 사용하여 설정값에 대한 종속성이 외부로 분리하였고, 설정값을 추상화하여, 다양한 설정 구현체를 주입할 수 있습니다. 위 예시에선 테스트코드 내에서 Fake 구현체 작성하고 해당 구현체로 객체를 생성 하도록하여 테스트하였습니다.</li>
<li><strong>코드 가독성</strong>: @Value 어노테이션 없이 구성 클래스를 사용하므로, 전체적인 코드의 가독성이 향상됩니다.</li>
</ol>
<hr>
<h1 id="7-결론"><a href="#7-결론" class="headerlink" title="7. 결론"></a>7. 결론</h1><p>앞서 설명한 설계와 테스트 코드 개선에 더해 Fixture Monkey와 같은 도구를 활용하면 다음과 같은 이점을 얻을 수 있습니다.</p>
<ol>
<li><p><strong>테스트 데이터 자동 생성</strong></p>
<ul>
<li>Fixture Monkey는 복잡한 객체 구조에 대해 필요한 데이터를 자동으로 생성합니다. 이를 통해 테스트를 작성할 때 불필요한 데이터 생성 로직을 줄이고 테스트 로직에 집중할 수 있습니다.</li>
</ul>
</li>
<li><p><strong>객체의 불변성과 유연성 유지</strong></p>
<ul>
<li>기존 객체를 수정하거나 Setter를 추가하지 않아도 Fixture Monkey를 통해 객체를 유연하게 생성 및 수정할 수 있습니다. 특히, 불변 객체(immutable object)나 생성자가 많은 객체를 쉽게 테스트할 수 있습니다.</li>
</ul>
</li>
<li><p><strong>데이터 커스터마이징</strong></p>
<ul>
<li>특정 필드에 대한 값을 명시적으로 설정하거나 조건에 맞는 객체를 생성할 수 있습니다. 예를 들어, VIP 멤버 ID 목록처럼 특정 조건을 가진 데이터를 간단하게 생성할 수 있습니다.</li>
</ul>
</li>
<li><p><strong>테스트 유지보수 비용 절감</strong></p>
<ul>
<li>새로운 필드가 추가되거나 객체 구조가 변경되어도 Fixture Monkey를 사용하면 테스트 코드 수정 범위를 최소화할 수 있습니다.</li>
</ul>
</li>
</ol>
<br>

<hr>
<p>잘 작성된 테스트는 단순히 코드의 동작을 검증하는 역할을 넘어, 코드의 설계와 구조적 결함을 발견하게 해줍니다.<br><strong>Fixture Monkey</strong>와 같은 도구를 활용하면 코드의 불확실성과 부수효과를 줄이면서도 객체 생성과 테스트를 효율적으로 수행할 수 있습니다.<br>특히, 복잡한 객체나 다양한 조건의 테스트 데이터를 쉽게 생성할 수 있어 <strong>테스트 작성 비용을 절감</strong>하고 <strong>테스트 품질을 향상</strong>시킬 수 있습니다.  </p>
<p>그러나 <strong>도구의 활용보다 중요한 것은 테스트 가능한 설계를 만드는 것</strong>입니다.<br>테스트 가능한 설계는 테스트 코드로 하여금 코드 설계의 개선 방향을 제시하게 하며, 결과적으로 유지보수성과 확장성을 높이는 기반이 됩니다.</p>
<p>긴 글 읽어주셔서 감사합니다.</p>
<hr>
<h1 id="참고자료"><a href="#참고자료" class="headerlink" title="참고자료"></a>참고자료</h1><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://naver.github.io/fixture-monkey/v1-0-0/">Fixture Monkey 공식문서</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://tv.naver.com/v/23650158">테스트 객체는 엣지 케이스까지 찾아주는 Fixture Monkey에게 맡기세요</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://jwchung.github.io/testable-code">Testable Code by Jin-Wook Chung</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://youtu.be/YdtknE_yPk4?si=d8KPekxKZrsj_Rpk">무엇을 테스트할 것인가? 어떻게 테스트할 것인가? (권용근)</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.youtube.com/watch?v=XSkz0kO7J3w">실무에서 적용하는 테스트 코드 작성 방법과 노하우 (김남윤)</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.youtube.com/watch?v=pCE7ibRCZEI">왜 나는 테스트를 작성하기 싫을까? (조성아)</a></li>
</ul>
<hr>
<h3 id="전체-코드"><a href="#전체-코드" class="headerlink" title="전체 코드"></a>전체 코드</h3><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/jungguji/fixture-monkey-sample">https://github.com/jungguji/fixture-monkey-sample</a></li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a href="/2024/11/19/%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%BD%94%EB%93%9C-%EC%9E%91%EC%84%B1%EC%9D%84-%EB%8D%94-%EC%89%BD%EA%B2%8C-with-Fixture-Monkey/#post-footer" class="postShorten-excerpt_link link" aria-label>
                                댓글 공유
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2023/01/04/1829-Maximum-XOR-for-Each-Query/" aria-label=": LeetCode 1829. Maximum XOR for Each Query">
                            LeetCode 1829. Maximum XOR for Each Query
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2023-01-04T22:07:37+09:00">
	
		    2023/01/04
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="문제"><a href="#문제" class="headerlink" title="문제"></a>문제</h2><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://leetcode.com/problems/count-triplets-that-can-form-two-arrays-of-equal-xor/">https://leetcode.com/problems/count-triplets-that-can-form-two-arrays-of-equal-xor/</a></p>
<p> 정렬된 n개의 음의 아닌 정수 배열 nums와 정수 maximumBit가 주어지고, 아래 쿼리를 n번 수행한다.</p>
<blockquote>
<p>nums [0] XOR nums [1] XOR … XOR nums [nums.length-1] XOR k</p>
</blockquote>
<br>

<p> 를 최대화하는 k &lt;2maximumBit의 음이 아닌 정수를 찾는데 이 때,  k는 각 쿼리의 정답이다.<br>  쿼리를 반복할 때 마다 배열 nums의 마지막 element를 제거하고, answer 배열을 반환하는데, 여기서 answer[i]는 i번째 쿼리의 정답 즉, k 이다.</p>
<hr>
<h2 id="코드"><a href="#코드" class="headerlink" title="코드"></a>코드</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">int</span>[] getMaximumXor(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> maximumBit) &#123;</span><br><span class="line">    <span class="keyword">int</span>[] pxor = getPrefixXOR(nums);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span>[] answer = <span class="keyword">new</span> <span class="keyword">int</span>[nums.length];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> answerIndex = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> maxValue = (<span class="number">1</span> &lt;&lt; maximumBit) - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = pxor.length-<span class="number">1</span>; i &gt; <span class="number">0</span>; --i) &#123;</span><br><span class="line"></span><br><span class="line">        answer[answerIndex++] = pxor[i] ^ maxValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> answer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span>[] getPrefixXOR(<span class="keyword">int</span>[] nums) &#123;</span><br><span class="line">    <span class="keyword">int</span>[] psum = <span class="keyword">new</span> <span class="keyword">int</span>[nums.length + <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= nums.length; ++i) &#123;</span><br><span class="line">        psum[i] = psum[i-<span class="number">1</span>] ^ nums[i-<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> psum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="흐름"><a href="#흐름" class="headerlink" title="흐름"></a>흐름</h2><ol>
<li>누적합(prefix sum) 알고리즘을 통해 누적 XOR 배열을 구한다.</li>
<li>이 때, 2의 maximumBit승보다 작은 수 중에 가장 큰 수는 당연히 (2^maximumBit)-1 한 수 이므로, (2^maximumBit)-1 값을 변수에 할당해놓고,</li>
<li>nums.length의 길이인 N 번 만큼 쿼리를 반복하면서 마지막 원소를 제거하면서 k 값을 구해 answer[i]에 저장한다.</li>
<li>끝.</li>
</ol>
<h2 id="pxor-i-maxValue가-K인-이유"><a href="#pxor-i-maxValue가-K인-이유" class="headerlink" title="pxor[i] ^ maxValue가 K인 이유"></a>pxor[i] ^ maxValue가 K인 이유</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">xorTEST</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x = <span class="number">93</span>;</span><br><span class="line">    <span class="keyword">int</span> y = <span class="number">12</span>;</span><br><span class="line">    <span class="keyword">int</span> z = x ^ y;</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;----- 초기값 -----&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;x = &quot;</span> + x);</span><br><span class="line">    System.out.println(<span class="string">&quot;y = &quot;</span> + y);</span><br><span class="line">    System.out.println(<span class="string">&quot;z = &quot;</span> + z);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;----- XOR -----&quot;</span>);</span><br><span class="line">    System.out.printf(<span class="string">&quot;x ^ y = %d(z)\n&quot;</span>, x^y);</span><br><span class="line">    System.out.printf(<span class="string">&quot;x ^ z = %d(y)\n&quot;</span>, x^z);</span><br><span class="line">    System.out.printf(<span class="string">&quot;y ^ z = %d(x)\n&quot;</span>, y^z);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">----- 초기값 -----</span><br><span class="line">x = 93</span><br><span class="line">y = 12</span><br><span class="line">z = 81</span><br><span class="line">----- XOR -----</span><br><span class="line">x ^ y = 81(z)</span><br><span class="line">x ^ z = 12(y)</span><br><span class="line">y ^ z = 93(x)</span><br></pre></td></tr></table></figure>

<p> 우리가 구해야 하는 값은 쿼리의 값을 가장 크게 할 값인 K이고, 우리는 이미 가장 큰 값을 (2^maximumBit)-1 로 구해놓았으므로,<br>누적합 알고리즘으로 구한 XOR값에 가장 큰 값을 XOR하면 k가 나오게 된다.</p>
<hr>
<h2 id="결과"><a href="#결과" class="headerlink" title="결과"></a>결과</h2><img src="/2023/01/04/1829-Maximum-XOR-for-Each-Query/%EC%BA%A1%EC%B2%98.PNG" class>
<hr>

                    
                        


                    
                    
                        <p>
                            <a href="/2023/01/04/1829-Maximum-XOR-for-Each-Query/#post-footer" class="postShorten-excerpt_link link" aria-label>
                                댓글 공유
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2022/12/26/JPA-CustomRepository-%EC%9E%91%EC%84%B1-%EC%8B%9C-%EC%9C%A0%EC%9D%98%EC%82%AC%ED%95%AD/" aria-label=": JPA CustomRepository 작성 시 유의사항">
                            JPA CustomRepository 작성 시 유의사항
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2022-12-26T17:03:01+09:00">
	
		    2022/12/26
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="서론"><a href="#서론" class="headerlink" title="서론"></a>서론</h2><p> 패키지 구조를 수정 후, 기존에 정상 작동하던 custom repository에서 에러가 발생하여, 그 원인과 해결 방법에 대해 정리한다.</p>
<hr>
<h2 id="본론"><a href="#본론" class="headerlink" title="본론"></a>본론</h2><p> 코드의 구조는 아래처럼 되어 있다.</p>
<h3 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReviewFindService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ReviewRepository reviewRepository;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Review <span class="title">findById</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.reviewRepository.findById(id)</span><br><span class="line">            .orElseThrow(EntityNotFoundException::<span class="keyword">new</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Review&gt; <span class="title">findMyReviews</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.reviewRepository.myReviews();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Repository"><a href="#Repository" class="headerlink" title="Repository"></a>Repository</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ReviewRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Review</span>, <span class="title">Long</span>&gt;, <span class="title">ReviewCustomRepository</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Custom-Repository"><a href="#Custom-Repository" class="headerlink" title="Custom Repository"></a>Custom Repository</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ReviewCustomRepository</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;Review&gt; <span class="title">myReviews</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Custom-Repository-Implementation"><a href="#Custom-Repository-Implementation" class="headerlink" title="Custom Repository Implementation"></a>Custom Repository Implementation</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReviewCustomRepositoryImpl</span> <span class="keyword">implements</span> <span class="title">ReviewCustomRepository</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Review&gt; <span class="title">myReviews</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="그림으로"><a href="#그림으로" class="headerlink" title="그림으로"></a>그림으로</h3><img src="/2022/12/26/JPA-CustomRepository-%EC%9E%91%EC%84%B1-%EC%8B%9C-%EC%9C%A0%EC%9D%98%EC%82%AC%ED%95%AD/1_%EA%B5%AC%EC%A1%B0.png" class>

<br>
 Service에서 Repository를 선언하여 사용하고, Repository는 CustomRepository를 상속받고, CustomRepositroy를 CustomRepositoryImpl가 구현체로 작성된 상태이다.
이때, ReviewFindService의 findMyReviews()를 호출하면, 아래와 같은 exception이 발생하고, 코드가 정상적으로 작동하지 않았다.

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">Caused by: java.lang.IllegalArgumentException: Failed to create query <span class="keyword">for</span> method <span class="keyword">public</span> <span class="keyword">abstract</span> java.util.List com.jgji.sokdak.domain.review.domain.ReviewCustomRepository.myReviews()! No property <span class="string">&#x27;myReviews&#x27;</span> found <span class="keyword">for</span> type <span class="string">&#x27;Review&#x27;</span></span><br><span class="line">	at org.springframework.data.jpa.repository.query.PartTreeJpaQuery.&lt;init&gt;(PartTreeJpaQuery.java:<span class="number">96</span>)</span><br><span class="line">	at org.springframework.data.jpa.repository.query.JpaQueryLookupStrategy$CreateQueryLookupStrategy.resolveQuery(JpaQueryLookupStrategy.java:<span class="number">119</span>)</span><br><span class="line">	at org.springframework.data.jpa.repository.query.JpaQueryLookupStrategy$CreateIfNotFoundQueryLookupStrategy.resolveQuery(JpaQueryLookupStrategy.java:<span class="number">259</span>)</span><br><span class="line">	at org.springframework.data.jpa.repository.query.JpaQueryLookupStrategy$AbstractQueryLookupStrategy.resolveQuery(JpaQueryLookupStrategy.java:<span class="number">93</span>)</span><br><span class="line">	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.lookupQuery(QueryExecutorMethodInterceptor.java:<span class="number">103</span>)</span><br><span class="line">	... <span class="number">134</span> more</span><br><span class="line">Caused by: org.springframework.data.mapping.PropertyReferenceException: No property <span class="string">&#x27;myReviews&#x27;</span> found <span class="keyword">for</span> type <span class="string">&#x27;Review&#x27;</span></span><br><span class="line">	at org.springframework.data.mapping.PropertyPath.&lt;init&gt;(PropertyPath.java:<span class="number">91</span>)</span><br><span class="line">	at org.springframework.data.mapping.PropertyPath.create(PropertyPath.java:<span class="number">438</span>)</span><br><span class="line">	at org.springframework.data.mapping.PropertyPath.create(PropertyPath.java:<span class="number">414</span>)</span><br><span class="line">	at org.springframework.data.mapping.PropertyPath.lambda$from$<span class="number">0</span>(PropertyPath.java:<span class="number">367</span>)</span><br><span class="line">	at java.base/java.util.concurrent.ConcurrentMap.computeIfAbsent(ConcurrentMap.java:<span class="number">330</span>)</span><br><span class="line">	at org.springframework.data.mapping.PropertyPath.from(PropertyPath.java:<span class="number">349</span>)</span><br><span class="line">	at org.springframework.data.mapping.PropertyPath.from(PropertyPath.java:<span class="number">332</span>)</span><br><span class="line">	at org.springframework.data.repository.query.parser.Part.&lt;init&gt;(Part.java:<span class="number">81</span>)</span><br><span class="line">	at org.springframework.data.repository.query.parser.PartTree$OrPart.lambda$<span class="keyword">new</span>$<span class="number">0</span>(PartTree.java:<span class="number">250</span>)</span><br><span class="line">	at java.base/java.util.stream.ReferencePipeline$<span class="number">3</span>$<span class="number">1.</span>accept(ReferencePipeline.java:<span class="number">195</span>)</span><br><span class="line">	at java.base/java.util.stream.ReferencePipeline$<span class="number">2</span>$<span class="number">1.</span>accept(ReferencePipeline.java:<span class="number">177</span>)</span><br><span class="line">	at java.base/java.util.Spliterators$ArraySpliterator.forEachRemaining(Spliterators.java:<span class="number">948</span>)</span><br><span class="line">	at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:<span class="number">484</span>)</span><br><span class="line">	at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:<span class="number">474</span>)</span><br><span class="line">	at java.base/java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:<span class="number">913</span>)</span><br><span class="line">	at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:<span class="number">234</span>)</span><br><span class="line">	at java.base/java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:<span class="number">578</span>)</span><br><span class="line">	at org.springframework.data.repository.query.parser.PartTree$OrPart.&lt;init&gt;(PartTree.java:<span class="number">251</span>)</span><br><span class="line">	at org.springframework.data.repository.query.parser.PartTree$Predicate.lambda$<span class="keyword">new</span>$<span class="number">0</span>(PartTree.java:<span class="number">384</span>)</span><br><span class="line">	at java.base/java.util.stream.ReferencePipeline$<span class="number">3</span>$<span class="number">1.</span>accept(ReferencePipeline.java:<span class="number">195</span>)</span><br><span class="line">	at java.base/java.util.stream.ReferencePipeline$<span class="number">2</span>$<span class="number">1.</span>accept(ReferencePipeline.java:<span class="number">177</span>)</span><br><span class="line">	at java.base/java.util.Spliterators$ArraySpliterator.forEachRemaining(Spliterators.java:<span class="number">948</span>)</span><br><span class="line">	at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:<span class="number">484</span>)</span><br><span class="line">	at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:<span class="number">474</span>)</span><br><span class="line">	at java.base/java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:<span class="number">913</span>)</span><br><span class="line">	at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:<span class="number">234</span>)</span><br><span class="line">	at java.base/java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:<span class="number">578</span>)</span><br><span class="line">	at org.springframework.data.repository.query.parser.PartTree$Predicate.&lt;init&gt;(PartTree.java:<span class="number">385</span>)</span><br><span class="line">	at org.springframework.data.repository.query.parser.PartTree.&lt;init&gt;(PartTree.java:<span class="number">93</span>)</span><br><span class="line">	at org.springframework.data.jpa.repository.query.PartTreeJpaQuery.&lt;init&gt;(PartTreeJpaQuery.java:<span class="number">89</span>)</span><br><span class="line">	... <span class="number">138</span> more</span><br></pre></td></tr></table></figure>

<p>우선, 구현체인 ReviewCustomRepositoryImpl에 Break point 걸어보니, 아예 ReviewCustomRepositoryImpl의 myReviews()가 호출조차 되지 않는 것을 확인했다.<br>그 후 이것저것 코드도 수정해 보고 하였는데, ReviewCustomRepository를 따로 선언하여 사용하니 정상적으로 호출되었다.</p>
<h3 id="Service에서-CustomRepository를-직접-참조"><a href="#Service에서-CustomRepository를-직접-참조" class="headerlink" title="Service에서 CustomRepository를 직접 참조"></a>Service에서 CustomRepository를 직접 참조</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReviewFindService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ReviewRepository reviewRepository;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ReviewCustomRepository reviewCustomRepository;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Review <span class="title">findById</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.reviewRepository.findById(id)</span><br><span class="line">            .orElseThrow(EntityNotFoundException::<span class="keyword">new</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Review&gt; <span class="title">findMyReviews</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.reviewCustomRepository.myReviews();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>기존에 계속 사용하던 구조이기에, CustomRepository를 선언하여 사용하는 방식으로는 문제 해결이 안 된다고 판단하여, 서론에서 말했던 것처럼 최근에 작업한 패키지 구조 수정 중 무언가 문제가 발생하였다고 판단되어 패키지 구조를 열어보니…</p>
<br>

<img src="/2022/12/26/JPA-CustomRepository-%EC%9E%91%EC%84%B1-%EC%8B%9C-%EC%9C%A0%EC%9D%98%EC%82%AC%ED%95%AD/2_%ED%8C%A8%ED%82%A4%EC%A7%80%EA%B5%AC%EC%A1%B0.PNG" class>

<br>

<p>위 이미지처럼, Custom Repository interface와 구현체인 Custom Repository Impl 클래스가 서로 다른 패키지에 존재하고 있었고, </p>
<br>

<img src="/2022/12/26/JPA-CustomRepository-%EC%9E%91%EC%84%B1-%EC%8B%9C-%EC%9C%A0%EC%9D%98%EC%82%AC%ED%95%AD/3_%EC%84%B1%EA%B3%B5_%ED%8C%A8%ED%82%A4%EC%A7%80%EA%B5%AC%EC%A1%B0.PNG" class>

<br>

<p>위처럼 같은 패키지 아래 존재 하도록 위치를 조정해주니 정상적으로 동작하는 것을 확인할 수 있었다.<br>interface는 기본적으로 접근제어자가 public으로 선언되는데, 패키지 위치가 다른 것이 어째서 문제가 되는지 찾아보니.. Spring 공식 문서에서 아래와 같은 가이드를 찾을 수 있었다.</p>
<blockquote><p>The repository infrastructure tries to autodetect custom implementation fragments by scanning for classes below the package in which it found a repository. These classes need to follow the naming convention of appending a postfix defaulting to Impl.</p>
<footer><strong>Spring Data JPA - Reference Documentation</strong><cite><a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.configuration">Configuration</a></cite></footer></blockquote>
<hr>
<h2 id="결론"><a href="#결론" class="headerlink" title="결론"></a>결론</h2><p> 결론적으로, Custom Repository를 작성할 때는 구현체 클래스에 postfix로 Impl가 붙게 만들어야 하고, interface와 같은 위치, 혹은 하위 패키지에 존재하도록 하여야 한다는 것을 알았다.</p>
<hr>
<h2 id="참고-사이트"><a href="#참고-사이트" class="headerlink" title="참고 사이트"></a>참고 사이트</h2><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.configuration">https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.configuration</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://stackoverflow.com/questions/47377989/spring-jpa-custom-repository-different-packages">https://stackoverflow.com/questions/47377989/spring-jpa-custom-repository-different-packages</a></li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a href="/2022/12/26/JPA-CustomRepository-%EC%9E%91%EC%84%B1-%EC%8B%9C-%EC%9C%A0%EC%9D%98%EC%82%AC%ED%95%AD/#post-footer" class="postShorten-excerpt_link link" aria-label>
                                댓글 공유
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2022/11/30/H2-DB%EC%97%90%EC%84%9C-2D-%EC%A2%8C%ED%91%9C-%EC%A0%80%EC%9E%A5%ED%95%98%EA%B8%B0/" aria-label=": H2 DB에서 2D 좌표 저장하기">
                            H2 DB에서 2D 좌표 저장하기
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2022-11-30T20:27:13+09:00">
	
		    2022/11/30
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="서론"><a href="#서론" class="headerlink" title="서론"></a>서론</h2><p> <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/jungguji/sokdak-sokdak">토이 프로젝트</a>를 진행 중, 장소의 위치의 위도, 경도 좌표를 저장해야 했는데, float type의 ‘latitude’, ‘longitude’라는 2개의 컬럼을 만들어서 각각 따로 저장하려고 했는데, 우연찮은 기회에 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/spatial-type-overview.html">공간 데이터 타입</a>이라는 것이 따로 있다는 것을 발견하여 적용해본 경험을 글로 작성하여 보려고 한다.</p>
<h2 id="본론"><a href="#본론" class="headerlink" title="본론"></a>본론</h2> <blockquote><p>공간(空間, 영어: space)은 어떤 물질 또는 물체가 존재할 수 있거나 어떤 일이 일어날 수 있는 장소이다.</p>
<footer><strong>위키백과</strong><cite><a target="_blank" rel="external nofollow noopener noreferrer" href="https://ko.wikipedia.org/wiki/%EA%B3%B5%EA%B0%84">공간</a></cite></footer></blockquote>

<br>

<p>공간 데이터란, 위 같은 점, 선, 면의 공간을 데이터화 한 것을 의미하는데, 필자는 지도에서 위치를 표시하기 위해 2D 공간 데이터인 점(Point) 데이터를 저장할 필요가 있었다.<br>필자는 Spring boot + JPA(Hibernate) + H2 환경을 사용하고 있어서, 공간 데이터를 다루기 위해 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.jboss.org/hibernate/orm/5.2/userguide/html_single/Hibernate_User_Guide.html#spatial">hibernate-spatial</a> 의존성을 추가해주었다.</p>
<br>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-spatial<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;hibernate.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<br>

<p>그 후, hibernate-spatial 라이브러리에 포함된 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/locationtech/jts">The JTS Topology Suite</a>를 사용해 좌표 데이터를 다루면 되는데, 위에서 말한 것처럼 필자는 2D 데이터를 다루기 위해 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://locationtech.github.io/jts/javadoc/org/locationtech/jts/geom/Point.html">Point</a>를 사용했다.</p>
<br>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.persistence.Column;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Embeddable;</span><br><span class="line"><span class="keyword">import</span> lombok.AccessLevel;</span><br><span class="line"><span class="keyword">import</span> lombok.Builder;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.locationtech.jts.geom.Point;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Embeddable</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor(access = AccessLevel.PROTECTED)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Address</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;road&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String road;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;jibun&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String jibun;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;zip&quot;, nullable = false)</span></span><br><span class="line">    <span class="keyword">private</span> String zip;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;location&quot;, nullable = false)</span></span><br><span class="line">    <span class="keyword">private</span> Point location;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Builder</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Address</span><span class="params">(String road, String jibun, String zip, Point location)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.road = road;</span><br><span class="line">        <span class="keyword">this</span>.jibun = jibun;</span><br><span class="line">        <span class="keyword">this</span>.zip = zip;</span><br><span class="line">        <span class="keyword">this</span>.location = location;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>만약 필자처럼 Point를 사용할 경우 org.springframework.data.geo.Point를 import하면 정상적으로 동작하지 않으므로, 꼭 import문을 확인하길 바란다.</li>
</ul>
<p>위처럼 당차게 Entity class를 작성하고, 아래 같은 테스트 데이터를 넣고, 호기롭게 테스트를 돌려본 결과…</p>
<h3 id="입력-데이터"><a href="#입력-데이터" class="headerlink" title="입력 데이터"></a>입력 데이터</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">2022</span>-<span class="number">11</span>-<span class="number">30</span> <span class="number">22</span>:<span class="number">48</span>:<span class="number">44.230</span> TRACE <span class="number">21788</span> --- [           main] o.h.type.descriptor.sql.BasicBinder      : binding parameter [<span class="number">1</span>] as [TIMESTAMP] - [<span class="keyword">null</span>]</span><br><span class="line"><span class="number">2022</span>-<span class="number">11</span>-<span class="number">30</span> <span class="number">22</span>:<span class="number">48</span>:<span class="number">44.231</span> TRACE <span class="number">21788</span> --- [           main] o.h.type.descriptor.sql.BasicBinder      : binding parameter [<span class="number">2</span>] as [TIMESTAMP] - [<span class="keyword">null</span>]</span><br><span class="line"><span class="number">2022</span>-<span class="number">11</span>-<span class="number">30</span> <span class="number">22</span>:<span class="number">48</span>:<span class="number">44.231</span> TRACE <span class="number">21788</span> --- [           main] o.h.type.descriptor.sql.BasicBinder      : binding parameter [<span class="number">3</span>] as [VARCHAR] - [지번 서울시]</span><br><span class="line"><span class="number">2022</span>-<span class="number">11</span>-<span class="number">30</span> <span class="number">22</span>:<span class="number">48</span>:<span class="number">44.232</span> TRACE <span class="number">21788</span> --- [           main] o.h.type.descriptor.sql.BasicBinder      : binding parameter [<span class="number">4</span>] as [VARBINARY] - [POINT (<span class="number">19</span> <span class="number">2</span>)]</span><br><span class="line"><span class="number">2022</span>-<span class="number">11</span>-<span class="number">30</span> <span class="number">22</span>:<span class="number">48</span>:<span class="number">44.233</span> TRACE <span class="number">21788</span> --- [           main] o.h.type.descriptor.sql.BasicBinder      : binding parameter [<span class="number">5</span>] as [VARCHAR] - [도로명 서울시]</span><br><span class="line"><span class="number">2022</span>-<span class="number">11</span>-<span class="number">30</span> <span class="number">22</span>:<span class="number">48</span>:<span class="number">44.234</span> TRACE <span class="number">21788</span> --- [           main] o.h.type.descriptor.sql.BasicBinder      : binding parameter [<span class="number">6</span>] as [VARCHAR] - [<span class="number">01006</span>]</span><br><span class="line"><span class="number">2022</span>-<span class="number">11</span>-<span class="number">30</span> <span class="number">22</span>:<span class="number">48</span>:<span class="number">44.235</span> TRACE <span class="number">21788</span> --- [           main] o.h.type.descriptor.sql.BasicBinder      : binding parameter [<span class="number">7</span>] as [BIGINT] - [<span class="keyword">null</span>]</span><br><span class="line"><span class="number">2022</span>-<span class="number">11</span>-<span class="number">30</span> <span class="number">22</span>:<span class="number">48</span>:<span class="number">44.235</span> TRACE <span class="number">21788</span> --- [           main] o.h.type.descriptor.sql.BasicBinder      : binding parameter [<span class="number">8</span>] as [VARCHAR] - [우리집]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>위 로그처럼 sql에 입력된 파라미터들이 보고 싶은 경우 아래처럼 설정을 추가해주면 된다.</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">org:</span></span><br><span class="line">      <span class="attr">hibernate:</span></span><br><span class="line">        <span class="attr">type:</span></span><br><span class="line">          <span class="attr">descriptor:</span></span><br><span class="line">            <span class="attr">sql:</span> <span class="string">trace</span></span><br></pre></td></tr></table></figure>


<h3 id="발생한-에러-로그"><a href="#발생한-에러-로그" class="headerlink" title="발생한 에러 로그"></a>발생한 에러 로그</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Caused by: org.h2.jdbc.JdbcSQLDataException: Value too <span class="keyword">long</span> <span class="keyword">for</span> column <span class="string">&quot;LOCATION BINARY VARYING(255)&quot;</span>: <span class="string">&quot;X&#x27;aced00057372001f6f72672e6c6f636174696f6e746563682e6a74732e67656f6d2e506f696e74... (1151)&quot;</span>; SQL statement:</span><br><span class="line"><span class="function">insert into <span class="title">place</span> <span class="params">(id, create_date, update_date, jibun, location, road, zip, category_id, name)</span> <span class="title">values</span> <span class="params">(<span class="keyword">default</span>, ?, ?, ?, ?, ?, ?, ?, ?)</span> [22001-214]</span></span><br><span class="line"><span class="function">	at org.h2.message.DbException.<span class="title">getJdbcSQLException</span><span class="params">(DbException.java:<span class="number">506</span>)</span></span></span><br><span class="line"><span class="function">	at org.h2.message.DbException.<span class="title">getJdbcSQLException</span><span class="params">(DbException.java:<span class="number">477</span>)</span></span></span><br><span class="line"><span class="function">	at org.h2.message.DbException.<span class="title">get</span><span class="params">(DbException.java:<span class="number">223</span>)</span></span></span><br><span class="line"><span class="function">	at org.h2.message.DbException.<span class="title">getValueTooLongException</span><span class="params">(DbException.java:<span class="number">322</span>)</span></span></span><br><span class="line"><span class="function">	at org.h2.value.Value.<span class="title">getValueTooLongException</span><span class="params">(Value.java:<span class="number">2573</span>)</span></span></span><br><span class="line"><span class="function">	at org.h2.value.Value.<span class="title">convertToVarbinary</span><span class="params">(Value.java:<span class="number">1371</span>)</span></span></span><br><span class="line"><span class="function">	at org.h2.value.Value.<span class="title">convertTo</span><span class="params">(Value.java:<span class="number">1125</span>)</span></span></span><br><span class="line"><span class="function">	at org.h2.value.Value.<span class="title">convertForAssignTo</span><span class="params">(Value.java:<span class="number">1092</span>)</span></span></span><br><span class="line"><span class="function">	at org.h2.table.Column.<span class="title">validateConvertUpdateSequence</span><span class="params">(Column.java:<span class="number">369</span>)</span></span></span><br><span class="line"><span class="function">	at org.h2.table.Table.<span class="title">convertInsertRow</span><span class="params">(Table.java:<span class="number">926</span>)</span></span></span><br><span class="line"><span class="function">	at org.h2.command.dml.Insert.<span class="title">insertRows</span><span class="params">(Insert.java:<span class="number">167</span>)</span></span></span><br><span class="line"><span class="function">	at org.h2.command.dml.Insert.<span class="title">update</span><span class="params">(Insert.java:<span class="number">135</span>)</span></span></span><br><span class="line"><span class="function">	at org.h2.command.CommandContainer.<span class="title">executeUpdateWithGeneratedKeys</span><span class="params">(CommandContainer.java:<span class="number">242</span>)</span></span></span><br><span class="line"><span class="function">	at org.h2.command.CommandContainer.<span class="title">update</span><span class="params">(CommandContainer.java:<span class="number">163</span>)</span></span></span><br><span class="line"><span class="function">	at org.h2.command.Command.<span class="title">executeUpdate</span><span class="params">(Command.java:<span class="number">252</span>)</span></span></span><br><span class="line"><span class="function">	at org.h2.jdbc.JdbcPreparedStatement.<span class="title">executeUpdateInternal</span><span class="params">(JdbcPreparedStatement.java:<span class="number">209</span>)</span></span></span><br><span class="line"><span class="function">	at org.h2.jdbc.JdbcPreparedStatement.<span class="title">executeUpdate</span><span class="params">(JdbcPreparedStatement.java:<span class="number">169</span>)</span></span></span><br><span class="line"><span class="function">	at com.zaxxer.hikari.pool.ProxyPreparedStatement.<span class="title">executeUpdate</span><span class="params">(ProxyPreparedStatement.java:<span class="number">61</span>)</span></span></span><br><span class="line"><span class="function">	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.<span class="title">executeUpdate</span><span class="params">(HikariProxyPreparedStatement.java)</span></span></span><br><span class="line"><span class="function">	at org.hibernate.engine.jdbc.internal.ResultSetReturnImpl.<span class="title">executeUpdate</span><span class="params">(ResultSetReturnImpl.java:<span class="number">197</span>)</span></span></span><br><span class="line"><span class="function">	... 136 more</span></span><br></pre></td></tr></table></figure>

<br>

<h3 id="테이블-생성-SQL"><a href="#테이블-생성-SQL" class="headerlink" title="테이블 생성 SQL"></a>테이블 생성 SQL</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> place (</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">bigint</span> <span class="keyword">generated</span> <span class="keyword">by</span> <span class="keyword">default</span> <span class="keyword">as</span> <span class="keyword">identity</span>,</span><br><span class="line">    create_date <span class="built_in">timestamp</span>,</span><br><span class="line">    update_date <span class="built_in">timestamp</span>,</span><br><span class="line">    jibun <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    location varbinary(<span class="number">255</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    road <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    zip <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    category_id <span class="built_in">bigint</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    primary <span class="keyword">key</span> (<span class="keyword">id</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>이처럼 예상하지 못한 결과가 발생하였는데… 로그를 보니, table create 시 좌표를 저장하는 컬럼의 타입이 기대했던 <a target="_blank" rel="external nofollow noopener noreferrer" href="http://www.h2database.com/html/datatypes.html#geometry_type">GEOMETRY</a>이 아닌, varbinary 타입으로 생성되어서 발생한 에러인가 싶어서 컬럼 타입을 “GEOMETRY”로 지정하고 생성해봤지만, 결과는 마찬가지였다.</p>
<h3 id="수정한-코드-및-실행된-SQL"><a href="#수정한-코드-및-실행된-SQL" class="headerlink" title="수정한 코드 및 실행된 SQL"></a>수정한 코드 및 실행된 SQL</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// columnDefinition 속성으로 컬럼 타입 지정</span></span><br><span class="line"><span class="meta">@Column(name = &quot;location&quot;, nullable = false, columnDefinition = &quot;GEOMETRY&quot;)</span> </span><br><span class="line"><span class="keyword">private</span> Point location;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> place (</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">bigint</span> <span class="keyword">generated</span> <span class="keyword">by</span> <span class="keyword">default</span> <span class="keyword">as</span> <span class="keyword">identity</span>,</span><br><span class="line">    create_date <span class="built_in">timestamp</span>,</span><br><span class="line">    update_date <span class="built_in">timestamp</span>,</span><br><span class="line">    jibun <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    location GEOMETRY <span class="keyword">not</span> <span class="literal">null</span>, <span class="comment">-- 정상적으로 컬럼의 데이터 타입이 GEOMETRY로 변경</span></span><br><span class="line">    road <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    zip <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    category_id <span class="built_in">bigint</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    primary <span class="keyword">key</span> (<span class="keyword">id</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>다시 원인을 검색해본 결과… hibernate-spatial에서는 H2가 아닌 H2의 확장 데이터베이스인 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/jdeolive/geodb">GeoDB</a>를 지원한다고 되어있는 것을 확인할 수 있었다.</p>
<blockquote><p>The GeoDBDialect supports the GeoDB a spatial extension of the H2 in-memory database.</p>
<footer><strong>Hibernate Docs</strong><cite><a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.jboss.org/hibernate/orm/5.2/userguide/html_single/Hibernate_User_Guide.html#spatial">GeoDB (H2)</a></cite></footer></blockquote>

<p>그 후 GeoDB를 적용하기 위해 properties 혹은 yaml에 아래처럼 dialect 설정에 org.hibernate.spatial.dialect.h2geodb.GeoDBDialect를 추가해 주면,</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:h2:mem:test</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">sa</span></span><br><span class="line">    <span class="attr">password:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">org.h2.Driver</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">jpa:</span></span><br><span class="line">    <span class="attr">database-platform:</span> <span class="string">org.hibernate.dialect.H2Dialect</span></span><br><span class="line">    <span class="attr">defer-datasource-initialization:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">hibernate:</span></span><br><span class="line">      <span class="attr">ddl-auto:</span> <span class="string">create-drop</span></span><br><span class="line">    <span class="attr">show-sql:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">hibernate:</span></span><br><span class="line">        <span class="attr">dialect:</span> <span class="string">org.hibernate.spatial.dialect.h2geodb.GeoDBDialect</span> <span class="comment"># 추가 혹은 변경</span></span><br></pre></td></tr></table></figure>

<h3 id="dialect-설정-전-dialect"><a href="#dialect-설정-전-dialect" class="headerlink" title="dialect 설정 전 dialect"></a>dialect 설정 전 dialect</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2022</span>-<span class="number">11</span>-<span class="number">30</span> <span class="number">23</span>:<span class="number">37</span>:<span class="number">47.975</span>  INFO <span class="number">15720</span> --- [           main] org.hibernate.dialect.Dialect            : HHH000400: Using dialect: org.hibernate.dialect.H2Dialect</span><br></pre></td></tr></table></figure>

<h3 id="dialect-설정-후-dialect"><a href="#dialect-설정-후-dialect" class="headerlink" title="dialect 설정 후 dialect"></a>dialect 설정 후 dialect</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2022</span>-<span class="number">11</span>-<span class="number">30</span> <span class="number">23</span>:<span class="number">35</span>:<span class="number">42.124</span>  INFO <span class="number">18400</span> --- [           main] org.hibernate.dialect.Dialect            : HHH000400: Using dialect: org.hibernate.spatial.dialect.h2geodb.GeoDBDialect</span><br></pre></td></tr></table></figure>

<br>

<img src="/2022/11/30/H2-DB%EC%97%90%EC%84%9C-2D-%EC%A2%8C%ED%91%9C-%EC%A0%80%EC%9E%A5%ED%95%98%EA%B8%B0/1_%ED%85%8C%EC%8A%A4%ED%8A%B8%EC%84%B1%EA%B3%B5.PNG" class>

<br>

<p>이처럼 테스트가 성공하는 모습을  확인할 수 있었다.</p>
<hr>
<h2 id="참고-사이트"><a href="#참고-사이트" class="headerlink" title="참고 사이트"></a>참고 사이트</h2><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://stackoverflow.com/questions/44261899/geometry-datatype-in-h2-w-spring-jpa">https://stackoverflow.com/questions/44261899/geometry-datatype-in-h2-w-spring-jpa</a></li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a href="/2022/11/30/H2-DB%EC%97%90%EC%84%9C-2D-%EC%A2%8C%ED%91%9C-%EC%A0%80%EC%9E%A5%ED%95%98%EA%B8%B0/#post-footer" class="postShorten-excerpt_link link" aria-label>
                                댓글 공유
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2022/10/16/Intelli-J-%EC%BD%94%EB%93%9C-%EC%9E%90%EB%8F%99%EC%83%9D%EC%84%B1-with-Live-Template/" aria-label=": Intelli J 코드 자동생성(with Live Template)">
                            Intelli J 코드 자동생성(with Live Template)
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2022-10-16T15:53:21+09:00">
	
		    2022/10/16
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="서론"><a href="#서론" class="headerlink" title="서론"></a>서론</h2><p> 필자는 항상 단순하고 반복적인 일은 기계가 하고, 사람은 사색해야 한다고 생각한다. 당연하지만 이러한 생각은, 코딩할 때도 마찬가지다. class를 생성할 때마다 붙여야 하는 Annotation들을 (예를 들면 @Getter 같은) 붙이는 게 그렇게 귀찮을 수가 없었는데… 그러던 중 Intelli J의 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://blog.jetbrains.com/ko/2020/05/18/write-code-faster-using-live-templates-ko/">Live Template</a> 이라는 기능을 발견하여 필자 같은 사람들의 고통을 줄여 주고자 이 글을 작성한다.</p>
<hr>
<h2 id="본론"><a href="#본론" class="headerlink" title="본론"></a>본론</h2><img src="/2022/10/16/Intelli-J-%EC%BD%94%EB%93%9C-%EC%9E%90%EB%8F%99%EC%83%9D%EC%84%B1-with-Live-Template/1_settings.PNG" class title="Perference창">

<br>
우선 위 이미지처럼 preference(settings)을 열어서 'Live Templates'를 검색해서 Live Templates 메뉴를 클릭한다.

<img src="/2022/10/16/Intelli-J-%EC%BD%94%EB%93%9C-%EC%9E%90%EB%8F%99%EC%83%9D%EC%84%B1-with-Live-Template/2_template_group.png" class title="Template group 생성">

<br>

<p>열면 오른쪽에 여러 Template 그룹들이 존재하는데 필자처럼 Java가 없다면 Java 그룹을 생성해주거나, 기존 그룹에 탬플릿만 추가하여도 된다.</p>
<img src="/2022/10/16/Intelli-J-%EC%BD%94%EB%93%9C-%EC%9E%90%EB%8F%99%EC%83%9D%EC%84%B1-with-Live-Template/3_template_%EC%83%9D%EC%84%B1.PNG" class title="Template 생성">

<br>

<p>필자는 Entity 클래스를 생성하거나, request, response dto를 생성할 때마다 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor(access = AccessLevel.PROTECTED)</span></span><br></pre></td></tr></table></figure>

<p>annotation을 붙이는게 너무 귀찮아서 위 코드를 탬플릿으로 지정하고 단축키는 ‘gn’으로 설정해줬다.</p>
<img src="/2022/10/16/Intelli-J-%EC%BD%94%EB%93%9C-%EC%9E%90%EB%8F%99%EC%83%9D%EC%84%B1-with-Live-Template/4_template_%EC%A0%81%EC%9A%A9%EC%9C%84%EC%B9%98.png" class title="Template 생성">

<br>

<p>그리고 해당 annotation들은 class에만 적용하면 되므로 Declaration으로만 지정해주었다.</p>
<img src="/2022/10/16/Intelli-J-%EC%BD%94%EB%93%9C-%EC%9E%90%EB%8F%99%EC%83%9D%EC%84%B1-with-Live-Template/5_%EC%83%9D%EC%84%B1.gif" class title="탬플릿화 한 코드 생성">

<br>

<p>모든 설정을 완료하고 이제 설정한 단축키를 지정한 위치에서 사용해보면 이처럼 간단하게 우리가 탬플릿화한 코드가 자동으로 생성되는 모습을 볼 수 있다.</p>
<p>이 글에선 소개하지 않았지만, template text를 입력하는 곳에서 <code>$METHOD_NAME$</code> 처럼 <code>$$</code> 으로 변수를 선언하여 사용하는 방법들도 있으니, 필요한 사람들은 꼭 활용하여 생산성을 높일 수 있기를 바란다. </p>
<hr>
<h2 id="결론"><a href="#결론" class="headerlink" title="결론"></a>결론</h2><p> 이렇게 우리는 또 작은 할 일과 짧은 시간을 기계에 넘기고 다른 생산적인 일을 할 시간을 얻을 수 있었다. 티끌 모아 태산이라는 말이 있듯이 이런 작은 일들이 줄여서 큰일을 할 수 있기를 바라며 글을 마친다.</p>
<h2 id="참고-사이트"><a href="#참고-사이트" class="headerlink" title="참고 사이트"></a>참고 사이트</h2><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://velog.io/@max9106/IntelliJ-Live-Template">https://velog.io/@max9106/IntelliJ-Live-Template</a></li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a href="/2022/10/16/Intelli-J-%EC%BD%94%EB%93%9C-%EC%9E%90%EB%8F%99%EC%83%9D%EC%84%B1-with-Live-Template/#post-footer" class="postShorten-excerpt_link link" aria-label>
                                댓글 공유
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2022/09/09/Neither-BindingResult-nor-plain-target-object-for-bean-name-command-available-as-request-attribute/" aria-label=": Neither BindingResult nor plain target object for bean name command available as request attribute">
                            Neither BindingResult nor plain target object for bean name command available as request attribute
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2022-09-09T16:24:22+09:00">
	
		    2022/09/09
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="발생-경위"><a href="#발생-경위" class="headerlink" title="발생 경위"></a>발생 경위</h2><p>기존 Spring 4.3.3을 사용하던 프로젝트를 5.3.22으로 업그레이드 이후 발생하였다.</p>
<h3 id="에러로그-전체"><a href="#에러로그-전체" class="headerlink" title="에러로그 전체"></a>에러로그 전체</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line">java.lang.IllegalStateException: Neither BindingResult nor plain target object <span class="keyword">for</span> bean name <span class="string">&#x27;command&#x27;</span> available as request attribute</span><br><span class="line">	at org.springframework.web.servlet.support.BindStatus.&lt;init&gt;(BindStatus.java:<span class="number">153</span>)</span><br><span class="line">	at org.springframework.web.servlet.tags.form.AbstractDataBoundFormElementTag.getBindStatus(AbstractDataBoundFormElementTag.java:<span class="number">178</span>)</span><br><span class="line">	at org.springframework.web.servlet.tags.form.AbstractDataBoundFormElementTag.getPropertyPath(AbstractDataBoundFormElementTag.java:<span class="number">199</span>)</span><br><span class="line">	at org.springframework.web.servlet.tags.form.AbstractDataBoundFormElementTag.getName(AbstractDataBoundFormElementTag.java:<span class="number">164</span>)</span><br><span class="line">	at org.springframework.web.servlet.tags.form.AbstractDataBoundFormElementTag.writeDefaultAttributes(AbstractDataBoundFormElementTag.java:<span class="number">123</span>)</span><br><span class="line">	at org.springframework.web.servlet.tags.form.AbstractHtmlElementTag.writeDefaultAttributes(AbstractHtmlElementTag.java:<span class="number">460</span>)</span><br><span class="line">	at org.springframework.web.servlet.tags.form.SelectTag.writeTagContent(SelectTag.java:<span class="number">405</span>)</span><br><span class="line">	at org.springframework.web.servlet.tags.form.AbstractFormTag.doStartTagInternal(AbstractFormTag.java:<span class="number">87</span>)</span><br><span class="line">	at org.springframework.web.servlet.tags.RequestContextAwareTag.doStartTag(RequestContextAwareTag.java:<span class="number">83</span>)</span><br><span class="line">	at org.apache.jsp.WEB_002dINF.xxxx.xxxx.xxxx_jsp._jspService(new_jsp.java:<span class="number">263</span>)</span><br><span class="line">	at org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:<span class="number">70</span>)</span><br><span class="line">	at javax.servlet.http.HttpServlet.service(HttpServlet.java:<span class="number">741</span>)</span><br><span class="line">	at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:<span class="number">476</span>)</span><br><span class="line">	at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:<span class="number">386</span>)</span><br><span class="line">	at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:<span class="number">330</span>)</span><br><span class="line">	at javax.servlet.http.HttpServlet.service(HttpServlet.java:<span class="number">741</span>)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:<span class="number">231</span>)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:<span class="number">166</span>)</span><br><span class="line">	at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:<span class="number">728</span>)</span><br><span class="line">	at org.apache.catalina.core.ApplicationDispatcher.doInclude(ApplicationDispatcher.java:<span class="number">591</span>)</span><br><span class="line">	at org.apache.catalina.core.ApplicationDispatcher.include(ApplicationDispatcher.java:<span class="number">527</span>)</span><br><span class="line">	at org.apache.jasper.runtime.JspRuntimeLibrary.include(JspRuntimeLibrary.java:<span class="number">868</span>)</span><br><span class="line">	at org.apache.jasper.runtime.PageContextImpl.doInclude(PageContextImpl.java:<span class="number">679</span>)</span><br><span class="line">	at org.apache.jasper.runtime.PageContextImpl.include(PageContextImpl.java:<span class="number">673</span>)</span><br><span class="line">	at org.apache.tiles.request.jsp.JspRequest.doInclude(JspRequest.java:<span class="number">123</span>)</span><br><span class="line">	at org.apache.tiles.request.AbstractViewRequest.dispatch(AbstractViewRequest.java:<span class="number">47</span>)</span><br><span class="line">	at org.apache.tiles.request.render.DispatchRenderer.render(DispatchRenderer.java:<span class="number">45</span>)</span><br><span class="line">	at org.apache.tiles.request.render.ChainedDelegateRenderer.render(ChainedDelegateRenderer.java:<span class="number">68</span>)</span><br><span class="line">	at org.apache.tiles.impl.BasicTilesContainer.render(BasicTilesContainer.java:<span class="number">259</span>)</span><br><span class="line">	at org.apache.tiles.template.InsertAttributeModel.renderAttribute(InsertAttributeModel.java:<span class="number">188</span>)</span><br><span class="line">	at org.apache.tiles.template.InsertAttributeModel.execute(InsertAttributeModel.java:<span class="number">132</span>)</span><br><span class="line">	at org.apache.tiles.jsp.taglib.InsertAttributeTag.doTag(InsertAttributeTag.java:<span class="number">299</span>)</span><br><span class="line">	at org.apache.jsp.WEB_002dINF.xxxx.xxxx.xxxx_jsp._jspx_meth_t_005finsertAttribute_005f4(layout_jsp.java:<span class="number">10881</span>)</span><br><span class="line">	at org.apache.jsp.WEB_002dINF.xxxx.xxxx.xxxx_jsp._jspService(layout_jsp.java:<span class="number">1242</span>)</span><br><span class="line">	at org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:<span class="number">70</span>)</span><br><span class="line">	at javax.servlet.http.HttpServlet.service(HttpServlet.java:<span class="number">741</span>)</span><br><span class="line">	at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:<span class="number">476</span>)</span><br><span class="line">	at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:<span class="number">386</span>)</span><br><span class="line">	at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:<span class="number">330</span>)</span><br><span class="line">	at javax.servlet.http.HttpServlet.service(HttpServlet.java:<span class="number">741</span>)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:<span class="number">231</span>)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:<span class="number">166</span>)</span><br><span class="line">	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:<span class="number">52</span>)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:<span class="number">193</span>)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:<span class="number">166</span>)</span><br><span class="line">	at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:<span class="number">728</span>)</span><br><span class="line">	at org.apache.catalina.core.ApplicationDispatcher.processRequest(ApplicationDispatcher.java:<span class="number">470</span>)</span><br><span class="line">	at org.apache.catalina.core.ApplicationDispatcher.doForward(ApplicationDispatcher.java:<span class="number">395</span>)</span><br><span class="line">	at org.apache.catalina.core.ApplicationDispatcher.forward(ApplicationDispatcher.java:<span class="number">316</span>)</span><br><span class="line">	at org.apache.tiles.request.servlet.ServletRequest.forward(ServletRequest.java:<span class="number">265</span>)</span><br><span class="line">	at org.apache.tiles.request.servlet.ServletRequest.doForward(ServletRequest.java:<span class="number">228</span>)</span><br><span class="line">	at org.apache.tiles.request.AbstractClientRequest.dispatch(AbstractClientRequest.java:<span class="number">57</span>)</span><br><span class="line">	at org.apache.tiles.request.render.DispatchRenderer.render(DispatchRenderer.java:<span class="number">45</span>)</span><br><span class="line">	at org.apache.tiles.impl.BasicTilesContainer.render(BasicTilesContainer.java:<span class="number">259</span>)</span><br><span class="line">	at org.apache.tiles.impl.BasicTilesContainer.render(BasicTilesContainer.java:<span class="number">397</span>)</span><br><span class="line">	at org.apache.tiles.impl.BasicTilesContainer.render(BasicTilesContainer.java:<span class="number">238</span>)</span><br><span class="line">	at org.apache.tiles.impl.BasicTilesContainer.render(BasicTilesContainer.java:<span class="number">221</span>)</span><br><span class="line">	at org.apache.tiles.renderer.DefinitionRenderer.render(DefinitionRenderer.java:<span class="number">59</span>)</span><br><span class="line">	at org.springframework.web.servlet.view.tiles3.TilesView.renderMergedOutputModel(TilesView.java:<span class="number">147</span>)</span><br><span class="line">	at org.springframework.web.servlet.view.AbstractView.render(AbstractView.java:<span class="number">316</span>)</span><br><span class="line">	at org.springframework.web.servlet.DispatcherServlet.render(DispatcherServlet.java:<span class="number">1404</span>)</span><br><span class="line">	at org.springframework.web.servlet.DispatcherServlet.processDispatchResult(DispatcherServlet.java:<span class="number">1148</span>)</span><br><span class="line">	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:<span class="number">1087</span>)</span><br><span class="line">	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:<span class="number">963</span>)</span><br><span class="line">	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:<span class="number">1006</span>)</span><br><span class="line">	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:<span class="number">898</span>)</span><br><span class="line">	at javax.servlet.http.HttpServlet.service(HttpServlet.java:<span class="number">634</span>)</span><br><span class="line">	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:<span class="number">883</span>)</span><br><span class="line">	at javax.servlet.http.HttpServlet.service(HttpServlet.java:<span class="number">741</span>)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:<span class="number">231</span>)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:<span class="number">166</span>)</span><br><span class="line">	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:<span class="number">52</span>)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:<span class="number">193</span>)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:<span class="number">166</span>)</span><br><span class="line">	at org.apache.catalina.filters.ExpiresFilter.doFilter(ExpiresFilter.java:<span class="number">1228</span>)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:<span class="number">193</span>)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:<span class="number">166</span>)</span><br><span class="line">	at org.springframework.orm.jpa.support.OpenEntityManagerInViewFilter.doFilterInternal(OpenEntityManagerInViewFilter.java:<span class="number">186</span>)</span><br><span class="line">	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:<span class="number">117</span>)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:<span class="number">193</span>)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:<span class="number">166</span>)</span><br><span class="line">	at org.springframework.web.filter.HiddenHttpMethodFilter.doFilterInternal(HiddenHttpMethodFilter.java:<span class="number">94</span>)</span><br><span class="line">	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:<span class="number">117</span>)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:<span class="number">193</span>)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:<span class="number">166</span>)</span><br><span class="line">	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:<span class="number">330</span>)</span><br><span class="line">	at org.springframework.security.web.access.intercept.FilterSecurityInterceptor.invoke(FilterSecurityInterceptor.java:<span class="number">118</span>)</span><br><span class="line">	at org.springframework.security.web.access.intercept.FilterSecurityInterceptor.doFilter(FilterSecurityInterceptor.java:<span class="number">84</span>)</span><br><span class="line">	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:<span class="number">342</span>)</span><br><span class="line">	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:<span class="number">113</span>)</span><br><span class="line">	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:<span class="number">342</span>)</span><br><span class="line">	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:<span class="number">103</span>)</span><br><span class="line">	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:<span class="number">342</span>)</span><br><span class="line">	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:<span class="number">113</span>)</span><br><span class="line">	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:<span class="number">342</span>)</span><br><span class="line">	at org.springframework.security.web.authentication.rememberme.RememberMeAuthenticationFilter.doFilter(RememberMeAuthenticationFilter.java:<span class="number">146</span>)</span><br><span class="line">	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:<span class="number">342</span>)</span><br><span class="line">	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:<span class="number">154</span>)</span><br><span class="line">	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:<span class="number">342</span>)</span><br><span class="line">	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:<span class="number">45</span>)</span><br><span class="line">	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:<span class="number">342</span>)</span><br><span class="line">	at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:<span class="number">199</span>)</span><br><span class="line">	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:<span class="number">342</span>)</span><br><span class="line">	at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:<span class="number">199</span>)</span><br><span class="line">	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:<span class="number">342</span>)</span><br><span class="line">	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:<span class="number">110</span>)</span><br><span class="line">	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:<span class="number">342</span>)</span><br><span class="line">	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:<span class="number">57</span>)</span><br><span class="line">	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:<span class="number">117</span>)</span><br><span class="line">	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:<span class="number">342</span>)</span><br><span class="line">	at org.springframework.security.web.context.SecurityContextPersistenceFilter.doFilter(SecurityContextPersistenceFilter.java:<span class="number">87</span>)</span><br><span class="line">	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:<span class="number">342</span>)</span><br><span class="line">	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:<span class="number">50</span>)</span><br><span class="line">	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:<span class="number">117</span>)</span><br><span class="line">	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:<span class="number">342</span>)</span><br><span class="line">	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:<span class="number">192</span>)</span><br><span class="line">	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:<span class="number">160</span>)</span><br><span class="line">	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:<span class="number">354</span>)</span><br><span class="line">	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:<span class="number">267</span>)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:<span class="number">193</span>)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:<span class="number">166</span>)</span><br><span class="line">	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:<span class="number">201</span>)</span><br><span class="line">	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:<span class="number">117</span>)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:<span class="number">193</span>)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:<span class="number">166</span>)</span><br><span class="line">	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:<span class="number">199</span>)</span><br><span class="line">	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:<span class="number">96</span>)</span><br><span class="line">	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:<span class="number">543</span>)</span><br><span class="line">	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:<span class="number">139</span>)</span><br><span class="line">	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:<span class="number">81</span>)</span><br><span class="line">	at org.apache.catalina.valves.AbstractAccessLogValve.invoke(AbstractAccessLogValve.java:<span class="number">678</span>)</span><br><span class="line">	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:<span class="number">87</span>)</span><br><span class="line">	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:<span class="number">343</span>)</span><br><span class="line">	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:<span class="number">609</span>)</span><br><span class="line">	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:<span class="number">65</span>)</span><br><span class="line">	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:<span class="number">810</span>)</span><br><span class="line">	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:<span class="number">1623</span>)</span><br><span class="line">	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:<span class="number">49</span>)</span><br><span class="line">	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:<span class="number">1128</span>)</span><br><span class="line">	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:<span class="number">628</span>)</span><br><span class="line">	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:<span class="number">61</span>)</span><br><span class="line">	at java.base/java.lang.Thread.run(Thread.java:<span class="number">829</span>)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="해결-과정"><a href="#해결-과정" class="headerlink" title="해결 과정"></a>해결 과정</h2><h3 id="에러로그-일부"><a href="#에러로그-일부" class="headerlink" title="에러로그 일부"></a>에러로그 일부</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">	</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">java.lang.IllegalStateException: Neither BindingResult nor plain target object <span class="keyword">for</span> bean name <span class="string">&#x27;command&#x27;</span> available as request attribute</span><br><span class="line">  at org.springframework.web.servlet.support.BindStatus.&lt;init&gt;(BindStatus.java:<span class="number">153</span>)</span><br><span class="line">	at org.springframework.web.servlet.tags.form.AbstractDataBoundFormElementTag.getBindStatus(AbstractDataBoundFormElementTag.java:<span class="number">178</span>)</span><br><span class="line">	at org.springframework.web.servlet.tags.form.AbstractDataBoundFormElementTag.getPropertyPath(AbstractDataBoundFormElementTag.java:<span class="number">199</span>)</span><br><span class="line">	at org.springframework.web.servlet.tags.form.AbstractDataBoundFormElementTag.getName(AbstractDataBoundFormElementTag.java:<span class="number">164</span>)</span><br><span class="line">	at org.springframework.web.servlet.tags.form.AbstractDataBoundFormElementTag.writeDefaultAttributes(AbstractDataBoundFormElementTag.java:<span class="number">123</span>)</span><br><span class="line">	at org.springframework.web.servlet.tags.form.AbstractHtmlElementTag.writeDefaultAttributes(AbstractHtmlElementTag.java:<span class="number">460</span>)</span><br><span class="line">	at org.springframework.web.servlet.tags.form.SelectTag.writeTagContent(SelectTag.java:<span class="number">405</span>)</span><br><span class="line">	at org.springframework.web.servlet.tags.form.AbstractFormTag.doStartTagInternal(AbstractFormTag.java:<span class="number">87</span>)</span><br><span class="line">	at org.springframework.web.servlet.tags.RequestContextAwareTag.doStartTag(RequestContextAwareTag.java:<span class="number">83</span>)</span><br><span class="line">	at org.apache.jsp.WEB_002dINF.xxxx.xxxx.xxxx_jsp._jspService(new_jsp.java:<span class="number">263</span>)</span><br><span class="line"></span><br><span class="line">  ....</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>
> Neither BindingResult nor plain target object for bean name 'command' available as request attribute

<br>

<p>짧은 영어 실력과 구글 번역기에 도움으로 해석해보자면 BindingResult이나 ‘command’ 이라는 이름의 bean 을 request의 속성으로 사용할 수 없어서 발생하는 에러인 것 같은데,<br>에러 로그를 확인 한 결과… 위에서 보이는 것 처럼, JSP의 Form Tag에서 에러가 발생하는 것으로 추측되어 4.3.3 version에서 Form Tag를 구현하는 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.spring.io/spring-framework/docs/4.3.3.RELEASE/javadoc-api/org/springframework/web/servlet/tags/form/FormTag.html#setCommandName-java.lang.String-">FormTag</a>를 확인해보니 commandName 관련된 메서드들이 @Deprecated 로 선언되어서 곧 없어진다고 알려주고 있었는데, 이번에 업그레이드한 5.3.22 version의 FormTag에선 commandName의 getter, setter 메서드들이 없는 것을 확인할 수 있었다.</p>
<img src="/2022/09/09/Neither-BindingResult-nor-plain-target-object-for-bean-name-command-available-as-request-attribute/4.3.3_FormTag.png" class title="4.3.3 version의 CommandName 관련 method">

<br>

<p>그리고 이미지를 보면 알 수 있듯이 기존의 setCommandName 메서드에서도 modelAttribute에 commandName을 저장해서 쓰는 것을 확인할 수 있는데, 5.3.22 에선 해당 메서드가 없어지면서 변수 modelAttribute에 ‘command’가 할당되어 있기에, ‘command’ 라는 bean을 속성으로 사용할 수 없다고 에러가 발생하는 것이었다.</p>
<img src="/2022/09/09/Neither-BindingResult-nor-plain-target-object-for-bean-name-command-available-as-request-attribute/default_modelAttribute.png" class title="modelAttribute 변수의 기본값">

<br>

<img src="/2022/09/09/Neither-BindingResult-nor-plain-target-object-for-bean-name-command-available-as-request-attribute/getModelAttribute.png" class title="Form tag 호출 시 불리는 modelAttribute의 값">

<br>

<p>이렇게 된 것이니 당연하게도 해결 방법은 modelAttribute에 우리가 지정한 속성값이 set 되도록 하면 되는데, 위에서 본 것처럼 기존의 setCommandName에서도 modelAttribute의 값을 사용하고 있었으므로, setModelAttribute로 modelAttribute 값이 저장되도록 하면 문제는 해결될 것이기에, JSP form tag에 commandName 속성을 모두 modelAttribute로 변경한 후 확인해 보면 정상적으로 동작 하는 것을 확인할 수 있을 것이다.</p>
<img src="/2022/09/09/Neither-BindingResult-nor-plain-target-object-for-bean-name-command-available-as-request-attribute/setModelAttribute.png" class title="commandName 속성을 ModelAttribute로 변경 후 Form tag 호출 시 불리는 modelAttribute의 값">

<br>

<img src="/2022/09/09/Neither-BindingResult-nor-plain-target-object-for-bean-name-command-available-as-request-attribute/getModelAttribute_2.png" class title="commandName 속성을 ModelAttribute로 변경 후 Form tag 호출 시 불리는 modelAttribute의 값">
<hr>
<h2 id="참고-사이트"><a href="#참고-사이트" class="headerlink" title="참고 사이트"></a>참고 사이트</h2><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://web-obj.tistory.com/478">https://web-obj.tistory.com/478</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.spring.io/spring-framework/docs/4.3.3.RELEASE/javadoc-api/org/springframework/web/servlet/tags/form/FormTag.html#setCommandName-java.lang.String-">https://docs.spring.io/spring-framework/docs/4.3.3.RELEASE/javadoc-api/org/springframework/web/servlet/tags/form/FormTag.html#setCommandName-java.lang.String-</a></li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a href="/2022/09/09/Neither-BindingResult-nor-plain-target-object-for-bean-name-command-available-as-request-attribute/#post-footer" class="postShorten-excerpt_link link" aria-label>
                                댓글 공유
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2022/08/07/Nexus%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%AA%A8%EB%93%88%ED%99%94/" aria-label=": Nexus를 이용한 모듈화">
                            Nexus를 이용한 모듈화
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2022-08-07T20:14:31+09:00">
	
		    2022/08/07
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="서론"><a href="#서론" class="headerlink" title="서론"></a>서론</h2><p> 현재 운영 중인 서비스는 같은 데이터베이스를 공유하는 5개의 프로젝트가 존재하는데, 모두 Spring or Spring boot + JPA를 사용하는 프로젝트들이다.</p>
<p> 이 때문에, 한 프로젝트에서 도메인(Entity) 클래스에 변수를 추가한 경우에 다른 모든 프로젝트에서도 동일하게 추가 해주지 않으면 데이터베이스 조회 시 등 에러가 발생 할 수 밖에 없는데 이런 copy &amp; paste 반복 작업을 개발자가 손수 하다보면 휴먼에러가 발생할 수 밖에 없음은 물론 같은 데이터베이스를 사용하는 Entity 임에도 불구하고 코드가 모두 다른 이상한 상황이 발생 할 수 밖에 없는 구조였다.</p>
<p> 그렇기에 어떻게 할까 고민하던 중 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://techblog.woowahan.com/2637/">멀티모듈 설계 이야기 with Spring, Gradle</a> 이라는 글을 보고 필자의 서비스에도 단일 프로젝트 멀티모듈 구조로 가져갈 까 하다, 각각의 프로젝트마자 깃을 따로 관리하는게 서비스에는 맞다는 생각이 들어 멀티 프로젝트에 Nexus maven 저장소를 이용해서 도메인 클래스들을 분리 시키기로 했다.</p>
<hr>
<h2 id="본론"><a href="#본론" class="headerlink" title="본론"></a>본론</h2><h3 id="현재-시스템의-구조"><a href="#현재-시스템의-구조" class="headerlink" title="현재 시스템의 구조"></a>현재 시스템의 구조</h3><img src="/2022/08/07/Nexus%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%AA%A8%EB%93%88%ED%99%94/%ED%98%84%EC%9E%AC_%EA%B5%AC%EC%A1%B0.png" class title="현재 서비스 구조">

<p>이 처럼 여러 개의 프로젝트가 하나의 데이터베이스를 공유하는 구조로, 같은 데이터베이스 이므로 동일한 내용의 도메인 클래스가 각자 프로젝트에 각각 중복으로 존재하기 때문에 관리가 힘든 상황이다.</p>
<p>때문에 도메인 클래슬들만 모아놓은 새로운 프로젝트를 생성하고, 그 프로젝트를 jar파일로 만들어 라이브러리화 한 후, 내부 Maven 저장소인 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.sonatype.com/products/nexus-repository">Nexus</a>에 업로드해서 다른 프로젝트들에서 dependency에 추가해서 시스템적으로 정합성을 유지하면서 사용 할 수 있게 하려고 한다.</p>
<p>간단하게 정리하면</p>
<ol>
<li>Nexus에 모듈화된 도메인 프로젝트 업로드</li>
<li>다른 프로젝트들에서 라이브러리화 된 도메인 프로젝트를 dependency  추가하여 사용</li>
</ol>
<p>하는 것이 이번 글의 목표이다.</p>
<p><strong>이 포스트에 Nexus를 설치하는 내용까지 담으려고 하니 내용이 너무 길어질 것 같아 nexus는 이미 설치되어 있다고 가정한다.</strong> </p>
<hr>
<h3 id="1-Nexus-설정"><a href="#1-Nexus-설정" class="headerlink" title="1. Nexus 설정"></a>1. Nexus 설정</h3><p>다른 분들의 글들을 보고 nexus를 무사히 설치하고 실행하면 아래와 같은 화면을 볼 수 있을 것이다.</p>
<img src="/2022/08/07/Nexus%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%AA%A8%EB%93%88%ED%99%94/Nexus_%EC%B2%AB%ED%99%94%EB%A9%B4.png" class title="설치 후 첫 화면">

<p>그 후 Sign in 버튼을 클릭하면 초기 아이디와 비밀번호가 저장된 파일의 위치를 알려준다.</p>
<img src="/2022/08/07/Nexus%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%AA%A8%EB%93%88%ED%99%94/%EB%A1%9C%EA%B7%B8%EC%9D%B8%ED%99%94%EB%A9%B4.png" class title="로그인 화면">

<br>


<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /설치경로/nexus3/admin.password</span><br></pre></td></tr></table></figure>

<br>

<img src="/2022/08/07/Nexus%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%AA%A8%EB%93%88%ED%99%94/%EC%B4%88%EA%B8%B0_%ED%8C%A8%EC%8A%A4%EC%9B%8C%EB%93%9C.png" class>

<br>

<img src="/2022/08/07/Nexus%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%AA%A8%EB%93%88%ED%99%94/%EC%9D%B5%EB%AA%85%EC%9C%A0%EC%A0%80_%EC%A0%91%EA%B7%BC.png" class>

<ul>
<li>설정 하다보면 아래처럼 익명 사용자도 접근하게 할 것인지 물어보는데 당연히도 수정 할 수 있으므로 적당히 선택해주면 된다.</li>
</ul>
<br>

<hr>
<h3 id="2-Repository-생성"><a href="#2-Repository-생성" class="headerlink" title="2. Repository 생성"></a>2. Repository 생성</h3><p>우선 모듈화한 도메인 프로젝트를 업로드 할 레파지토리부터 생성해야한다.</p>
<img src="/2022/08/07/Nexus%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%AA%A8%EB%93%88%ED%99%94/%EB%A0%88%ED%8C%8C%EC%A7%80%ED%86%A0%EB%A6%AC_%EC%83%9D%EC%84%B11.png" class>
<br>
<img src="/2022/08/07/Nexus%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%AA%A8%EB%93%88%ED%99%94/%EB%A0%88%ED%8C%8C%EC%A7%80%ED%86%A0%EB%A6%AC_%EC%83%9D%EC%84%B12.png" class>

<br>

<p>레파지토리 type은 group, hosted, proxy가 있지만, 우리는 위 처럼 maven2의 hosted로 생성한다.</p>
<ul>
<li>이때 hosted는 레파지토리 관리자가 직접 호스팅하는 레파지토리 type이고,</li>
<li>다른 것들과의 차이점은 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://help.sonatype.com/repomanager2/configuration/managing-repositories">여기서</a> 확인 해 볼 수 있다.</li>
</ul>
<br>

<img src="/2022/08/07/Nexus%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%AA%A8%EB%93%88%ED%99%94/%EB%A0%88%ED%8C%8C%EC%A7%80%ED%86%A0%EB%A6%AC_%EC%83%9D%EC%84%B13.png" class>

<br>

<img src="/2022/08/07/Nexus%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%AA%A8%EB%93%88%ED%99%94/%EB%A0%88%ED%8C%8C%EC%A7%80%ED%86%A0%EB%A6%AC_%EC%83%9D%EC%84%B1_version_policy.png" class>

<br>

<ul>
<li><p>Version policy는</p>
<ul>
<li>Release</li>
<li>Snapshot</li>
<li>Mixed</li>
</ul>
<p>3 가지가 존재하는데, 보통 Snapshot 레파지토리, Release 레파지토리를 따로 만들어 관리해야하지만, 필자는 Mixed로 지정하고 사용하였다.</p>
</li>
</ul>
<br>

<img src="/2022/08/07/Nexus%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%AA%A8%EB%93%88%ED%99%94/%EB%A0%88%ED%8C%8C%EC%A7%80%ED%86%A0%EB%A6%AC_%EC%83%9D%EC%84%B1_deployment_policy.png" class>

<br>

<ul>
<li><p>Deployment policy는</p>
<ul>
<li>Allow redeploy<ul>
<li>같은 버전으로 재배포 가능하고 덮어씀</li>
</ul>
</li>
<li>Disable redeploy<ul>
<li>같은 버전으로 다시 배포 할 수 없음</li>
</ul>
</li>
<li>Read-only<ul>
<li>아예 배포가 허용되지 않음</li>
</ul>
</li>
<li>Deploy by Replication Only<ul>
<li>레플리카를 사용하는 경우 레플리카로만 배포되고 다른 배포는 차단됨</li>
</ul>
</li>
</ul>
</li>
<li><p>자세한 내용은 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://help.sonatype.com/repomanager3/nexus-repository-administration/repository-management#RepositoryManagement-Hosted">여기서</a> 확인 할 수 있다.</p>
</li>
</ul>
<br>

<hr>
<h3 id="3-Repository-access-유저-생성"><a href="#3-Repository-access-유저-생성" class="headerlink" title="3. Repository access 유저 생성"></a>3. Repository access 유저 생성</h3><h3 id="Role-생성"><a href="#Role-생성" class="headerlink" title="Role 생성"></a>Role 생성</h3><img src="/2022/08/07/Nexus%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%AA%A8%EB%93%88%ED%99%94/Role%EC%83%9D%EC%84%B11.png" class>

<br>

<img src="/2022/08/07/Nexus%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%AA%A8%EB%93%88%ED%99%94/Role%EC%83%9D%EC%84%B12.png" class>

<br>

<p>필터란에 생성한 레파지토리명으로 검색해서 <strong>nx-repository-view-…</strong> 로 시작하는 권한들을 넣어주고, 해당 Role로 레파지토리에 업로드도 할 수 있게 하기 위해 <strong>nx-component-upload</strong> 권한도 넣어준다.</p>
<h3 id="유저-생성"><a href="#유저-생성" class="headerlink" title="유저 생성"></a>유저 생성</h3><img src="/2022/08/07/Nexus%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%AA%A8%EB%93%88%ED%99%94/%EC%9C%A0%EC%A0%80%EC%83%9D%EC%84%B11.png" class>

<br>

<img src="/2022/08/07/Nexus%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%AA%A8%EB%93%88%ED%99%94/%EC%9C%A0%EC%A0%80%EC%83%9D%EC%84%B12.png" class>

<br>

<ul>
<li>각 항목들은 각자에 맞게 넣어주고 Role엔 조금 전에 생성한 Role을 넣어주고 생성을 완료하면 우리가 처음에 로그인한 어드민 계정과는 달리 우리가 생성한 repository만 접근 할 수 있는 것을 확인 할 수 있다.</li>
</ul>
<br>

<img src="/2022/08/07/Nexus%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%AA%A8%EB%93%88%ED%99%94/%EC%9C%A0%EC%A0%80%EC%83%9D%EC%84%B13.png" class>

<hr>
<h3 id="4-라이브러리-업로드"><a href="#4-라이브러리-업로드" class="headerlink" title="4. 라이브러리 업로드"></a>4. 라이브러리 업로드</h3><h4 id="settings-xml-설정"><a href="#settings-xml-설정" class="headerlink" title="settings.xml 설정"></a>settings.xml 설정</h4><p>nexus 레파지토리에 접근하기 위해서는 우선, maven 설정 파일인 settings.xml을 수정해야야 한다. 기본적으로는 ~/.m2/settings.xml 으로 설정되어 있으므로 이 곳에 생성해서 사용하거나, 이미 settings.xml을 사용하고 있다면 그 파일을 수정해주면 되는데.. 이도 저도 모르겠으면 아래 이미지 처럼 인텔리제이에서 확인하여 그 위치의 settings.xml을 수정해준다.</p>
<img src="/2022/08/07/Nexus%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%AA%A8%EB%93%88%ED%99%94/settings.png" class>

<br>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/SETTINGS/1.0.0&quot;</span></span></span><br><span class="line"><span class="tag"> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag"> <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/SETTINGS/1.0.0</span></span></span><br><span class="line"><span class="tag"><span class="string"> http://maven.apache.org/xsd/settings-1.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;<span class="name">servers</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">id</span>&gt;</span>junggu-demo-repository<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">username</span>&gt;</span>junggu-demo-user<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">password</span>&gt;</span>qweqwe<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">servers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>id : 레파지토리 서버의 ID (자유롭게 지정)</li>
<li>username : 레파지토리 접근을 위해 생성했던 nexus access 계정 Id</li>
<li>password: 레파지토리 접근을 위해 생성했던 nexus access 계정 password</li>
</ul>
<h4 id="코드-작성"><a href="#코드-작성" class="headerlink" title="코드 작성"></a>코드 작성</h4><p>모듈화할 코드를 작성하면 되는데, 우리는 도메인 영역을 모듈화 할 것이므로 Entity 클래스를 생성해서 테스트 해본다.</p>
<img src="/2022/08/07/Nexus%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%AA%A8%EB%93%88%ED%99%94/%ED%85%8C%EC%8A%A4%ED%8A%B8%EC%9A%A9%20%ED%81%B4%EB%9E%98%EC%8A%A4.png" class>

<br>

<h4 id="POM-xml-설정"><a href="#POM-xml-설정" class="headerlink" title="POM.xml 설정"></a>POM.xml 설정</h4><p>코드 작성을 완료했으면 이제 해당 프로젝트를 nexus repository에 업로드 하기 위해 pom.xml에 아래 처럼 설정을 추가해줘야한다.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>junggu-demo-repository<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>junggu nexus repository~ name is free<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://localhost:8081/repository/junggu-nexus-demo/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>id : settings.xml에서 설정했던 id와 동일해야함.</li>
<li>name : 사람이 식별 할 수 있게 설정.</li>
<li>url : 생성한 repository의 url</li>
</ul>
<br>

<img src="/2022/08/07/Nexus%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%AA%A8%EB%93%88%ED%99%94/%EB%A0%88%ED%8C%8C%EC%A7%80%ED%86%A0%EB%A6%AC_URL.png" class>

<ul>
<li>&lt;distributionManagement&gt; 와 &lt;repository&gt;대한 자세한 설명은 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://maven.apache.org/pom.html#distribution-management">이 쪽으로</a></li>
</ul>
<h4 id="배포하기"><a href="#배포하기" class="headerlink" title="배포하기"></a>배포하기</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean compile deploy</span><br></pre></td></tr></table></figure>

<ul>
<li>위 명령어로 deploy 하거나 혹은 Intellij에서 deploy를 실행시켜도 된다.</li>
</ul>
<br>

<img src="/2022/08/07/Nexus%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%AA%A8%EB%93%88%ED%99%94/deploy_%EC%BD%98%EC%86%94.png" class>

<br>

<img src="/2022/08/07/Nexus%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%AA%A8%EB%93%88%ED%99%94/deploy_%EB%B8%8C%EB%9D%BC%EC%9A%B0%EC%A0%80.png" class>

<ul>
<li>무사히 deploy가 성공했다면 nexus에서 jar 파일이 정상적으로 업로드된 것을 확인 할 수 있고, 이 후엔 이 라이브러리화된 jar파일을 다른 프로젝트들에서 dependency에 추가해서 사용하면 된다.</li>
</ul>
<br>

<hr>
<h3 id="업로드된-라이브러리-사용하기"><a href="#업로드된-라이브러리-사용하기" class="headerlink" title="업로드된 라이브러리 사용하기"></a>업로드된 라이브러리 사용하기</h3><p>업로드된 라이브러리를 사용하기 위해서 사용하고자 하는 프로젝트의 pom.xml에 아래와 같은 설정을 추가해준다.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 모듈화되서 업로드된 도메인 프로젝트 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.junggu.ji<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 라이브러리가 업로드된 Nexus Repository 정보 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>junggu-demo-repository<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>junggu nexus repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://localhost:8081/repository/junggu-nexus-demo/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>우선 라이브러리가 업로드된 nexus repository의 정보를 입력하고</li>
<li>우리가 업로드한 라이브러리 정보도 dependency에 추가해준다.</li>
<li>이 때, dependency의 속성들이 헷갈린다면, nexus에서 업로드된 jar를 선택 할 경우 아래 이미지처럼 친절하게 알려주므로 복사해서 사용하면 된다.</li>
</ul>
<br>

<img src="/2022/08/07/Nexus%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%AA%A8%EB%93%88%ED%99%94/%EC%97%85%EB%A1%9C%EB%93%9C_%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC_dependency.png" class>

<br>

<h4 id="Entity-호출하기"><a href="#Entity-호출하기" class="headerlink" title="Entity 호출하기"></a>Entity 호출하기</h4><img src="/2022/08/07/Nexus%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%AA%A8%EB%93%88%ED%99%94/%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC%20%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0%201.png" class>

<br>

<img src="/2022/08/07/Nexus%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%AA%A8%EB%93%88%ED%99%94/%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC%20%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0%202.png" class>

<ul>
<li>위 이미지 처럼 dependency 추가 후 maven을 새로고침하면 보이는 것 처럼 추가도 잘 되고 코드에서도 사용 할 수 있는 것 처럼 보이는데 막상 코드에서 사용하려고 하면 아래 이미지에서 보는 것 처럼 정상적으로 호출되지 않는 것을 알 수 있다.</li>
</ul>
<br>

<img src="/2022/08/07/Nexus%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%AA%A8%EB%93%88%ED%99%94/%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC%20%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0%203.png" class>

<br>

<ul>
<li>결론부터 이야기하면 우리가 jar로 만든 프로젝트는 Spring boot 프로젝트를 그대로 jar로 패키징 한 것으로, 일반적인 jar 파일이 아닌 Spring boot가 실행 가능한 jar 형태로 패키징 되었기 때문에, jar에 포함된 클래스들을 호출 할 수가 없는 것이다.<ul>
<li>여기서 말하는 실행 가능한 jar는 META-INF에 저장된 MANIFEST.MF에 저장된 정보를 읽어서 실행시키기 때문에 우리가 일반적으로 호출하는 형태로는 사용 할 수 없다.</li>
</ul>
</li>
</ul>
<br>

<img src="/2022/08/07/Nexus%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%AA%A8%EB%93%88%ED%99%94/%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC%20%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0%204.png" class>

<br>

<img src="/2022/08/07/Nexus%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%AA%A8%EB%93%88%ED%99%94/%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC%20%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0%205.png" class>

<br>

<p>이 실행 가능한 jar를 일반적인 jar로 만들어서 repository에 배포하기 위해서 모듈화하는 프로젝트의 pom.xml에서 아래 설정을 제거 해주고 다른 dependency들에게 각각 version을 지정한 후 maven compiler plugin도 알맞게 추가해주면 되는데</p>
<p>이 때 우리가 삭제한 spring-boot-parent에 포함된 의존성들은 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-parent/2.7.1">여기서</a> 확인 할 수 있으므로, 필요한 것이나 각각 dependency들을 무슨 버전으로 지정해야 할 지 모르겠다면 여기서 확인 후 추가해주면 된다.</p>
<img src="/2022/08/07/Nexus%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%AA%A8%EB%93%88%ED%99%94/%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC%20%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0%206.png" class>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">source</span>&gt;</span>11<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">target</span>&gt;</span>11<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">compilerArgument</span>&gt;</span>-Xlint:all<span class="tag">&lt;/<span class="name">compilerArgument</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>이제 verison을 올린 후 새로고침 해보면 이전과 다르게 BOOT-INF가 없어지고 바로 com. 으로 시작하는 자바 패키지가 노출되는 것을 확인 할 수 있다.</li>
</ul>
<br>

<img src="/2022/08/07/Nexus%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%AA%A8%EB%93%88%ED%99%94/%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC%20%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0%207.png" class>

<br>

<p>이제 테스트 코드를 작성해서 돌려보면 테스트가 성공 할 줄 알았으나.. 애석하게도 아래와 같이 Not a managed type 라는 에러를 내뿜으며 우리의 기대를 무참히 박살내는데…</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Caused by: java.lang.IllegalArgumentException: Not a managed type: <span class="class"><span class="keyword">class</span> <span class="title">com</span>.<span class="title">junggu</span>.<span class="title">ji</span>.<span class="title">demo</span>.<span class="title">domain</span>.<span class="title">Junggu</span></span></span><br><span class="line">	at org.hibernate.metamodel.internal.MetamodelImpl.managedType(MetamodelImpl.java:582)</span><br><span class="line">	at org.hibernate.metamodel.internal.MetamodelImpl.managedType(MetamodelImpl.java:<span class="number">85</span>)</span><br><span class="line">	at org.springframework.data.jpa.repository.support.JpaMetamodelEntityInformation.&lt;init&gt;(JpaMetamodelEntityInformation.java:<span class="number">75</span>)</span><br><span class="line">	at org.springframework.data.jpa.repository.support.JpaEntityInformationSupport.getEntityInformation(JpaEntityInformationSupport.java:<span class="number">66</span>)</span><br><span class="line">	at org.springframework.data.jpa.repository.support.JpaRepositoryFactory.getEntityInformation(JpaRepositoryFactory.java:<span class="number">233</span>)</span><br><span class="line">	at org.springframework.data.jpa.repository.support.JpaRepositoryFactory.getTargetRepository(JpaRepositoryFactory.java:<span class="number">182</span>)</span><br><span class="line">	at org.springframework.data.jpa.repository.support.JpaRepositoryFactory.getTargetRepository(JpaRepositoryFactory.java:<span class="number">165</span>)</span><br><span class="line">	at org.springframework.data.jpa.repository.support.JpaRepositoryFactory.getTargetRepository(JpaRepositoryFactory.java:<span class="number">76</span>)</span><br><span class="line">	at org.springframework.data.repository.core.support.RepositoryFactorySupport.getRepository(RepositoryFactorySupport.java:<span class="number">325</span>)</span><br><span class="line">	at org.springframework.data.repository.core.support.RepositoryFactoryBeanSupport.lambda$afterPropertiesSet$<span class="number">5</span>(RepositoryFactoryBeanSupport.java:<span class="number">323</span>)</span><br><span class="line">	at org.springframework.data.util.Lazy.getNullable(Lazy.java:<span class="number">231</span>)</span><br><span class="line">	at org.springframework.data.util.Lazy.get(Lazy.java:<span class="number">115</span>)</span><br><span class="line">	at org.springframework.data.repository.core.support.RepositoryFactoryBeanSupport.afterPropertiesSet(RepositoryFactoryBeanSupport.java:<span class="number">329</span>)</span><br><span class="line">	at org.springframework.data.jpa.repository.support.JpaRepositoryFactoryBean.afterPropertiesSet(JpaRepositoryFactoryBean.java:<span class="number">144</span>)</span><br><span class="line">	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:<span class="number">1863</span>)</span><br><span class="line">	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:<span class="number">1800</span>)</span><br><span class="line">	... <span class="number">85</span> more</span><br></pre></td></tr></table></figure>


<p>이는 우리가 추가한 라이브러리의 Entithy가 component scan에 인식되지 않아서 Bean context에 등록되지 않았기 때문에 발생하는 에러이다.</p>
<p>왜냐면, spring boot는 기본적으로 <a href="https://jungguji.github.io/2020/05/26/SpringBootApplication-%EC%9D%98-%EB%8F%99%EC%9E%91-%EB%B0%A9%EC%8B%9D/">@SpringBootApplication</a>안에 있는 @EnableAutoConfiguration으로 스프링이 정의한  외부 의존성들과 @ComponentScan으로 해당 어노테이션 하위 패키지에 있는 클래스들을 탐색해서 Bean으로 등록하는데,</p>
<p>우리가 추가한 라이브러리는 둘 중 어느 위치에도 존재하지 않으므로 당연히 Bean에 등록 될 수없는 것이다.</p>
<h4 id="라이브러리안에-있는-Entity-Bean-context-등록하기"><a href="#라이브러리안에-있는-Entity-Bean-context-등록하기" class="headerlink" title="라이브러리안에 있는 Entity Bean context 등록하기"></a>라이브러리안에 있는 Entity Bean context 등록하기</h4><p>여러 방법이 있겠지만, 필자는 SessionFactory Bean을 따로 만들어서 우리가 만든 Entity가 있는 라이브러리의 패키지까지 스캔 하도록 추가하는 방식을 사용하였다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> LocalSessionFactoryBean <span class="title">entityManagerFactory</span><span class="params">(DataSource dataSource)</span> </span>&#123;</span><br><span class="line">    LocalSessionFactoryBean localSessionFactory = <span class="keyword">new</span> LocalSessionFactoryBean();</span><br><span class="line">    localSessionFactory.setDataSource(dataSource);</span><br><span class="line">    localSessionFactory</span><br><span class="line">        .setPackagesToScan(<span class="string">&quot;com.junggu.ji.usenexus&quot;</span>, <span class="string">&quot;com.junggu.ji.demo&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> localSessionFactory;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h5 id="적당히-작성한-테스트-코드와-성공한-모습"><a href="#적당히-작성한-테스트-코드와-성공한-모습" class="headerlink" title="적당히 작성한 테스트 코드와 성공한 모습"></a>적당히 작성한 테스트 코드와 성공한 모습</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfigureTestDatabase(replace = AutoConfigureTestDatabase.Replace.NONE)</span></span><br><span class="line"><span class="meta">@TestPropertySource(&quot;classpath:application-test.properties&quot;)</span></span><br><span class="line"><span class="meta">@Import(DatabaseConfig.class)</span></span><br><span class="line"><span class="meta">@DataJpaTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NexusTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JungguRepository jungguRepository;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name = <span class="string">&quot;지중구&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> age = <span class="number">30</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Gender gender = Gender.MALE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Junggu junggu = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        junggu = Junggu.builder()</span><br><span class="line">            .name(name)</span><br><span class="line">            .age(age)</span><br><span class="line">            .gender(gender)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Junggu when = jungguRepository.save(junggu);</span><br><span class="line"></span><br><span class="line">        assertThat(when.getName()).isEqualTo(junggu.getName());</span><br><span class="line">        assertThat(when.getAge()).isEqualTo(junggu.getAge());</span><br><span class="line">        assertThat(when.getGender()).isEqualTo(junggu.getGender());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<img src="/2022/08/07/Nexus%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%AA%A8%EB%93%88%ED%99%94/%ED%85%8C%EC%8A%A4%ED%8A%B8%20%EC%84%B1%EA%B3%B5.png" class>

<hr>
<h2 id="결론"><a href="#결론" class="headerlink" title="결론"></a>결론</h2><p>이렇게 우리는 여러 프로젝트에서 공통으로 사용되는 부분을 따로 빼서 모듈화 하는 방법을 알아보았다.</p>
<p> 필자는 단순히 Entity 클래스의 관리를 편하게 하기 위해 이번 모듈화를 진행했지만,  레이어 별로 프레젠테이션 레이어, 서비스 레이어, 도메인 레이어등으로  구분하여 모듈을 구분 할 수도 있을 것 이다. </p>
<p>다만, 이렇게 멀티 프로젝트에 nexus를 이용해서 모듈화를 구현하는 경우, 모듈화한 프로젝트를 수정 했을 때 모듈화된 라이브러리를 사용하는 다른 프로젝트 모든 프로젝트에서도 손수 version을 올려줘야한다는 단점이 있기 때문에(물론 Deployment policy를 Allow redeploy로 설정했다면 상관없다.), 각자의 서비스에서 단일 프로젝트 멀티 모듈 구조가 맞을 지 아니면 필자처럼 멀티 프로젝트인 상태로 모듈화를 구성 할지는 잘 판단해서 구조화를 해야 할 것 이다.</p>
<hr>
<h3 id="P-S"><a href="#P-S" class="headerlink" title="P.S"></a>P.S</h3><p>여담으로.. 필자는 이번 모듈화를 진행하면서 DTO에 의존적인 Entity들에 대해 굉장히 많이 리팩토링을 진행 할 수 있었고, 레이어 별 분리에 대해 다시 한번 생각해보는 계기가 되어서 고생은 좀 많이 했지만, 개인적으로 굉장히 뜻 깊은 시간을 보낼 수 있었다.</p>
<hr>
<h2 id="참고-사이트"><a href="#참고-사이트" class="headerlink" title="참고 사이트"></a>참고 사이트</h2><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://devocean.sk.com/experts/techBoardDetail.do?ID=163423&page=&searchData=DevOps&subIndex=&idList=%5B164007,+163980,+163891,+163887,+163883,+163872,+163843,+163830,+163799,+163729,+163575,+163566,+163499,+163425,+163423,+163419,+163415,+163347,+163346,+163345,+163344,+163311,+163301,+163296,+163295,+163294,+163290,+163263,+163249,+163173,+163170,+163114,+163054,+163008,+162976,+162968,+162962,+162915,+162576,+160298,+159334,+158674,+158428%5D">Nexus3 설치 및 리포지토리 생성 하기</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://devocean.sk.com/experts/techBoardDetail.do?ID=163425&page=&searchData=DevOps&subIndex=&idList=%5B164007,+163980,+163891,+163887,+163883,+163872,+163843,+163830,+163799,+163729,+163575,+163566,+163499,+163425,+163423,+163419,+163415,+163347,+163346,+163345,+163344,+163311,+163301,+163296,+163295,+163294,+163290,+163263,+163249,+163173,+163170,+163114,+163054,+163008,+162976,+162968,+162962,+162915,+162576,+160298,+159334,+158674,+158428%5D">Nexus에 Spring Maven 라이브러리 배포 및 사용하기</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://co-de.tistory.com/68">5분 안에 구축하는 Nexus</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://peaku.co/questions/39613-spring-boot:-mapeo-de-entidades-desde-un-contenedor-externo">https://peaku.co/questions/39613-spring-boot:-mapeo-de-entidades-desde-un-contenedor-externo</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://stackoverflow.com/questions/48416927/spring-boot-required-a-bean-named-entitymanagerfactory-that-could-not-be-foun">https://stackoverflow.com/questions/48416927/spring-boot-required-a-bean-named-entitymanagerfactory-that-could-not-be-foun</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://stackoverflow.com/questions/43705720/how-do-i-import-configuration-classes-in-a-datajpatest-in-a-springboottest">https://stackoverflow.com/questions/43705720/how-do-i-import-configuration-classes-in-a-datajpatest-in-a-springboottest</a></li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a href="/2022/08/07/Nexus%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%AA%A8%EB%93%88%ED%99%94/#post-footer" class="postShorten-excerpt_link link" aria-label>
                                댓글 공유
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        
          <li class="pagination-next">
            <a class="btn btn--default btn--small" href="/page/2/" aria-label="이전 포스트">
              <span>이전 포스트</span>
              <i class="fa fa-angle-right text-base icon-ml"></i>
            </a>
          </li>
        
        <li class="pagination-number">page 1 of 11</li>
    </ul>
</div>

</section>


                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2025 Junggu Ji. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <h4 id="about-card-name">Junggu Ji</h4>
        
            <div id="about-card-bio"><p>author.bio</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-fvy43rs4ns3qkm3cliupi5qtnm0vwph13v4ev99f0qvrcz9tbdyatctmah0i.min.js"></script>

<!--SCRIPTS END-->





    </body>
</html>
