
<!DOCTYPE html>
<html lang="ko">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Junggu Ji, 생각의 기록">
    <title>아카이브: 2024 - Junggu Ji, 생각의 기록</title>
    <meta name="author" content="Junggu Ji">
    
    
    
        
            <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
        
    
    <script type="application/ld+json">{}</script>
    <meta property="og:type" content="blog">
<meta property="og:title" content="Junggu Ji, 생각의 기록">
<meta property="og:url" content="https://jungguji.github.io/archives/2024/index.html">
<meta property="og:site_name" content="Junggu Ji, 생각의 기록">
<meta property="og:locale" content="ko_KR">
<meta property="article:author" content="Junggu Ji">
<meta name="twitter:card" content="summary">
    
    
        
    
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-vaqxmiojfeym1obe22l4wzlc2exrxuyy1hezfoyofzx2ow3vxa49a2skiig7.min.css">

    <!--STYLES END-->
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-162527815-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-162527815-1');
    </script>


    

    

    <script data-ad-client="ca-pub-6264654331856753" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    

<header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a class="header-title-link" href="/" aria-label>
            Junggu Ji, 생각의 기록
        </a>
    </div>
    
        
            <a class="header-right-picture " href="#about" aria-label="링크 열기: /#about">
        
        
        </a>
    
</header>

            <!-- Define author's picture -->


<nav id="sidebar" data-behavior="1">
    <div class="sidebar-container">
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/" rel="noopener" title="Home">
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/all-categories" rel="noopener" title="카테고리">
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">카테고리</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/all-tags" rel="noopener" title="태그">
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">태그</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/all-archives" rel="noopener" title="아카이브">
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">아카이브</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="#about" rel="noopener" title="About">
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="https://github.com/jungguji" target="_blank" rel="external nofollow noopener noreferrer" title="GitHub">
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/mailto" rel="noopener" title="Mail">
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/atom.xml" rel="noopener" title="RSS">
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="1" class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2024/12/24/%EB%8F%99%EC%8B%9C%EC%84%B1-%EC%9D%B4%EC%8A%88%EC%99%80-Redis-Redisson-%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%ED%95%B4%EA%B2%B0%EB%B0%A9%EB%B2%95/" aria-label=": 동시성 이슈와 Redis( Redisson )를 이용한 해결방법">
                            동시성 이슈와 Redis( Redisson )를 이용한 해결방법
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2024-12-24T12:26:46+09:00">
	
		    2024/12/24
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="도입"><a href="#도입" class="headerlink" title="도입"></a>도입</h2><p>동시성 제어는 여러 사용자가 동시에 시스템을 사용할 때 발생할 수 있는 데이터 무결성과 성능 문제를 해결하는 데 중요한 역할을 한다. 본 글은 Redis와 Redisson 라이브러리를 활용하여 분산 환경에서 발생하는 동시성 이슈를 해결하기 위한 방안을 탐구하고자 한다. 본 글에서는 사내에서 발생했던 동시성 문제와 비슷한 상황을 예시 코드로 재현하여 문제를 정의하고, 이를 해결하기 위한 방법을 설명한다.</p>
<hr>
<h2 id="이론적-배경"><a href="#이론적-배경" class="headerlink" title="이론적 배경"></a>이론적 배경</h2><ol>
<li>동시성 제어와 분산 락의 중요성<ul>
<li>동시성 이슈는 분산 환경에서 동일한 데이터에 여러 프로세스가 동시에 접근할 때 발생한다. 이를 해결하기 위해 락(lock) 메커니즘이 널리 사용된다.</li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://ko.wikipedia.org/wiki/%EB%9D%BD_(%EC%BB%B4%ED%93%A8%ED%84%B0_%EA%B3%BC%ED%95%99)">일반적인 락(mutex lock, spin lock 등)</a>은 단일 시스템 내에서만 작동하며, 분산 락은 여러 시스템 간의 경쟁 상태를 관리한다.<ul>
<li>단일 시스템의 예로는 하나의 WAS(Tomcat)에서 실행되는 애플리케이션이 있고, 이 환경에서는 스레드 간의 동기화가 주로 필요하다.</li>
<li>여러 시스템의 예로는 여러 개의 WAS(Tomcat) 인스턴스가 로드 밸런서를 통해 분산 처리하는 환경이 있으며, 이러한 경우 서버 간 데이터 동기화를 위한 분산 락이 필요하다.</li>
</ul>
</li>
</ul>
</li>
</ol>
<ol start="2">
<li>Redis와 Redisson<ul>
<li>Redis는 인메모리 데이터베이스로 높은 처리 속도와 다양한 데이터 구조를 지원한다. 이를 활용한 분산 락 구현은 효율적인 동시성 제어를 제공한다.</li>
<li>Redisson은 Redis 클라이언트 라이브러리로, 분산 락을 포함한 다양한 동시성 제어 기능을 제공한다.</li>
</ul>
</li>
</ol>
<h2 id="연구방법"><a href="#연구방법" class="headerlink" title="연구방법"></a>연구방법</h2><p><strong>1. 문제 정의</strong></p>
<ul>
<li>챗봇 대화 서비스를 운영중이었고, 유저가 챗봇과 대화 시 대화에 필요한 서비스 내 재화가 소모 되는 방식이었다.</li>
<li>서버 구조는 다음과 같았다:     <ul>
<li>메시지큐를 이용해 채팅 서버로 메시지를 전달하고, 답장 서버에서 답장을 메시지큐를 통해 다시 수신하여 처리하는 구조였다.<img src="/2024/12/24/%EB%8F%99%EC%8B%9C%EC%84%B1-%EC%9D%B4%EC%8A%88%EC%99%80-Redis-Redisson-%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%ED%95%B4%EA%B2%B0%EB%B0%A9%EB%B2%95/1.png" class></li>
<li>답장 서버는 8대가 운영 중이었고, 유저는 동시에 여러 챗봇과 대화가 가능했다.</li>
<li>메시지큐에 동일한 유저가 여러 챗봇과의 대화를 진행하며 생성된 메시지가 각각 저장되고, 여러 서버에서 이러한 메시지를 동시에 처리하면서 동시성 문제가 발생하여, 유저가 소비해야 하는 재화가 올바르게 차감되지 않는 현상이 나타났다.</li>
<li>이를 재현하기 위해 아래와 같은 코드를 작성하여 실험을 설계하였다.</li>
</ul>
</li>
</ul>
<p><strong>2. 실험 설계</strong></p>
<ul>
<li>문제를 재현하기 위해 아래 코드를 작성하여 실험을 설계하였다.<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title">consumeResource</span><span class="params">(<span class="keyword">int</span> userId)</span> </span>&#123;</span><br><span class="line">     Optional&lt;User&gt; userOpt = resourceRepository.findById(userId);</span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">         Thread.sleep(<span class="number">100</span>); <span class="comment">// 로직 수행에 100ms가 걸린다고 가정하고, 100ms 지연</span></span><br><span class="line">     &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">         Thread.currentThread().interrupt();</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     User user = userOpt.get();</span><br><span class="line">     user.consumeResource(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">     resourceRepository.save(user);</span><br><span class="line">     log.info(<span class="string">&quot;User &#123;&#125; 자원 1 사용, 남은 자원: &#123;&#125;&quot;</span>, userId, user.getRemainingResources());</span><br><span class="line">     <span class="keyword">return</span> ResponseEntity.ok(<span class="string">&quot;자원 소비. 남은 자원: &quot;</span> + user.getRemainingResources());</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>자원 소비 중 동시성 문제가 발생하는 현상을 확인하기 위한 예시 코드로, 여러 스레드에서 동일한 유저의 데이터를 동시에 처리할 경우 재화가 예상보다 적게 차감되는 동작을 확인하였다.</li>
<li>이 코드는 단일 시스템에서 동작하는 코드로, 분산 락이 아닌 일반적인 락으로도 해결할 수 있는 상황이다. 하지만 실제 문제와 동일하게 여러 스레드나 서버가 하나의 자원에 동시 접근하는 상황을 재현할 수 있으므로, 실험 결과의 신뢰성에는 문제가 없을 것으로 보인다.</li>
</ul>
</li>
</ul>
<p><strong>2.1. 실험 결과</strong></p>
<ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/wg/wrk">wrk</a>를 사용하여 동일 자원에 대해 다수의 요청을 보냈으며, 다음과 같은 결과가 확인되었다.</li>
<li><img src="/2024/12/24/%EB%8F%99%EC%8B%9C%EC%84%B1-%EC%9D%B4%EC%8A%88%EC%99%80-Redis-Redisson-%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%ED%95%B4%EA%B2%B0%EB%B0%A9%EB%B2%95/2.png" class></li>
<li><details>
<summary>테스트에 사용된 lua script</summary>
 <figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 요청 수 제한</span></span><br><span class="line"><span class="keyword">local</span> max_requests = <span class="number">10</span> <span class="comment">-- 요청 수 제한</span></span><br><span class="line"><span class="keyword">local</span> request_count = <span class="number">0</span> <span class="comment">-- 현재 요청 수</span></span><br><span class="line"></span><br><span class="line">request = <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">   <span class="keyword">if</span> request_count &gt;= max_requests <span class="keyword">then</span></span><br><span class="line">      wrk.thread:stop() <span class="comment">-- 요청 제한에 도달하면 쓰레드 중지</span></span><br><span class="line">   <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">   request_count = request_count + <span class="number">1</span></span><br><span class="line">   <span class="keyword">local</span> user_id = <span class="number">1</span></span><br><span class="line">   <span class="keyword">local</span> <span class="built_in">path</span> = <span class="string">&quot;/resources/&quot;</span> .. user_id .. <span class="string">&quot;/consume&quot;</span></span><br><span class="line">   <span class="keyword">return</span> wrk.<span class="built_in">format</span>(<span class="string">&quot;POST&quot;</span>, <span class="built_in">path</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</details></li>
<li><strong>실험 명령어:</strong> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wrk -t5 -c20 -d1s -s test_consume.lua http://localhost:8080</span><br></pre></td></tr></table></figure></li>
<li><strong>실험 결과 요약:</strong><ul>
<li>로그에서 동일 자원에 대해 여러 요청이 동시에 처리되며 자원의 남은 개수가 정확히 감소하지 않는 현상이 나타났다.</li>
<li>이는 요청 간 자원 상태가 정확히 반영되지 않고 동일한 초기 상태로 처리된 결과이다.</li>
<li>예를 들어, 로그에서 “User 1 자원 1 사용, 남은 자원: 9”가 반복 출력되었으며, 이후 일부 요청만 자원이 감소된 상태를 올바르게 반영하였다.</li>
</ul>
</li>
<li><strong>문제 분석:</strong><ul>
<li>요청이 짧은 시간에 집중적으로 발생하며, 트랜잭션 커밋이 완료되기 전에 다른 요청이 동일 자원의 상태를 조회하고 처리하였다.</li>
<li>이러한 동시성 이슈는 예시 코드에서 자원 접근 시 락을 사용하지 않았기 때문에 발생한 것으로 보인다.</li>
<li>결과적으로, 여러 요청이 자원을 중복해서 처리하며 데이터의 무결성이 훼손되었다.</li>
</ul>
</li>
</ul>
<p><strong>3. 문제 해결</strong></p>
<ul>
<li><p><strong>분산 락 설계:</strong></p>
<ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://redisson.org/docs/data-and-services/locks-and-synchronizers/#lock">Redisson</a>의 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://javadoc.io/doc/org.redisson/redisson/latest/org/redisson/api/RLock.html">tryLock</a> 메서드를 활용하여 특정 리소스에 대한 락을 획득한다.</li>
<li>락 획득에 실패한 요청은 대기하거나 재시도하도록 구현한다.<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;&#123;userId&#125;/consume&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title">consumeResource</span><span class="params">(<span class="meta">@PathVariable(&quot;userId&quot;)</span> <span class="keyword">int</span> userId)</span> </span>&#123;</span><br><span class="line">   String lockName = <span class="string">&quot;user:&quot;</span> + userId + <span class="string">&quot;:resource:lock&quot;</span>;</span><br><span class="line"></span><br><span class="line">   RLock lock = redissonClient.getLock(lockName);</span><br><span class="line">   <span class="keyword">int</span> remainingResources = <span class="number">0</span>;</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">         <span class="keyword">boolean</span> isLocked = lock.tryLock(<span class="number">3</span>, <span class="number">10</span>, TimeUnit.SECONDS);</span><br><span class="line"></span><br><span class="line">         <span class="keyword">if</span> (isLocked) &#123;</span><br><span class="line">            remainingResources = resourceService.consumeResource(userId);</span><br><span class="line">         &#125;</span><br><span class="line">   &#125; <span class="keyword">catch</span> (RuntimeException | InterruptedException e) &#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;Lock 획득 실패&quot;</span>, e);</span><br><span class="line">   &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">         <span class="keyword">if</span> (lock.isHeldByCurrentThread()) &#123; <span class="comment">// 락 소유 여부 확인</span></span><br><span class="line">            lock.unlock();</span><br><span class="line">         &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> ResponseEntity.ok(<span class="string">&quot;자원 소비. 남은 자원: &quot;</span> + remainingResources);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>락 해제 매커니즘:</strong><br> Redisson 내부적으로 락을 관리하고 해제하는 메커니즘은 Redis Pub/Sub 시스템과 AsyncSemaphore를 활용하여 다음과 같은 방식으로 동작한다:</p>
 <details>
    <summary>Redisson tryLock() Code</summary>
       <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryLock</span><span class="params">(<span class="keyword">long</span> waitTime, <span class="keyword">long</span> leaseTime, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">   <span class="keyword">long</span> time = unit.toMillis(waitTime);</span><br><span class="line">   <span class="keyword">long</span> current = System.currentTimeMillis();</span><br><span class="line">   <span class="keyword">long</span> threadId = Thread.currentThread().getId();</span><br><span class="line">   <span class="comment">// 1. 최초 락 획득 시도</span></span><br><span class="line">   Long ttl = <span class="keyword">this</span>.tryAcquire(waitTime, leaseTime, unit, threadId);</span><br><span class="line">   <span class="keyword">if</span> (ttl == <span class="keyword">null</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="comment">// 2. 타이머 갱신 및 대기</span></span><br><span class="line">         time -= System.currentTimeMillis() - current;</span><br><span class="line">         <span class="keyword">if</span> (time &lt;= <span class="number">0L</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.acquireFailed(waitTime, unit, threadId);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">         &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            current = System.currentTimeMillis();</span><br><span class="line">            <span class="comment">// 3. Pub/Sub 채널 구독</span></span><br><span class="line">            CompletableFuture&lt;RedissonLockEntry&gt; subscribeFuture = <span class="keyword">this</span>.subscribe(threadId);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">               subscribeFuture.get(time, TimeUnit.MILLISECONDS);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (TimeoutException var21) &#123;</span><br><span class="line">               <span class="keyword">if</span> (!subscribeFuture.completeExceptionally(<span class="keyword">new</span> RedisTimeoutException(<span class="string">&quot;Unable to acquire subscription lock after &quot;</span> + time + <span class="string">&quot;ms. Try to increase &#x27;subscriptionsPerConnection&#x27; and/or &#x27;subscriptionConnectionPoolSize&#x27; parameters.&quot;</span>))) &#123;</span><br><span class="line">                     subscribeFuture.whenComplete((res, ex) -&gt; &#123;</span><br><span class="line">                        <span class="keyword">if</span> (ex == <span class="keyword">null</span>) &#123;</span><br><span class="line">                           <span class="keyword">this</span>.unsubscribe(res, threadId);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                     &#125;);</span><br><span class="line">               &#125;</span><br><span class="line"></span><br><span class="line">               <span class="keyword">this</span>.acquireFailed(waitTime, unit, threadId);</span><br><span class="line">               <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ExecutionException var22) &#123;</span><br><span class="line">               ExecutionException e = var22;</span><br><span class="line">               LOGGER.error(e.getMessage(), e);</span><br><span class="line">               <span class="keyword">this</span>.acquireFailed(waitTime, unit, threadId);</span><br><span class="line">               <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">               time -= System.currentTimeMillis() - current;</span><br><span class="line">               <span class="keyword">if</span> (time &lt;= <span class="number">0L</span>) &#123;</span><br><span class="line">                     <span class="keyword">this</span>.acquireFailed(waitTime, unit, threadId);</span><br><span class="line">                     <span class="keyword">boolean</span> var25 = <span class="keyword">false</span>;</span><br><span class="line">                     <span class="keyword">return</span> var25;</span><br><span class="line">               &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                     <span class="keyword">boolean</span> var16;</span><br><span class="line">                     <span class="keyword">do</span> &#123;</span><br><span class="line">                        <span class="keyword">long</span> currentTime = System.currentTimeMillis();</span><br><span class="line">                        ttl = <span class="keyword">this</span>.tryAcquire(waitTime, leaseTime, unit, threadId);</span><br><span class="line">                        <span class="keyword">if</span> (ttl == <span class="keyword">null</span>) &#123;</span><br><span class="line">                           var16 = <span class="keyword">true</span>;</span><br><span class="line">                           <span class="keyword">return</span> var16;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        time -= System.currentTimeMillis() - currentTime;</span><br><span class="line">                        <span class="keyword">if</span> (time &lt;= <span class="number">0L</span>) &#123;</span><br><span class="line">                           <span class="keyword">this</span>.acquireFailed(waitTime, unit, threadId);</span><br><span class="line">                           var16 = <span class="keyword">false</span>;</span><br><span class="line">                           <span class="keyword">return</span> var16;</span><br><span class="line">                        &#125;</span><br><span class="line">                        </span><br><span class="line">                        <span class="comment">// 4. Latch 대기와 재시도</span></span><br><span class="line">                        currentTime = System.currentTimeMillis();</span><br><span class="line">                        <span class="keyword">if</span> (ttl &gt;= <span class="number">0L</span> &amp;&amp; ttl &lt; time) &#123;</span><br><span class="line">                           ((RedissonLockEntry)<span class="keyword">this</span>.commandExecutor.getNow(subscribeFuture)).getLatch().tryAcquire(ttl, TimeUnit.MILLISECONDS);</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                           ((RedissonLockEntry)<span class="keyword">this</span>.commandExecutor.getNow(subscribeFuture)).getLatch().tryAcquire(time, TimeUnit.MILLISECONDS);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        time -= System.currentTimeMillis() - currentTime;</span><br><span class="line">                     &#125; <span class="keyword">while</span>(time &gt; <span class="number">0L</span>);</span><br><span class="line"></span><br><span class="line">                     <span class="keyword">this</span>.acquireFailed(waitTime, unit, threadId);</span><br><span class="line">                     var16 = <span class="keyword">false</span>;</span><br><span class="line">                     <span class="keyword">return</span> var16;</span><br><span class="line">               &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">               <span class="comment">// 5. 구독 해제</span></span><br><span class="line">               <span class="keyword">this</span>.unsubscribe((RedissonLockEntry)<span class="keyword">this</span>.commandExecutor.getNow(subscribeFuture), threadId);</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </details>

<p> <strong>1. 최초 락 획득 시도</strong></p>
<ul>
<li>tryAcquire 메서드를 통해 락 획득 가능 여부를 확인하며, null을 반환하면 현재 락을 바로 획득할 수 있음을 의미한다.</li>
<li>락이 이미 선점된 경우, ttl(잠금의 남은 유효 시간)을 반환하여 대기할 시간을 계산한다.</li>
</ul>
<p> <strong>2. 타이머 갱신 및 대기</strong></p>
<ul>
<li>대기 중 경과된 시간을 waitTime에서 차감하며 남은 시간이 0 이하일 경우 대기를 종료하고 false를 반환한다.</li>
</ul>
<p> <strong>3. Pub/Sub 채널 구독</strong></p>
<ul>
<li>락 해제 이벤트를 감지하기 위해 Redis Pub/Sub 채널에 구독을 요청한다.</li>
<li>subscribeFuture를 통해 락이 해제되었거나 구독에 실패한 경우 작업이 비동기적으로 처리된다.</li>
</ul>
<p> <strong>4. latch 대기와 재시도</strong></p>
<ul>
<li>Pub/Sub 채널 구독이 성공한 상태에서 tryAcquire를 반복 호출하며 락 획득을 재시도한다.</li>
<li>TTL 값에 따라 latch 대기 시간이 설정되며, 다른 스레드에서 락이 해제되면 latch가 해제되어 작업이 이어진다.</li>
</ul>
<p> <strong>5. 구독 해제</strong></p>
<ul>
<li>락을 획득하든 못 하든 메서드를 종료하기 전에 Pub/Sub 구독 리소스를 해제하여 시스템 자원을 정리한다.</li>
</ul>
</li>
</ul>
<p><strong>3.1. Redisson 적용 후 실험 결과:</strong></p>
<ul>
<li><p>2.1. 실험과 동일한 script와 wrk 명령어를 이용해 실험을 진행했으며, 다음과 같은 결과가 확인되었다.</p>
</li>
<li><img src="/2024/12/24/%EB%8F%99%EC%8B%9C%EC%84%B1-%EC%9D%B4%EC%8A%88%EC%99%80-Redis-Redisson-%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%ED%95%B4%EA%B2%B0%EB%B0%A9%EB%B2%95/4.png" class></li>
<li><p><strong>실험 결과 요약:</strong></p>
<ul>
<li>Redisson을 사용하여 분산 락을 적용한 결과, 모든 요청이 순차적으로 처리되었으며 데이터의 무결성이 유지되었다.</li>
<li>로그에서 확인할 수 있듯이 동일한 자원에 대해 락이 적용되어 요청이 병렬적으로 처리되지 않고 순차적으로 처리되었다.</li>
<li>예를 들어, “User 1 자원 1 사용, 남은 자원: 9”에서 시작하여 요청이 처리될 때마다 자원이 정확히 감소하는 모습을 확인할 수 있었다.</li>
<li>실험 중에는 잘못된 자원 감소나 동시성 문제가 발생하지 않았다.</li>
</ul>
</li>
<li><p><strong>문제 해결 확인:</strong></p>
<ul>
<li>Redisson의 분산 락을 적용함으로써 동시성 문제로 인한 데이터 무결성 훼손이 해결되었다.</li>
<li>요청량이 많을 때에도 대기 상태로 처리되며 자원의 상태가 정확히 갱신되었다.</li>
</ul>
</li>
</ul>
<h2 id="결과"><a href="#결과" class="headerlink" title="결과"></a>결과</h2><ul>
<li>테스트 결과<ul>
<li>Redisson 기반 분산 락을 적용한 후, 중복 트랜잭션 문제가 해결되었다.</li>
<li>부하 테스트(wrk)에서 동일한 유저의 데이터를 처리할 때, 데이터 무결성이 유지됨을 확인하였다.</li>
<li>이로써 분산 서버 환경에서 발생하던 자원 동시성 문제를 해결할 수 있었다.</li>
</ul>
</li>
</ul>
<hr>
<h2 id="논의"><a href="#논의" class="headerlink" title="논의"></a>논의</h2><p>Pub/Sub 기반 락 메커니즘은 성능과 자원 활용면에서 유리하며, 이를 사용하는 Redisson을 사용하여 분산 환경에서도 효율적으로 동시성 제어가 가능하지만,<br>Redis를 따로 구축하여야 한다는 점, Redis의 장애 시 락 메커니즘이 정상적으로 동작하지 않을 수 있다는 점과 락 해제 실패 또는 락 대기 시간 초과 시 추가적 오류 처리가 필요하다는 한계점 등이 존재한다.<br>해당 한계점들을 개선하기 위해 이후에 Redis Cluster를 활용해 고가용성을 확보하여야하고, Redis 외에 기타 다른 도구(Zookeeper, Etcd 등)와의 성능 비교가 필요하다.</p>
<h2 id="결론"><a href="#결론" class="headerlink" title="결론"></a>결론</h2><p>본 글에서는 Redis와 Redisson을 활용한 분산 락 메커니즘을 통해 동시성 이슈를 해결하는 방법을 제시하였다.<br>실험 결과, 제안된 방법은 데이터 무결성을 효과적으로 유지하며, 부하 테스트에서도 우수한 성능을 보였다.<br>본 글이 분산 환경에서의 동시성 문제를 해결하려는 개발자들에게 실질적인 가이드라인을 제공하길 기대하며, 본 글에서 사용된 <code>tryLock()</code>의 내부 작동원리는 <a href="https://jungguji.github.io/2025/01/09/%EB%8F%99%EC%8B%9C%EC%84%B1-%EC%A0%9C%EC%96%B4%EB%A5%BC-%EC%9C%84%ED%95%9C-Redisson-tryLock-%EB%A9%94%EC%84%9C%EB%93%9C%EC%9D%98-%EC%9E%91%EB%8F%99-%EC%9B%90%EB%A6%AC/">동시성 제어를 위한 Redisson tryLock 메서드의 작동 원리</a>에서 확인 할 수 있다.</p>

                    
                        


                    
                    
                        <p>
                            <a href="/2024/12/24/%EB%8F%99%EC%8B%9C%EC%84%B1-%EC%9D%B4%EC%8A%88%EC%99%80-Redis-Redisson-%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%ED%95%B4%EA%B2%B0%EB%B0%A9%EB%B2%95/#post-footer" class="postShorten-excerpt_link link" aria-label>
                                댓글 공유
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2024/11/19/%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%BD%94%EB%93%9C-%EC%9E%91%EC%84%B1%EC%9D%84-%EB%8D%94-%EC%89%BD%EA%B2%8C-with-Fixture-Monkey/" aria-label=": 테스트 코드 작성을 더 쉽게 (with. Fixture Monkey)">
                            테스트 코드 작성을 더 쉽게 (with. Fixture Monkey)
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2024-11-19T23:16:40+09:00">
	
		    2024/11/19
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="1-Fixture-Monkey란"><a href="#1-Fixture-Monkey란" class="headerlink" title="1. Fixture Monkey란?"></a>1. <strong>Fixture Monkey란?</strong></h1><p>Fixture Monkey는 네이버의 내부 프로젝트인 <strong>Plasma</strong>에서 복잡한 테스트 요구 사항을 해결하기 위해 개발된 도구로, 현재는 오픈 소스로 제공되어 Java와 Kotlin 환경에서 쉽게 적용할 수 있습니다. 이 라이브러리는 기존의 고정된 테스트 데이터 대신  복잡한 객체 타입의 테스트 데이터를 자동으로 생성하여 테스트 코드의 일관성과 효율성을 대폭 향상시킬 수 있는 도구입니다.</p>
<hr>
<h1 id="2-Fixture-Monkey-도입의-필요성"><a href="#2-Fixture-Monkey-도입의-필요성" class="headerlink" title="2. Fixture Monkey 도입의 필요성"></a>2. Fixture Monkey 도입의 필요성</h1><h2 id="1-클래스에-final-필드가-포함된-경우"><a href="#1-클래스에-final-필드가-포함된-경우" class="headerlink" title="1. 클래스에 final 필드가 포함된 경우"></a>1. 클래스에 final 필드가 포함된 경우</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String email;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String phoneNumber;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> isVerified;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LocalDateTime createdAt;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAgeCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">assert</span> <span class="keyword">this</span>.age &gt;= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.age &lt; <span class="number">18</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;청소년&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.age &lt; <span class="number">65</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;청년&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;시니어&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="문제점"><a href="#문제점" class="headerlink" title="문제점"></a>문제점</h3><ul>
<li>Member 클래스의 필드들이 모두 final로 선언되어 있기 때문에, 단순히 테스트에서 특정 메서드(getAgeCategory)만 검증하려 해도 불필요한 모든 데이터를 포함하여 객체를 생성해야 하는 문제가 있습니다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testGetAgeCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 청소년</span></span><br><span class="line">    Member minor = <span class="keyword">new</span> Member(<span class="number">1L</span>, <span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;alice@example.com&quot;</span>, <span class="string">&quot;123456789&quot;</span>, <span class="number">15</span>, <span class="keyword">true</span>, LocalDateTime.now());</span><br><span class="line">    assertEquals(<span class="string">&quot;청소년&quot;</span>, minor.getAgeCategory());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 청년</span></span><br><span class="line">    Member adult = <span class="keyword">new</span> Member(<span class="number">2L</span>, <span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;bob@example.com&quot;</span>, <span class="string">&quot;987654321&quot;</span>, <span class="number">30</span>, <span class="keyword">true</span>, LocalDateTime.now());</span><br><span class="line">    assertEquals(<span class="string">&quot;청년&quot;</span>, adult.getAgeCategory());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 시니어</span></span><br><span class="line">    Member senior = <span class="keyword">new</span> Member(<span class="number">3L</span>, <span class="string">&quot;Charlie&quot;</span>, <span class="string">&quot;charlie@example.com&quot;</span>, <span class="string">&quot;555555555&quot;</span>, <span class="number">70</span>, <span class="keyword">true</span>, LocalDateTime.now());</span><br><span class="line">    assertEquals(<span class="string">&quot;시니어&quot;</span>, senior.getAgeCategory());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-하나의-클래스에-너무-많은-객체를-포함하는-경우"><a href="#2-하나의-클래스에-너무-많은-객체를-포함하는-경우" class="headerlink" title="2. 하나의 클래스에 너무 많은 객체를 포함하는 경우"></a>2. 하나의 클래스에 너무 많은 객체를 포함하는 경우</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> orderId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Customer customer; <span class="comment">// 연관된 객체</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Product product;   <span class="comment">// 연관된 객체</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LocalDateTime orderDate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Order</span><span class="params">(<span class="keyword">long</span> orderId, Customer customer, Product product, LocalDateTime orderDate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.orderId = orderId;</span><br><span class="line">        <span class="keyword">this</span>.customer = customer;</span><br><span class="line">        <span class="keyword">this</span>.product = product;</span><br><span class="line">        <span class="keyword">this</span>.orderDate = orderDate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> customerId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String email;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Address address; <span class="comment">// 연관된 객체</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Customer</span><span class="params">(<span class="keyword">long</span> customerId, String name, String email, Address address)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.customerId = customerId;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.email = email;</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> productId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String productName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">double</span> price;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Product</span><span class="params">(<span class="keyword">long</span> productId, String productName, <span class="keyword">double</span> price)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.productId = productId;</span><br><span class="line">        <span class="keyword">this</span>.productName = productName;</span><br><span class="line">        <span class="keyword">this</span>.price = price;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Address</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String street;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String city;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String zipCode;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Address</span><span class="params">(String street, String city, String zipCode)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.street = street;</span><br><span class="line">        <span class="keyword">this</span>.city = city;</span><br><span class="line">        <span class="keyword">this</span>.zipCode = zipCode;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="문제점-1"><a href="#문제점-1" class="headerlink" title="문제점"></a>문제점</h3><ul>
<li>생성자에 따라서 연관관계가 맺어진 다른 객체들 까지 생성이 필요하고, 또 그 객체에 연결된 객체들 까지 무한히 체이닝될 수 있습니다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testOrderCreation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Address 생성</span></span><br><span class="line">        Address address = <span class="keyword">new</span> Address(<span class="string">&quot;123 Main St&quot;</span>, <span class="string">&quot;Seoul&quot;</span>, <span class="string">&quot;12345&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Customer 생성</span></span><br><span class="line">        Customer customer = <span class="keyword">new</span> Customer(<span class="number">1L</span>, <span class="number">1L</span>, <span class="string">&quot;John Doe&quot;</span>, <span class="string">&quot;john@example.com&quot;</span>, address);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Product 생성</span></span><br><span class="line">        Product product = <span class="keyword">new</span> Product(<span class="number">1001L</span>, <span class="string">&quot;Laptop&quot;</span>, <span class="number">1500.00</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Order 생성</span></span><br><span class="line">        Order order = <span class="keyword">new</span> Order(<span class="number">5001L</span>, customer, product, LocalDateTime.now());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 테스트</span></span><br><span class="line">        assertNotNull(order.getCustomer());</span><br><span class="line">        assertEquals(<span class="string">&quot;Laptop&quot;</span>, order.getProduct().getProductName());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>위 코드에선 Order 객체를 생성하려면 Customer와 Product 객체가 필요하며, Customer 객체를 생성하려면 Address 객체도 생성해야 합니다.</li>
<li>테스트에서 단일 객체 검증을 위해 불필요한 객체들을 생성해야 하는 비효율 발생합니다.</li>
</ul>
<h2 id="3-객체를-생성할-수-있는-생성자가-존재하지-않는-경우"><a href="#3-객체를-생성할-수-있는-생성자가-존재하지-않는-경우" class="headerlink" title="3. 객체를 생성할 수 있는 생성자가 존재하지 않는 경우"></a>3. 객체를 생성할 수 있는 생성자가 존재하지 않는 경우</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor(access = AccessLevel.PROTECTED)</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;member&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemberEntity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> String phoneNumber;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isVerified;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createdAt;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MemberEntity</span><span class="params">(String name, String email, String phoneNumber, <span class="keyword">int</span> age, <span class="keyword">boolean</span> isVerified)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.email = email;</span><br><span class="line">        <span class="keyword">this</span>.phoneNumber = phoneNumber;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.isVerified = isVerified;</span><br><span class="line">        <span class="keyword">this</span>.createdAt = LocalDateTime.now();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="문제점-2"><a href="#문제점-2" class="headerlink" title="문제점"></a>문제점</h3><ul>
<li>기본 생성자 외에, 모든 필드를 초기화하는 생성자를 제공하지 않으므로 테스트에서 객체를 생성할 수 없습니다.</li>
<li>테스트를 위해 public 생성자를 추가하거나 setter를 작성해야 하지만, 이는 프로덕션 코드의 불필요한 수정으로 이어집니다.</li>
<li>혹은 테스트에서 강제로 객체를 생성하려면 Reflection을 사용해야 할 수 있지만, Reflection은 유지보수성을 떨어뜨리고, 코드 가독성을 저하시킵니다.</li>
</ul>
<h2 id="4-요약"><a href="#4-요약" class="headerlink" title="4. 요약"></a>4. 요약</h2><table>
<thead>
<tr>
<th>문제 상황</th>
<th>설명</th>
<th>Fixture Monkey 도입 효과</th>
</tr>
</thead>
<tbody><tr>
<td>클래스에 final 필드가 포함된 경우</td>
<td>final 필드로 인해 모든 필드를 초기화해야 객체 생성 가능</td>
<td>필요한 데이터만 선택적으로 생성 가능</td>
</tr>
<tr>
<td>객체가 너무 많은 연관 객체 포함</td>
<td>생성자 체이닝으로 인해 테스트에 필요한 객체 생성이 복잡해짐</td>
<td>의존 객체를 자동 생성하며 필요한 객체만 오버라이드 가능</td>
</tr>
<tr>
<td>생성자가 존재하지 않는 경우</td>
<td>생성자가 없어 Reflection 등을 통해 강제로 생성해야 하는 비효율</td>
<td>테스트용 생성자 추가 없이 객체 생성 과정 단순화 가능</td>
</tr>
</tbody></table>
<hr>
<h1 id="3-Fixture-Monkey의-객체-생성-방식들"><a href="#3-Fixture-Monkey의-객체-생성-방식들" class="headerlink" title="3. Fixture Monkey의 객체 생성 방식들"></a>3. Fixture Monkey의 객체 생성 방식들</h1><p><code>Introspector</code>란 Fixture Monkey에서 <strong>객체가 생성되는 방법</strong>을 의미합니다.</p>
<p><code>FixtureMonkey</code>가 생성될 때 넣어주는 <code>Introspector</code>에 따라 객체가 생성되는 방법이 달라지게 됩니다.</p>
<h2 id="1-BeanArbitraryIntrospector"><a href="#1-BeanArbitraryIntrospector" class="headerlink" title="1. BeanArbitraryIntrospector"></a>1. BeanArbitraryIntrospector</h2><ul>
<li>Fixture Monkey가 객체 생성에 사용하는 기본 introspector 입니다.</li>
<li>리플렉션과 setter 메서드를 사용하여 새 인스턴스를 생성하므로 생성할 클래스에는 인자가 없는 생성자(또는 기본생성자)와 setter가 있어합니다.</li>
</ul>
<h2 id="2-ConstructorPropertiesArbitraryIntrospector"><a href="#2-ConstructorPropertiesArbitraryIntrospector" class="headerlink" title="2. ConstructorPropertiesArbitraryIntrospector"></a>2. ConstructorPropertiesArbitraryIntrospector</h2><ul>
<li>생성자에 <code>@ConstructorProperties</code>가 있거나 없으면 클래스가 레코드 타입이어야 합니다.<br>(또는 Lombok을 사용하는 경우 lombok.config 파일에 <code>lombok.anyConstructor.addConstructorProperties=true</code>를 추가할 수 있습니다.)</li>
</ul>
<h2 id="3-FieldReflectionArbitraryIntrospector"><a href="#3-FieldReflectionArbitraryIntrospector" class="headerlink" title="3. FieldReflectionArbitraryIntrospector"></a>3. <strong>FieldReflectionArbitraryIntrospector</strong></h2><ul>
<li>리플렉션을 사용하여 새 인스턴스를 생성하고 필드를 설정하므로, 생성할 클래스는 인자가 없는 생성자(또는 기본 생성자)와 getter 또는 setter 중 하나를 가져야 합니다.</li>
<li>만약 final이 아닌 변수가 선언되어 있다면 getter 또는 setter 없이도 사용 가능합니다.</li>
</ul>
<h2 id="4-BuilderArbitraryIntrospector"><a href="#4-BuilderArbitraryIntrospector" class="headerlink" title="4. BuilderArbitraryIntrospector"></a>4. BuilderArbitraryIntrospector</h2><ul>
<li>클래스 빌더를 사용하여 클래스를 생성합니다.</li>
</ul>
<h2 id="5-FailoverArbitraryIntrospector"><a href="#5-FailoverArbitraryIntrospector" class="headerlink" title="5. FailoverArbitraryIntrospector"></a>5. FailoverArbitraryIntrospector</h2><ul>
<li>테스트 대상이 너무 다양한 객체를 내부적으로 가지고 있을 때 여러 <code>Introspector</code>를 제공할 수 있습니다.</li>
<li><code>FailoverArbitraryIntrospector</code>를 사용하면 두 개 이상의 introspector를 사용할 수 있으며, introspector 중 하나가 생성에 실패하더라도 <code>FailoverArbitraryIntrospector</code>는 계속 다음 introspector로 객체 생성을 시도합니다.</li>
</ul>
<h2 id="6-PriorityConstructorArbitraryIntrospector"><a href="#6-PriorityConstructorArbitraryIntrospector" class="headerlink" title="6. PriorityConstructorArbitraryIntrospector"></a>6. <strong>PriorityConstructorArbitraryIntrospector</strong></h2><ul>
<li>생성자를 사용해서 타입을 생성합니다.</li>
<li>다만, 생성자 파라미터 이름을 인식하지 못하면 ArbitraryBuilder API를 사용해 생성자 파라미터를 제어할 수 없습니다.</li>
<li>일반적으로 컴파일 시 바이트 코드에 생성자명과 파라미터명이 코드에서 작상한대로 저장되지 않으므로(arg1, arg2 이런식으로 저장됨) 생성자와 파라미터명을 런타임에 알 수 있도록 매핑 시킬 수 있어야 합니다.</li>
<li>Fixture monkey 공식문서에선 아래 3가지 방법을 제시하고 있습니다.<ul>
<li>record 타입</li>
<li>JVM 옵션 -parameters 활성화</li>
<li>생성자에 @ConstructorProperties 존재</li>
</ul>
</li>
</ul>
<details>
<summary>ConstructorPropertiesArbitraryIntrospector와의 차이점</summary>


</details>

<h2 id="7-요약"><a href="#7-요약" class="headerlink" title="7. 요약"></a><strong>7. 요약</strong></h2><table>
<thead>
<tr>
<th>Introspector</th>
<th>설명</th>
<th>특징</th>
</tr>
</thead>
<tbody><tr>
<td>BeanArbitraryIntrospector</td>
<td>기본 introspector로, 인자가 없는 생성자와 setter를 이용해 객체 생성</td>
<td>일반적인 객체 생성에 적합</td>
</tr>
<tr>
<td>ConstructorPropertiesArbitraryIntrospector</td>
<td>@ConstructorProperties 또는 레코드 타입을 통해 생성자 사용 가능</td>
<td>생성자 프로퍼티를 통한 특정 생성 가능</td>
</tr>
<tr>
<td>FieldReflectionArbitraryIntrospector</td>
<td>필드 리플렉션으로 객체 생성</td>
<td>final이 아닌 필드에 대해 setter 없이도 가능</td>
</tr>
<tr>
<td>BuilderArbitraryIntrospector</td>
<td>빌더 패턴을 사용하여 객체 생성</td>
<td>빌더 패턴이 있는 객체에 적합</td>
</tr>
<tr>
<td>FailoverArbitraryIntrospector</td>
<td>여러 introspector 중 사용 가능한 방식으로 객체 생성 시도</td>
<td>다양한 객체 생성 조건에 유연하게 대응</td>
</tr>
<tr>
<td>PriorityConstructorArbitraryIntrospector</td>
<td>우선 순위가 높은 생성자를 사용하여 객체 생성</td>
<td>생성자 우선 사용 상황에 적합</td>
</tr>
</tbody></table>
<hr>
<h1 id="4-사용-예시"><a href="#4-사용-예시" class="headerlink" title="4. 사용 예시"></a>4. 사용 예시</h1><h2 id="1-PriorityConstructorArbitraryIntrospector-사용"><a href="#1-PriorityConstructorArbitraryIntrospector-사용" class="headerlink" title="1. PriorityConstructorArbitraryIntrospector 사용"></a><strong>1. PriorityConstructorArbitraryIntrospector 사용</strong></h2><ul>
<li>PriorityConstructorArbitraryIntrospector를 이용해 기 존재하는 생성자를 활용하여 객체를 생성합니다.</li>
<li>Repository에서 데이터를 조회할 경우 <code>@QueryProjection</code> 을 활용하기 위해 DTO(혹은 VO)에서 생성자를 만들어서 사용하고 있는데, 이런 케이스처럼 final 필드가 다수 존재하여, 테스트 객체 생성에 비효율이 발생할 경우 사용하기 좋습니다.</li>
<li>해당 예시에선 withParameterNamesResolver() 메서드를 이용하여 생성자의 파라미터명을 명시적으로 작성하였습니다. 혹은 위에 설명한 다른 방법을 이용해 <strong>런타임</strong>에 파라미터명을 알 수 있도록 합니다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> FixtureMonkey fixtureMonkey;</span><br><span class="line"></span><br><span class="line"><span class="meta">@BeforeEach</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.fixtureMonkey = FixtureMonkey.builder()</span><br><span class="line">            .objectIntrospector(PriorityConstructorArbitraryIntrospector.INSTANCE</span><br><span class="line">                    .withParameterNamesResolver(constructor -&gt; List.of(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;email&quot;</span>, <span class="string">&quot;phoneNumber&quot;</span>, <span class="string">&quot;age&quot;</span>, <span class="string">&quot;verified&quot;</span>, <span class="string">&quot;createdAt&quot;</span>)))</span><br><span class="line">            .build();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ParameterizedTest(name = &quot;&#123;index&#125; =&gt; age=&#123;0&#125;, expectedCategory=&#123;1&#125;&quot;)</span></span><br><span class="line"><span class="meta">@MethodSource(&quot;getPersonVoArguments&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testPersonVoMethods</span><span class="params">(Integer age, String expectedCategory)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// given</span></span><br><span class="line">    PersonVo personVo = fixtureMonkey.giveMeBuilder(PersonVo.class)</span><br><span class="line">            .set(javaGetter(PersonVo::getId), <span class="number">1L</span>)</span><br><span class="line">            .set(<span class="string">&quot;age&quot;</span>, age)</span><br><span class="line">            .sample();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// when</span></span><br><span class="line">    String ageCategory = personVo.getAgeCategory();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// then</span></span><br><span class="line">    assertThat(ageCategory).isEqualTo(expectedCategory);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Stream&lt;Arguments&gt; <span class="title">getPersonVoArguments</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Stream.of(</span><br><span class="line">            Arguments.of(<span class="keyword">null</span>, <span class="string">&quot;Unknown&quot;</span>),</span><br><span class="line">            Arguments.of(<span class="number">15</span>, <span class="string">&quot;청소년&quot;</span>),</span><br><span class="line">            Arguments.of(<span class="number">30</span>, <span class="string">&quot;청년&quot;</span>),</span><br><span class="line">            Arguments.of(<span class="number">70</span>, <span class="string">&quot;시니어&quot;</span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="실행-결과"><a href="#실행-결과" class="headerlink" title="실행 결과"></a>실행 결과</h3>

<ul>
<li>테스트에 필요한 <code>age</code>만 넣고 실행 시, 나머지 final 필드들은 알아서 fixture monkey에 의해 채워지거나 null 허용필드인 경우 null이 입력된 것을 볼 수 있습니다.</li>
</ul>
<h2 id="2-FieldReflectionArbitraryIntrospector-사용"><a href="#2-FieldReflectionArbitraryIntrospector-사용" class="headerlink" title="2. FieldReflectionArbitraryIntrospector 사용"></a>2. <strong>FieldReflectionArbitraryIntrospector 사용</strong></h2><ul>
<li>생성자의 파라미터에 존재하지 않는 값 ( id )을 수정하기 위해 <code>FieldReflectionArbitraryIntrospector</code> 를 활용하여 객체를 생성합니다.</li>
<li>Entity class인 경우 보통 생성자에 id 필드를 포함한 생성자가 존재하지 않기 때문에(JPA ID를 생성, 관리 하도록 일임하기 때문) Entity 객체 생성 시 사용하기 좋습니다.</li>
</ul>
<br>

<h3 id="Member-Entity"><a href="#Member-Entity" class="headerlink" title="Member Entity"></a>Member Entity</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor(access = AccessLevel.PROTECTED)</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;member&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemberEntity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> String phoneNumber;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isVerified;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createdAt;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MemberEntity</span><span class="params">(String name, String email, String phoneNumber, <span class="keyword">int</span> age, <span class="keyword">boolean</span> isVerified)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.email = email;</span><br><span class="line">        <span class="keyword">this</span>.phoneNumber = phoneNumber;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.isVerified = isVerified;</span><br><span class="line">        <span class="keyword">this</span>.createdAt = LocalDateTime.now();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">verify</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.isVerified = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="비즈니스-로직"><a href="#비즈니스-로직" class="headerlink" title="비즈니스 로직"></a>비즈니스 로직</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 특정 ID를 가진 회원을 활성화</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> memberId 회원 ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 활성화된 회원</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Member <span class="title">activateMember</span><span class="params">(<span class="keyword">long</span> memberId)</span> </span>&#123;</span><br><span class="line">    MemberEntity entity = memberRepository.findById(memberId)</span><br><span class="line">            .orElseThrow(() -&gt; <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;존재하지 않는 회원 ID: &quot;</span> + memberId));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (entity.isVerified()) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;이미 활성화된 회원입니다: &quot;</span> + memberId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    entity.verify();</span><br><span class="line">    entity = memberRepository.save(entity);</span><br><span class="line">    <span class="keyword">return</span> Member.of(entity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br>

<h3 id="테스트코드-with-fixture-monkey"><a href="#테스트코드-with-fixture-monkey" class="headerlink" title="테스트코드 with. fixture monkey"></a>테스트코드 with. fixture monkey</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> FixtureMonkey fixtureMonkey;</span><br><span class="line"><span class="keyword">private</span> MemberService memberService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@BeforeEach</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    fixtureMonkey = FixtureMonkey.builder()</span><br><span class="line">            .objectIntrospector(FieldReflectionArbitraryIntrospector.INSTANCE)</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    memberService = <span class="keyword">new</span> MemberService(<span class="keyword">new</span> FakeMemberRepository());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RepeatedTest(value = 100)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testActivateMemberUsingFixtureMonkey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// given</span></span><br><span class="line">    MemberEntity entity = fixtureMonkey.giveMeBuilder(MemberEntity.class)</span><br><span class="line">            .set(<span class="string">&quot;isVerified&quot;</span>, <span class="keyword">false</span>)</span><br><span class="line">            .sample();</span><br><span class="line"></span><br><span class="line">    Member savedMember = memberService.save(entity);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// when</span></span><br><span class="line">    Member activatedMember = memberService.activateMember(savedMember.getId());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// then</span></span><br><span class="line">    assertThat(activatedMember.isVerified()).isTrue();</span><br><span class="line">    assertThat(entity.getId()).isEqualTo(activatedMember.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<ul>
<li>fixture monkey를 이용해 MemberEntity 객체 생성 시, 테스트해야하는 비즈니스 로직에서 필요한 값만 지정하여 객체를 생성합니다.<ul>
<li>예제에선 isVerified의 상태를 true로 변경하는 것</li>
</ul>
</li>
<li>이로 인해 테스트코드의 본래 목적인, 비즈니스 로직 검증에만 집중할 수 있는 간단한 테스트코드를 작성 할 수 있습니다.</li>
</ul>
<hr>
<h1 id="5-퀴즈"><a href="#5-퀴즈" class="headerlink" title="5. 퀴즈"></a>5. 퀴즈</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EventEligibilityChecker</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MemberService memberService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;event.vip.member.ids&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String vipMemberIds;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ZoneOffset KST = ZoneOffset.of(<span class="string">&quot;+09:00&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 특정 이벤트 참여 가능 여부를 확인</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 조건:</span></span><br><span class="line"><span class="comment">     * - VIP 회원이거나</span></span><br><span class="line"><span class="comment">     * - 관리자 권한을 가진 회원이거나</span></span><br><span class="line"><span class="comment">     * - 이벤트 기간 외에 요청한 회원이라면 false</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 그렇지 않다면 true를 반환한다.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> memberId 확인할 회원 ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> eventStartTime 이벤트 시작 시간</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> eventEndTime 이벤트 종료 시간</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 참여 가능 여부</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">canParticipate</span><span class="params">(<span class="keyword">long</span> memberId, LocalDateTime eventStartTime, LocalDateTime eventEndTime)</span> </span>&#123;</span><br><span class="line">        OffsetDateTime currentTime = OffsetDateTime.now();</span><br><span class="line">        <span class="keyword">boolean</span> isEligible = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> isVipMember = checkVipMember(memberId);</span><br><span class="line">        <span class="keyword">boolean</span> isAdminMember =</span><br><span class="line">                checkAdminMember(memberId);</span><br><span class="line">        <span class="keyword">boolean</span> isOutsideEventPeriod = checkOutsideEventPeriod(currentTime, eventStartTime, eventEndTime);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (isVipMember || isAdminMember || isOutsideEventPeriod) &#123;</span><br><span class="line">            isEligible = <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> isEligible;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">checkVipMember</span><span class="params">(<span class="keyword">long</span> memberId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.stream(vipMemberIds.split(<span class="string">&quot;,&quot;</span>))</span><br><span class="line">                .map(String::trim)</span><br><span class="line">                .map(Integer::parseInt)</span><br><span class="line">                .anyMatch(id -&gt; id == memberId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">checkAdminMember</span><span class="params">(<span class="keyword">long</span> memberId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> memberService.hasAdminRole(memberId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">checkOutsideEventPeriod</span><span class="params">(OffsetDateTime currentTime, LocalDateTime eventStartTime, LocalDateTime eventEndTime)</span> </span>&#123;</span><br><span class="line">        OffsetDateTime eventStart = eventStartTime.atOffset(KST);</span><br><span class="line">        OffsetDateTime eventEnd = eventEndTime.atOffset(KST);</span><br><span class="line">        <span class="keyword">return</span> currentTime.isBefore(eventStart) || currentTime.isAfter(eventEnd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br>

<p>위 같은 코드는 어떻게 테스트 코드를 작성 할 수 있을까요?</p>
<h2 id="1-테스트코드-작성"><a href="#1-테스트코드-작성" class="headerlink" title="1. 테스트코드 작성"></a>1. 테스트코드 작성</h2><h3 id="1-Fixture-Monkey-사용"><a href="#1-Fixture-Monkey-사용" class="headerlink" title="1. Fixture Monkey 사용"></a>1. Fixture Monkey 사용</h3><details>
<summary>예시 코드</summary>

<ul>
<li>해당 케이스에서 적용 할 수 있는 <code>Introspector</code> 가 존재하지 않기 때문에 Fixture monkey로 객체를 생성 할 수 없습니다.<ul>
<li>혹 제가 잘못 알고 있다면, 댓글 등으로 조언 부탁드립니다. (__)</li></ul></li></ul></details>





<br>

<h3 id="2-SpringBootTest와-TestPropertySource-사용"><a href="#2-SpringBootTest와-TestPropertySource-사용" class="headerlink" title="2. @SpringBootTest와 @TestPropertySource 사용"></a>2. @SpringBootTest와 @TestPropertySource 사용</h3><details>
<summary>예시 코드</summary>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@TestPropertySource(properties = &#123;</span></span><br><span class="line"><span class="meta">        &quot;event.vip.member.ids=1,2,3&quot;</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventEligibilityCheckerTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EventEligibilityChecker eventEligibilityChecker;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MemberService memberService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ParameterizedTest(name = &quot;&#123;index&#125; =&gt; memberId=&#123;0&#125;, startTime=&#123;1&#125;, endTime=&#123;2&#125;, expectedResult=&#123;3&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@MethodSource(&quot;getMemberArguments&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testCanParticipate</span><span class="params">(<span class="keyword">int</span> memberId, LocalDateTime startTime, LocalDateTime endTime, <span class="keyword">boolean</span> expectedResult)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// when</span></span><br><span class="line">        <span class="keyword">boolean</span> result = eventEligibilityChecker.canParticipate(memberId, startTime, endTime);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// then</span></span><br><span class="line">        assertThat(result).isEqualTo(expectedResult);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> Stream&lt;Object[]&gt; getMemberArguments() &#123;</span><br><span class="line">        <span class="keyword">return</span> Stream.of(</span><br><span class="line">                <span class="keyword">new</span> Object[]&#123;<span class="number">1</span>, LocalDateTime.now().minusDays(<span class="number">1</span>), LocalDateTime.now().plusDays(<span class="number">1</span>), <span class="keyword">false</span>&#125;, <span class="comment">// VIP 멤버</span></span><br><span class="line">                <span class="keyword">new</span> Object[]&#123;<span class="number">99</span>, LocalDateTime.now().minusDays(<span class="number">1</span>), LocalDateTime.now().plusDays(<span class="number">1</span>), <span class="keyword">false</span>&#125;, <span class="comment">// 관리자 멤버</span></span><br><span class="line">                <span class="keyword">new</span> Object[]&#123;<span class="number">4</span>, LocalDateTime.now().plusDays(<span class="number">1</span>), LocalDateTime.now().plusDays(<span class="number">2</span>), <span class="keyword">false</span>&#125;, <span class="comment">// 이벤트 기간 외</span></span><br><span class="line">                <span class="keyword">new</span> Object[]&#123;<span class="number">101</span>, LocalDateTime.now().minusDays(<span class="number">1</span>), LocalDateTime.now().plusDays(<span class="number">1</span>), <span class="keyword">true</span>&#125; <span class="comment">// 일반 멤버 (참여 가능)</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>

<br>

<h3 id="3-Reflection-사용"><a href="#3-Reflection-사용" class="headerlink" title="3. Reflection 사용"></a>3. Reflection 사용</h3><details>
<summary>예시 코드</summary>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EventEligibilityCheckerTestWithReflection</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> EventEligibilityChecker eventEligibilityChecker;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        eventEligibilityChecker = <span class="keyword">new</span> EventEligibilityChecker(<span class="keyword">new</span> MemberService(<span class="keyword">new</span> FakeMemberRepository()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ReflectionTestUtils를 사용해 @Value 필드 설정</span></span><br><span class="line">        ReflectionTestUtils.setField(eventEligibilityChecker, <span class="string">&quot;vipMemberIds&quot;</span>, <span class="string">&quot;1,2,3&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ParameterizedTest(name = &quot;&#123;index&#125; =&gt; memberId=&#123;0&#125;, startTime=&#123;1&#125;, endTime=&#123;2&#125;, expectedResult=&#123;3&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@MethodSource(&quot;getMemberArguments&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testCanParticipate</span><span class="params">(<span class="keyword">int</span> memberId, LocalDateTime startTime, LocalDateTime endTime, <span class="keyword">boolean</span> expectedResult)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// when</span></span><br><span class="line">        <span class="keyword">boolean</span> result = eventEligibilityChecker.canParticipate(memberId, startTime, endTime);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// then</span></span><br><span class="line">        assertThat(result).isEqualTo(expectedResult);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> Stream&lt;Object[]&gt; getMemberArguments() &#123;</span><br><span class="line">        <span class="keyword">return</span> Stream.of(</span><br><span class="line">                <span class="keyword">new</span> Object[]&#123;<span class="number">1</span>, LocalDateTime.now().minusDays(<span class="number">1</span>), LocalDateTime.now().plusDays(<span class="number">1</span>), <span class="keyword">false</span>&#125;, <span class="comment">// VIP 멤버</span></span><br><span class="line">                <span class="keyword">new</span> Object[]&#123;<span class="number">99</span>, LocalDateTime.now().minusDays(<span class="number">1</span>), LocalDateTime.now().plusDays(<span class="number">1</span>), <span class="keyword">false</span>&#125;, <span class="comment">// 관리자 멤버</span></span><br><span class="line">                <span class="keyword">new</span> Object[]&#123;<span class="number">4</span>, LocalDateTime.now().plusDays(<span class="number">1</span>), LocalDateTime.now().plusDays(<span class="number">2</span>), <span class="keyword">false</span>&#125;, <span class="comment">// 이벤트 기간 외</span></span><br><span class="line">                <span class="keyword">new</span> Object[]&#123;<span class="number">101</span>, LocalDateTime.now().minusDays(<span class="number">1</span>), LocalDateTime.now().plusDays(<span class="number">1</span>), <span class="keyword">true</span>&#125; <span class="comment">// 일반 멤버 (참여 가능)</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>

<hr>
<h1 id="6-테스트-하기-쉬운-코드"><a href="#6-테스트-하기-쉬운-코드" class="headerlink" title="6. 테스트 하기 쉬운 코드"></a>6. 테스트 하기 쉬운 코드</h1><blockquote>
<p>No Silver Bullet. - Fred Brooks</p>
</blockquote>
<p>단지 테스트코드 작성을 도와주는 도구일 뿐 Fixture Monkey 도 만능은 아닙니다.</p>
<p>테스트코드를 작성하기 어렵다는 건 테스트 하고자 하는 코드 (<a target="_blank" rel="external nofollow noopener noreferrer" href="https://en.wikipedia.org/wiki/System_under_test">System under test</a>)의 설계 혹은 구조가 잘못되어 있다고 테스트코드가 신호를 보내고 있다고 생각해야합니다.</p>
<h2 id="1-테스트가-어려운-이유"><a href="#1-테스트가-어려운-이유" class="headerlink" title="1. 테스트가 어려운 이유"></a>1. 테스트가 어려운 이유</h2><h3 id="a-불확실성"><a href="#a-불확실성" class="headerlink" title="a. 불확실성"></a>a. 불확실성</h3><ul>
<li>불확실성이란 코드가 외부 데이터나 상태에 의존하여 매번 다른 결과를 만들어내는 것을 의미합니다.</li>
<li>예를 들어, 현재 시간을 기준으로 동작하는 코드, 랜덤 값을 생성하는 코드, 전역 변수를 사용하는 코드 등은 매 실행 시마다 결과가 달라질 수 있습니다.</li>
<li>문제코드에선 <code>@Value</code>로 properties에서 주입받는 값들과 <code>OffsetDateTime.now()</code>를 불확실성이라고 할 수 있습니다.</li>
</ul>
<h3 id="b-부수효과"><a href="#b-부수효과" class="headerlink" title="b. 부수효과"></a>b. 부수효과</h3><ul>
<li>부수효과라 함은 함수 외부의 상태를 변경하는 것을 의미합니다.</li>
<li>예를 들어 메일을 전송하거나 파일에 데이터를 기록하거나 데이터베이스에 저장하는 코드는 외부 시스템에 변화를 일으킵니다.</li>
<li>이런 코드들은 단순히 리턴 값을 확인하는 것만으로는 테스트가 불가능하고, 실제로 외부 상태가 바뀌었는지 확인해야 하기 때문에 테스트 비용이 증가하게 됩니다.</li>
</ul>
<h2 id="2-테스트-하기-쉬운-코드로-수정하기"><a href="#2-테스트-하기-쉬운-코드로-수정하기" class="headerlink" title="2. 테스트 하기 쉬운 코드로 수정하기"></a>2. 테스트 하기 쉬운 코드로 수정하기</h2><details>
<summary>수정된 프로덕션 코드 ( SUT )</summary>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EventEligibilityCheckerV2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MemberService memberService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> VIPProperties vipProperties;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ClockProvider clockProvider;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ZoneOffset KST = ZoneOffset.of(<span class="string">&quot;+09:00&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 특정 이벤트 참여 가능 여부를 확인</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 조건:</span></span><br><span class="line"><span class="comment">     * - VIP 회원이거나</span></span><br><span class="line"><span class="comment">     * - 관리자 권한을 가진 회원이거나</span></span><br><span class="line"><span class="comment">     * - 이벤트 기간 외에 요청한 회원이라면 false</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 그렇지 않다면 true를 반환한다.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> memberId 확인할 회원 ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> eventStartTime 이벤트 시작 시간</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> eventEndTime 이벤트 종료 시간</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 참여 가능 여부</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">canParticipate</span><span class="params">(<span class="keyword">long</span> memberId, LocalDateTime eventStartTime, LocalDateTime eventEndTime)</span> </span>&#123;</span><br><span class="line">        OffsetDateTime currentTime = clockProvider.now();</span><br><span class="line">        <span class="keyword">boolean</span> isEligible = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> isVipMember = checkVipMember(memberId);</span><br><span class="line">        <span class="keyword">boolean</span> isAdminMember =</span><br><span class="line">                checkAdminMember(memberId);</span><br><span class="line">        <span class="keyword">boolean</span> isOutsideEventPeriod = checkOutsideEventPeriod(currentTime, eventStartTime, eventEndTime);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (isVipMember || isAdminMember || isOutsideEventPeriod) &#123;</span><br><span class="line">            isEligible = <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> isEligible;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">checkVipMember</span><span class="params">(<span class="keyword">long</span> memberId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> vipProperties.getIds().contains(memberId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">checkAdminMember</span><span class="params">(<span class="keyword">long</span> memberId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> memberService.hasAdminRole(memberId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">checkOutsideEventPeriod</span><span class="params">(OffsetDateTime currentTime, LocalDateTime eventStartTime, LocalDateTime eventEndTime)</span> </span>&#123;</span><br><span class="line">        OffsetDateTime eventStart = eventStartTime.atOffset(KST);</span><br><span class="line">        OffsetDateTime eventEnd = eventEndTime.atOffset(KST);</span><br><span class="line">        <span class="keyword">return</span> currentTime.isBefore(eventStart) || currentTime.isAfter(eventEnd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">VIPProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;Long&gt; <span class="title">getIds</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;event.vip.member&quot;)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VIPPropertiesImpl</span> <span class="keyword">implements</span> <span class="title">VIPProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String ids;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ConstructorBinding</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">VIPPropertiesImpl</span><span class="params">(String ids)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.ids = ids;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Long&gt; <span class="title">getIds</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.stream(<span class="keyword">this</span>.ids.split(<span class="string">&quot;,&quot;</span>))</span><br><span class="line">                .map(String::trim)</span><br><span class="line">                .map(Long::parseLong)</span><br><span class="line">                .toList();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</details>

<br>
<details>
<summary>수정된 테스트 코드</summary>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventEligibilityCheckerV2Test</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> EventEligibilityCheckerV2 eventEligibilityChecker;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> year = <span class="number">2024</span>;</span><br><span class="line">        <span class="keyword">int</span> month = <span class="number">12</span>;</span><br><span class="line">        <span class="keyword">int</span> day =<span class="number">13</span>;</span><br><span class="line">        <span class="keyword">int</span> hour = <span class="number">11</span>;</span><br><span class="line">        <span class="keyword">int</span> minute = <span class="number">11</span>;</span><br><span class="line">        <span class="keyword">int</span> second = <span class="number">11</span>;</span><br><span class="line"></span><br><span class="line">        eventEligibilityChecker = <span class="keyword">new</span> EventEligibilityCheckerV2(</span><br><span class="line">                <span class="keyword">new</span> MemberService(<span class="keyword">new</span> FakeMemberRepository())</span><br><span class="line">                , <span class="keyword">new</span> FakeVIPProperties(Arrays.asList(<span class="number">1L</span>,<span class="number">2L</span>,<span class="number">3L</span>))</span><br><span class="line">                , <span class="keyword">new</span> FakeSystemClockProvider(OffsetDateTime.of(year, month, day, hour, minute, second, <span class="number">11</span>, ZoneOffset.UTC))</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ParameterizedTest(name = &quot;&#123;index&#125; =&gt; memberId=&#123;0&#125;, startTime=&#123;1&#125;, endTime=&#123;2&#125;, expectedResult=&#123;3&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@MethodSource(&quot;getMemberArguments&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testCanParticipate</span><span class="params">(<span class="keyword">int</span> memberId, LocalDateTime startTime, LocalDateTime endTime, <span class="keyword">boolean</span> expectedResult)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// when</span></span><br><span class="line">        <span class="keyword">boolean</span> result = eventEligibilityChecker.canParticipate(memberId, startTime, endTime);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// then</span></span><br><span class="line">        assertThat(result).isEqualTo(expectedResult);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> Stream&lt;Object[]&gt; getMemberArguments() &#123;</span><br><span class="line">        <span class="keyword">int</span> year = <span class="number">2024</span>;</span><br><span class="line">        <span class="keyword">int</span> month = <span class="number">12</span>;</span><br><span class="line">        <span class="keyword">int</span> day =<span class="number">13</span>;</span><br><span class="line">        <span class="keyword">int</span> hour = <span class="number">11</span>;</span><br><span class="line">        <span class="keyword">int</span> minute = <span class="number">11</span>;</span><br><span class="line">        <span class="keyword">int</span> second = <span class="number">11</span>;</span><br><span class="line"></span><br><span class="line">        LocalDateTime eventStartDate = LocalDateTime.of(year, month, day-<span class="number">1</span>, hour, minute, second);</span><br><span class="line">        LocalDateTime eventEndDate = LocalDateTime.of(year, month, day+<span class="number">1</span>, hour, minute, second);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Stream.of(</span><br><span class="line">                <span class="keyword">new</span> Object[]&#123;<span class="number">1</span>, eventStartDate, eventEndDate, <span class="keyword">false</span>&#125;, <span class="comment">// VIP 멤버</span></span><br><span class="line">                <span class="keyword">new</span> Object[]&#123;<span class="number">99</span>, eventStartDate, eventEndDate, <span class="keyword">false</span>&#125;, <span class="comment">// 관리자 멤버</span></span><br><span class="line">                <span class="keyword">new</span> Object[]&#123;<span class="number">4</span>, eventEndDate.plusDays(<span class="number">1</span>), eventEndDate.plusDays(<span class="number">2</span>), <span class="keyword">false</span>&#125;, <span class="comment">// 이벤트 기간 외</span></span><br><span class="line">                <span class="keyword">new</span> Object[]&#123;<span class="number">101</span>, eventStartDate, eventEndDate, <span class="keyword">true</span>&#125; <span class="comment">// 일반 멤버 (참여 가능)</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>

<br>

<h2 id="3-코드-개선으로-인해-얻게된-이점"><a href="#3-코드-개선으로-인해-얻게된-이점" class="headerlink" title="3. 코드 개선으로 인해 얻게된 이점"></a>3. 코드 개선으로 인해 얻게된 이점</h2><ol>
<li><strong>책임 분리</strong>: 설정값을 전용 프로퍼티 클래스 (VIPProperties)로 관리하게 되어 EventEligibilityCheckerV2의 책임이 명확해졌습니다.</li>
<li><strong>유연성 증가</strong>: VIPProperties, ClockProvider와 같은 인터페이스를 사용하여 설정값에 대한 종속성이 외부로 분리하였고, 설정값을 추상화하여, 다양한 설정 구현체를 주입할 수 있습니다. 위 예시에선 테스트코드 내에서 Fake 구현체 작성하고 해당 구현체로 객체를 생성 하도록하여 테스트하였습니다.</li>
<li><strong>코드 가독성</strong>: @Value 어노테이션 없이 구성 클래스를 사용하므로, 전체적인 코드의 가독성이 향상됩니다.</li>
</ol>
<hr>
<h1 id="7-결론"><a href="#7-결론" class="headerlink" title="7. 결론"></a>7. 결론</h1><p>앞서 설명한 설계와 테스트 코드 개선에 더해 Fixture Monkey와 같은 도구를 활용하면 다음과 같은 이점을 얻을 수 있습니다.</p>
<ol>
<li><p><strong>테스트 데이터 자동 생성</strong></p>
<ul>
<li>Fixture Monkey는 복잡한 객체 구조에 대해 필요한 데이터를 자동으로 생성합니다. 이를 통해 테스트를 작성할 때 불필요한 데이터 생성 로직을 줄이고 테스트 로직에 집중할 수 있습니다.</li>
</ul>
</li>
<li><p><strong>객체의 불변성과 유연성 유지</strong></p>
<ul>
<li>기존 객체를 수정하거나 Setter를 추가하지 않아도 Fixture Monkey를 통해 객체를 유연하게 생성 및 수정할 수 있습니다. 특히, 불변 객체(immutable object)나 생성자가 많은 객체를 쉽게 테스트할 수 있습니다.</li>
</ul>
</li>
<li><p><strong>데이터 커스터마이징</strong></p>
<ul>
<li>특정 필드에 대한 값을 명시적으로 설정하거나 조건에 맞는 객체를 생성할 수 있습니다. 예를 들어, VIP 멤버 ID 목록처럼 특정 조건을 가진 데이터를 간단하게 생성할 수 있습니다.</li>
</ul>
</li>
<li><p><strong>테스트 유지보수 비용 절감</strong></p>
<ul>
<li>새로운 필드가 추가되거나 객체 구조가 변경되어도 Fixture Monkey를 사용하면 테스트 코드 수정 범위를 최소화할 수 있습니다.</li>
</ul>
</li>
</ol>
<br>

<hr>
<p>잘 작성된 테스트는 단순히 코드의 동작을 검증하는 역할을 넘어, 코드의 설계와 구조적 결함을 발견하게 해줍니다.<br><strong>Fixture Monkey</strong>와 같은 도구를 활용하면 코드의 불확실성과 부수효과를 줄이면서도 객체 생성과 테스트를 효율적으로 수행할 수 있습니다.<br>특히, 복잡한 객체나 다양한 조건의 테스트 데이터를 쉽게 생성할 수 있어 <strong>테스트 작성 비용을 절감</strong>하고 <strong>테스트 품질을 향상</strong>시킬 수 있습니다.  </p>
<p>그러나 <strong>도구의 활용보다 중요한 것은 테스트 가능한 설계를 만드는 것</strong>입니다.<br>테스트 가능한 설계는 테스트 코드로 하여금 코드 설계의 개선 방향을 제시하게 하며, 결과적으로 유지보수성과 확장성을 높이는 기반이 됩니다.</p>
<p>긴 글 읽어주셔서 감사합니다.</p>
<hr>
<h1 id="참고자료"><a href="#참고자료" class="headerlink" title="참고자료"></a>참고자료</h1><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://naver.github.io/fixture-monkey/v1-0-0/">Fixture Monkey 공식문서</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://tv.naver.com/v/23650158">테스트 객체는 엣지 케이스까지 찾아주는 Fixture Monkey에게 맡기세요</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://jwchung.github.io/testable-code">Testable Code by Jin-Wook Chung</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://youtu.be/YdtknE_yPk4?si=d8KPekxKZrsj_Rpk">무엇을 테스트할 것인가? 어떻게 테스트할 것인가? (권용근)</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.youtube.com/watch?v=XSkz0kO7J3w">실무에서 적용하는 테스트 코드 작성 방법과 노하우 (김남윤)</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.youtube.com/watch?v=pCE7ibRCZEI">왜 나는 테스트를 작성하기 싫을까? (조성아)</a></li>
</ul>
<hr>
<h3 id="전체-코드"><a href="#전체-코드" class="headerlink" title="전체 코드"></a>전체 코드</h3><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/jungguji/fixture-monkey-sample">https://github.com/jungguji/fixture-monkey-sample</a></li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a href="/2024/11/19/%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%BD%94%EB%93%9C-%EC%9E%91%EC%84%B1%EC%9D%84-%EB%8D%94-%EC%89%BD%EA%B2%8C-with-Fixture-Monkey/#post-footer" class="postShorten-excerpt_link link" aria-label>
                                댓글 공유
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        
        <li class="pagination-number">page 1 of 1</li>
    </ul>
</div>

</section>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2025 Junggu Ji. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <h4 id="about-card-name">Junggu Ji</h4>
        
            <div id="about-card-bio"><p>author.bio</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-fvy43rs4ns3qkm3cliupi5qtnm0vwph13v4ev99f0qvrcz9tbdyatctmah0i.min.js"></script>

<!--SCRIPTS END-->





    </body>
</html>
